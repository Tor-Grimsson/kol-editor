# 1.0.1 Icon Loader System

## Overview

The Icon component (`src/components/icons/Icon.jsx`) uses Vite's `import.meta.glob` to dynamically load SVG files at runtime. This system provides:

- **Zero bundle overhead**: SVGs are bundled by Vite but loaded on-demand
- **Automatic caching**: Loaded icons are cached in memory
- **Type-safe paths**: Icons must exist at build time (Vite validates the glob pattern)
- **Performance**: Async loading with fallback support

## How It Works

### 1. Folder Convention

Icons are organized alphabetically by their first letter:

```
src/components/icons/svg/
â”œâ”€â”€ a/
â”‚   â”œâ”€â”€ anchor.svg
â”‚   â””â”€â”€ arrow-from-bottom.svg
â”œâ”€â”€ b/
â”‚   â”œâ”€â”€ bold.svg
â”‚   â””â”€â”€ brush.svg
â”œâ”€â”€ c/
â”‚   â”œâ”€â”€ caret-down.svg
â”‚   â””â”€â”€ color.svg
â”œâ”€â”€ s/
â”‚   â”œâ”€â”€ shape-circle.svg
â”‚   â”œâ”€â”€ shape-square.svg
â”‚   â””â”€â”€ star.svg
â”œâ”€â”€ t/
â”‚   â”œâ”€â”€ trash.svg
â”‚   â””â”€â”€ text.svg
â””â”€â”€ ...
```

### 2. Path Resolution

The Icon component automatically constructs the path:

```js
// User provides:
<Icon name="trash" />

// Component resolves to:
./svg/t/trash.svg
```

**Path construction logic:**
1. Take first letter of `name` prop â†’ `"trash"[0]` = `"t"`
2. Lowercase the folder letter â†’ `"t"`
3. Construct path â†’ `"./svg/t/trash.svg"`

### 3. Vite Import Glob

At build time, Vite processes this line:

```js
const iconModules = import.meta.glob('./svg/**/*.svg', { query: '?raw', import: 'default' })
```

This creates a registry of **all** SVG files as lazy-loaded modules:

```js
{
  './svg/a/anchor.svg': () => import('./svg/a/anchor.svg?raw'),
  './svg/t/trash.svg': () => import('./svg/t/trash.svg?raw'),
  './svg/s/star.svg': () => import('./svg/s/star.svg?raw'),
  // ... all other icons
}
```

**Important**: The `?raw` query tells Vite to import the SVG as a string (not as a URL).

### 4. Async Loading & Caching

When you render `<Icon name="trash" />`:

1. Component constructs path: `./svg/t/trash.svg`
2. Checks cache: `iconCache.has(path)`
3. If not cached, calls the loader: `iconModules[path]()`
4. Vite dynamically imports the SVG string
5. Caches the result in `iconCache` (a Map)
6. Renders the SVG via `dangerouslySetInnerHTML`

**Cache lifecycle**: Persists for the entire session (until page reload).

## Usage

### Basic Usage

```jsx
import Icon from '@/components/icons/Icon'

// Simple icon
<Icon name="trash" />

// With size and color
<Icon name="star" size={24} color="#FFD700" />

// With title (accessibility)
<Icon name="brush" size={20} title="Brush Tool" />
```

### Props

| Prop | Type | Default | Description |
|------|------|---------|-------------|
| `name` | `string` | **required** | Icon filename without `.svg` extension |
| `folder` | `string` | `name[0]` | Override folder (if icon isn't in first-letter folder) |
| `size` | `number` | `20` | Width and height in pixels |
| `color` | `string` | `'currentColor'` | SVG fill color (inherits text color by default) |
| `className` | `string` | `''` | Additional CSS classes |
| `fallback` | `ReactNode` | `null` | Rendered if icon fails to load |
| `title` | `string` | `undefined` | Accessibility title (sets `role="img"`) |
| `aria-hidden` | `boolean` | `!title` | Hide from screen readers (auto-set if no title) |

### Advanced Examples

```jsx
// Custom folder (if icon isn't in first-letter folder)
<Icon name="move2" folder="m" />

// Inherit parent text color
<span className="text-blue-400">
  <Icon name="star" size={24} />
</span>

// Fallback for missing icons
<Icon name="nonexistent" fallback={<span>?</span>} />

// Accessibility-friendly
<Icon name="trash" size={16} title="Delete Item" />
```

## Adding New Icons

### Step 1: Place SVG in Correct Folder

Put your SVG file in the folder matching its **first letter**:

```bash
# Icon name: "shape-circle"
# First letter: "s"
# Location: src/components/icons/svg/s/shape-circle.svg
```

### Step 2: Ensure SVG Uses `currentColor`

Replace hardcoded colors with `currentColor` to make the icon themeable:

```xml
<!-- âŒ Bad: hardcoded color -->
<svg>
  <path fill="#000000" d="..." />
</svg>

<!-- âœ… Good: inherits color from parent -->
<svg>
  <path fill="currentColor" d="..." />
</svg>
```

### Step 3: Use the Icon

```jsx
<Icon name="shape-circle" size={24} />
```

**No imports needed!** Vite's glob automatically includes new files at build time.

## Common Issues

### Error: "Icon not found: ./svg/x/xyz.svg"

**Cause**: The SVG file doesn't exist at the constructed path.

**Solutions**:
1. Check the file exists: `src/components/icons/svg/x/xyz.svg`
2. Verify filename matches exactly (case-sensitive)
3. Ensure file is in the correct first-letter folder
4. If folder differs, use the `folder` prop:
   ```jsx
   <Icon name="xyz" folder="a" />
   ```

### Icon Doesn't Appear

**Cause**: SVG might not use `currentColor` or have `fill="none"`.

**Solution**: Edit the SVG:
```xml
<path fill="currentColor" d="..." />
```

### Icon Color Won't Change

**Cause**: SVG has inline `fill` or `stroke` attributes overriding `currentColor`.

**Solution**: Remove inline color attributes or change them to `currentColor`.

## Architecture Notes

### Why This Approach?

**Alternative 1: Import all icons upfront**
```js
import star from './svg/s/star.svg'
import trash from './svg/t/trash.svg'
// 800+ imports... ğŸ˜±
```
âŒ **Problem**: Massive bundle size, all icons loaded even if unused.

**Alternative 2: Dynamic import strings**
```js
const iconSvg = await import(`./svg/${folder}/${name}.svg`)
```
âŒ **Problem**: Vite can't statically analyze dynamic strings, breaks build.

**Our approach: `import.meta.glob`**
```js
const iconModules = import.meta.glob('./svg/**/*.svg', { query: '?raw' })
```
âœ… **Benefits**:
- Vite knows all files at build time (validates existence)
- Icons are code-split (loaded on-demand)
- Caching prevents redundant loads
- Type-safe (build fails if path is wrong)

### Performance

- **First load**: ~5-10ms per icon (async import + DOM render)
- **Cached load**: <1ms (direct Map lookup)
- **Bundle impact**: ~200 bytes per icon (just the loader function)
- **No runtime overhead**: Vite pre-processes the glob at build time

## Related Files

- `src/components/icons/Icon.jsx` - Icon component implementation
- `src/components/icons/svg/` - SVG file storage (alphabetized folders)
- `src/components/icons/svg/index.json` - Icon inventory (optional reference)
- `src/pages/AtomsPage.jsx` - Icon usage examples
- `docs/1.0.0-atomic-refactor.md` - Component architecture overview

## Migration Notes

### From Public Folder (Old Approach)

**Before** (public/icons/):
```jsx
<img src="/icons/trash.svg" alt="Delete" />
```

**After** (bundled with Vite):
```jsx
<Icon name="trash" title="Delete" />
```

**Benefits of new approach**:
1. Icons are bundled (no extra HTTP requests)
2. Tree-shakeable (unused icons aren't included in build)
3. Type-safe (build fails if icon doesn't exist)
4. Inherits text color automatically
5. Better accessibility (proper ARIA attributes)

## Future Enhancements

Possible improvements for future versions:

1. **Icon search**: Add a search page showing all available icons
2. **SVG optimization**: Run SVGO on icons during build
3. **TypeScript**: Generate icon name types from filesystem
4. **Preloading**: Preload commonly-used icons on app start
5. **Icon sets**: Support multiple icon families (outlined vs. filled)
