---
version: 1.0.0
date: 2025-11-16
status: active
content-type: implementation
category: pages
cross-references:
  parent: 4.0.3
  related:
    - apps/web/src/routes/Article.jsx
    - apps/web/src/components/prose
    - docs/documentation/4.0.34-stack-smart-article-routing.md
---

# 4.0.31 Stack — Prose Styles & Layouts

> Restores the lost “Rich Prose” reference from `docs/a-torg/stack-previous-md/7.2.5-stack-rich-prose.md` and documents how Stack articles map to layout + typography systems.

## Overview
- Stack supports **two editorial layouts** exposed through the Sanity `type` field: `standard` (single column) and `research` (two-column).
- Components live under `apps/web/src/components/prose` and are pulled into `apps/web/src/routes/Article.jsx` by the smart routing system.
- Rich prose options showcase the `kol-prose`, `kol-prose-wide`, and `kol-prose-compact` variants along with SimpleCodeBlock replacements.

## Layout Options

| Type | Layout | When to Use | Key Components |
|------|--------|-------------|----------------|
| `standard` | Single column (max 800px) | News updates, quick reads | `ArticleHeader`, `PortableText` + `kol-prose-wide` |
| `research` | Two-column (529px sticky nav + content) | Deep dives, tutorials, documentation | `ArticleHeader`, `StickyNavCard`, `ProseContent`, `SourcesSection` |

- Both layouts share the hero meta, tags, excerpt, hero image, author block, and sources footer.
- Research layout adds a sticky summary sidebar plus denser typography (`kol-prose`).

## Rich Prose Article (`RichProseArticle.jsx`)
- Demo article used for QA + documentation; located at `apps/web/src/components/sections/stack-detail/RichProseArticle.jsx`.
- Accepts `RichProseData` (tags, author, summary bullets, sections with paragraphs/list/code).
- Sidebar uses sticky summary cards with `kol-helper-md` styles and auto-active states via `IntersectionObserver`.
- Article body wraps Portable Text-like data inside `.kol-prose` to exercise headings, ordered lists, quotes, callouts, and code samples.

### Data Shape
```ts
type RichProseData = {
  tags: string[]
  title: string
  excerpt?: string
  author?: { name: string, avatar?: string, role?: string }
  date?: string
  readingTime?: string
  heroImage?: string
  summary?: Array<{ heading: string, body?: string, bullets?: string[] }>
  sections: Array<{
    title?: string
    paragraphs?: string[]
    listIntro?: string
    ordered?: string[]
    codeTitle?: string
    code?: string[]
    quote?: string
    closing?: string
  }>
}
```

### Usage
```jsx
import RichProseArticle, { SAMPLE_RICH_PROSE_ARTICLE } from
  '@/components/sections/stack-detail/RichProseArticle'

export default function ArticlePreview() {
  return <RichProseArticle article={SAMPLE_RICH_PROSE_ARTICLE} />
}
```

## Prose Variants & Code Blocks
- `.kol-prose` (default), `.kol-prose-wide`, `.kol-prose-compact` control measure + spacing.
- Each variant uses the new `SimpleCodeBlock` family (see `docs/a-torg/stack-previous-md/7.3.6-prose-simple-codeblock.md`):
  - `SimpleCodeBlockDefault` for `.kol-prose`
  - `SimpleCodeBlockWide` for `.kol-prose-wide`
  - `SimpleCodeBlockCompact` for `.kol-prose-compact`
- Integrate via Portable Text component maps:
```ts
export const portableTextBlogComponents = {
  types: { code: SimpleCodeBlockDefault, image: ImageBlock },
  block: { h2: ({children}) => <h2>{children}</h2>, ... }
}

export const portableTextBlogWideComponents = {
  types: { code: SimpleCodeBlockWide, image: ImageBlock },
  ...
}
```

## Components Reference
- `ArticleHeader.jsx`: tags (`Pill` inverse), title (`kol-display-lg`), author meta, excerpt, hero image.
- `ProseContent.jsx`: hand-authored content block used by research layout; ensures typography stays in sync.
- `PortableTextBlog.jsx`: Sanity Portable Text renderer wired to the SimpleCodeBlock components, quote/image blocks, and helper marks.
- `SourcesSection` (`@kol/ui`): shared bibliography component for both layout types.
- `StickyNavCard` (`@kol/ui`): used to build summary/TOC stacks for research articles.


## Checklist
- [ ] Choose the correct `type` in Sanity (defaults to `standard`).
- [ ] Wrap Portable Text output in the appropriate `kol-prose-*` container.
- [ ] Use `SimpleCodeBlock*` components; do **not** resurrect the deprecated `CodeBlock` atom.
- [ ] Keep hero/summary copy in sync with ArticleHeader props when editing design tokens.
- [ ] Update this doc if new article types (tutorial/case-study/etc.) ship.

See `4.0.34-stack-smart-article-routing.md` for how layouts are selected at runtime.
