# 4.4.3 Foundry Font Viewer Component

## MetricsWithControls Component

An interactive font metrics viewer that combines glyph visualization with real-time controls for exploring variable font properties and typographic metrics.

### Location
`apps/web/src/components/fontviewer/MetricsWithControls.jsx`

### Overview

The MetricsWithControls component provides a comprehensive interface for inspecting font metrics including baselines, ascenders, descenders, cap height, x-height, and bearings. It includes interactive controls for adjusting font properties in real-time.

### Features

1. **Glyph Selection**
   - Slider to scrub through all uppercase (A-Z) and lowercase (a-z) letters (52 total options)
   - Text input field for typing custom characters/words
   - Last-used-wins: whichever control is changed last determines what's displayed

2. **Variable Font Controls**
   - Font Size slider (48-320px)
   - Weight slider (uses font's weight axis min/max values)
   - Style slider (switches between Italic and Roman font files)

3. **Metrics Display**
   - Shows horizontal metrics: baseline, ascender, descender, cap height, x-height
   - Shows vertical bearings: left and right bearings
   - Bearings rotate to match italic angle when Italic style is selected
   - Labels show metric values in font units

4. **Font Information Pills**
   - Displays available variable font axes as pills (e.g., "Weight")

### Props

```jsx
{
  italicFontUrl: string,    // URL to italic font file (default: /fonts/TGMalromurItalicVF.ttf)
  romanFontUrl: string,     // URL to roman font file (default: /fonts/TGMalromurRomanVF.ttf)
  title: string,            // Font title (default: "TG M치lr칩mur")
  subtitle: string,         // Font subtitle (default: "Variable serif")
  className: string         // Additional CSS classes
}
```

### Usage Example

```jsx
import MetricsWithControls from '../../components/fontviewer/MetricsWithControls'
import malromurItalicFont from '/fonts/TGMalromurItalicVF.ttf?url'
import malromurRomanFont from '/fonts/TGMalromurRomanVF.ttf?url'

<MetricsWithControls
  italicFontUrl={malromurItalicFont}
  romanFontUrl={malromurRomanFont}
  title="TG M치lr칩mur"
  subtitle="Variable serif"
/>
```

### Implementation Details

#### Font Loading
- Uses `FontLoader` from `@kol/fontviewer` package
- Loads font file dynamically based on Style slider position
- Switches between italic and roman font files (0 = Italic, 1 = Roman)
- Extracts variable font axes and default values on load

#### Glyph Slider
- Generates 52 options (A-Z uppercase + a-z lowercase)
- Updates both slider position and text input when scrubbed
- Snaps to integer values (one letter per position)

#### Text Input
- 26px tall, rounded-full border
- Uses `kol-helper-xs` typography class
- 10 character max length
- Displays full text string in metrics viewer

#### Style Slider
- Smooth dragging with 0.01 step
- Snaps to 0 or 1 at halfway point (0.5)
- Value 0 = Italic (loads italic font file, rotates bearings)
- Value 1 = Roman (loads roman font file, vertical bearings)

#### Bearing Rotation
- Bearings rotate when italic style is active
- Rotation angle extracted from `font.tables.post.italicAngle`
- Only vertical bearing lines rotate; labels stay horizontal
- Bearings positioned at visual edges of rendered text

### Dependencies

- `Extraction` component (handles metrics rendering)
- `Slider` component from `@kol/ui`
- `Pill` component from `@kol/ui`
- `FontLoader` from `@kol/fontviewer`

### State Management

```jsx
const [fontFamily, setFontFamily] = useState(null)
const [fontInfo, setFontInfo] = useState(null)
const [fontSize, setFontSize] = useState(180)
const [sampleIndex, setSampleIndex] = useState(0)
const [customText, setCustomText] = useState("f")
const [variationAxes, setVariationAxes] = useState([])
const [variationValues, setVariationValues] = useState({})
const [isLoading, setIsLoading] = useState(true)
const [error, setError] = useState(null)
const [isItalic, setIsItalic] = useState(0) // 0 = Italic, 1 = Roman
```

### Current Usage

Located on Foundry Overview page (`/foundry`) in the "Interactive Metrics Inspector" section.

### Related Components

- `Extraction.jsx` - Core metrics visualization component
- `FontPreviewCard.jsx` - Alternative font preview component
- `EditableMetricsViewer.jsx` - Simpler text-input-only metrics viewer

### Design Notes

- Background: `bg-surface-primary` with `border-fg-08` border
- Uses rounded corners (`rounded-sm`)
- Responsive spacing with flex layout
- Controls stack vertically with consistent gap spacing

### Future Enhancements

- Multi-line text support (considered but not implemented due to complexity)
- Additional metric overlays (kerning pairs, optical sizing)
- Export/screenshot functionality
- Comparison mode (side-by-side weights/styles)
