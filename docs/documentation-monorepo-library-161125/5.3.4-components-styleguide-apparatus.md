# 5.3.4 Workshop: Styleguide Apparatus

**Version:** 1.0.0
**Date:** 2025-11-04
**Status:** Active
**Content Type:** implementation
**Category:** workshop

---

# Wavy Circle Editor Apparatus

**Purpose:** Interactive scientific apparatus for real-time SVG path editing and mathematical waveform generation, integrated into the design system styleguide.

> The Wavy Circle Editor is a sophisticated design tool that enables interactive manipulation of circular waveforms through mathematical parameter control. This apparatus features real-time node editing, bezier handle manipulation, symmetric editing modes, and export capabilities - transforming mathematical wave generation into an intuitive visual interface.

## Core Components

### Architecture Components
- **WavyCircleEditor** - Main editor assembly integrating canvas and controls
- **WavyCircleCanvas** - Interactive SVG rendering surface with node manipulation
- **WavyCircleControls** - Parameter control panel with real-time adjustments
- **useWavyCircleEditor** - State management and mathematical computation engine

### Mathematical Foundation
- **wavyCircleMath.js** - Core mathematical algorithms for wave generation

## Technical Architecture

### Mathematical Specifications

**Wave Generation Algorithm:**
```javascript
export const calculateOptimalNodes = ({ radius, amplitude, frequency }) => {
  const totalNodes = frequency * 4
  const generatedNodes = []

  for (let index = 0; index < totalNodes; index += 1) {
    const theta = (index / totalNodes) * Math.PI * 2
    const wavePhase = frequency * theta
    const r = radius + amplitude * Math.sin(wavePhase)
    const x = CANVAS_CENTER.x + r * Math.cos(theta)
    const y = CANVAS_CENTER.y + r * Math.sin(theta)

    // Tangent calculation for smooth bezier handles
    const drByTheta = amplitude * frequency * Math.cos(wavePhase)
    const tangentRadius = drByTheta
    const tangentTheta = r
    const tx = tangentRadius * Math.cos(theta) - tangentTheta * Math.sin(theta)
    const ty = tangentRadius * Math.sin(theta) + tangentTheta * Math.cos(theta)
    const tangentMagnitude = Math.sqrt(tx * tx + ty * ty) || 1
    const normalizedTx = tx / tangentMagnitude
    const normalizedTy = ty / tangentMagnitude
    const handleLength = (2 * Math.PI * r) / (totalNodes * 3)
```

**Tangent Vector Calculations:**
Each node computes normalized tangent vectors for smooth bezier curve generation:
- Tangent magnitude normalization prevents handle distortion
- Handle length dynamically calculated based on circumference
- Coordinate transformation for polar to cartesian conversion

### Interactive Control Systems

#### Parameter Controls

**Core Parameters:**
| Parameter | Range | Default | Function |
|-----------|-------|---------|----------|
| Radius | 50-300 | 120 | Base circle radius |
| Amplitude | 0-100 | 25 | Wave height variation |
| Frequency | 1-20 | 5 | Wave cycles per revolution |
| Zoom | 0.5-5 | 1 | Canvas scaling factor |
| Stroke Width | 1-10 | 2 | Path thickness |
| Path Color | hex | #ffffff | Visual styling |

#### UI State Management

**Display Options:**
- `showGrid` - Reference grid overlay for precise positioning
- `showNodes` - Control point visualization
- `showHandles` - Bezier control handle display
- `symmetricEdit` - Synchronized node manipulation
- `symmetricalBezier` - Automatic handle symmetry

### Canvas Interaction System

#### Node Manipulation
- **Direct Drag** - Click and drag nodes for real-time path deformation
- **Handle Editing** - Bezier control handle manipulation for curve smoothing
- **Symmetric Mode** - Opposite node synchronization for balanced edits
- **Zoom-Aware Interaction** - Drag sensitivity adapts to zoom level

#### Export Capabilities
- **SVG Export** - Generate clean SVG code for use in design system
- **Path Data Copy** - Copy SVG path data to clipboard
- **Real-time Preview** - Live visual feedback during parameter adjustment

## State Management Architecture

### useWavyCircleEditor Hook

**State Structure:**
```javascript
{
  params: {
    radius, amplitude, frequency, zoom, strokeWidth, pathColor
  },
  ui: {
    showGrid, showNodes, showHandles, symmetricEdit, symmetricalBezier
  },
  nodes: [/* calculated node array */],
  pathData: "M...Q...Z", // SVG path string
  stats: {
    nodeCount, pathLength, handlePositions
  },
  svgRef: React.ref // Direct SVG manipulation
}
```

**Performance Optimization:**
- Reference-based state for parameter changes
- Direct DOM manipulation for node positions
- Optimized recalculation on parameter changes only
- Efficient event handling for drag operations

## Enhancement Roadmap

### Planned Features

**Immediate Enhancements:**
1. **Undo/Redo Stack** - Symmetric edit history for reversible operations
2. **Keyboard Shortcuts** - Space+drag (pan), Cmd/Ctrl+Z (undo), Cmd/Ctrl+C (copy path)
3. **Adaptive Drag Sensitivity** - Zoom-level tied interaction feedback
4. **Visual Cursor States** - Distinct cursors for nodes vs. handles
5. **Live SVG Preview** - Real-time exported code display
6. **Zoom Pan Control** - Draggable zoom viewport
7. **Inverse Amplitude** - Negative wave phase generation

**Advanced Features:**
- Multi-path editing (multiple waveforms)
- Preset library for common patterns
- Animation export (CSS/SVG animations)
- Path smoothing algorithms
- Batch parameter optimization
- Collaborative editing mode

## Mathematical Model

### Wave Equation

The apparatus generates waves using:
```
r(θ) = radius + amplitude × sin(frequency × θ)
```

Where:
- `r` = radial distance from center
- `θ` = angle in radians (0 to 2π)
- `radius` = base circle radius
- `amplitude` = wave height variation
- `frequency` = number of complete waves

### Bezier Curve Generation

**Handle Calculation:**
```javascript
handleLength = (2 × π × radius) / (totalNodes × 3)
```

Handles are positioned tangentially to each node using:
- Normalized tangent vectors
- Dynamic handle length based on circumference
- Symmetric handle positioning for smooth curves

### Path Smoothing

The editor uses **quadratic bezier curves** for path generation:
- Each node pair connected by smooth bezier segment
- Handles calculated from tangent vectors
- Automatic smoothing prevents corner artifacts
- Symmetric mode ensures balanced waveforms

## Integration with Design System

### Token Usage
- **Colors** - Path colors reference design tokens
- **Typography** - Control labels use type scale
- **Spacing** - Control panel layout uses spacing system
- **Animation** - Parameter transitions use motion tokens

### Component Relationship
- **Atoms** - Buttons, inputs, toggles in control panel
- **Molecules** - Control groups, parameter blocks
- **Organisms** - Complete editor interface
- **Apparatus** - Wavy Circle Editor (this document)

## Operational Protocols

### Usage Workflow

1. **Access**: Navigate to `/styleguide/apparatus/wavy-circle`
2. **Adjust Parameters**: Use control panel for base wave properties
3. **Edit Nodes**: Click and drag nodes for custom waveform
4. **Toggle UI Elements**: Show/hide grid, nodes, handles as needed
5. **Export**: Copy SVG path or export complete SVG
6. **Share**: Use enhancement ideas list for feature requests

### Best Practices

**For Design System Development:**
- Use apparatus to prototype new circular wave patterns
- Export paths for integration into components
- Test symmetric editing for balanced designs
- Experiment with frequency/amplitude relationships

**For Mathematical Precision:**
- Enable grid for exact positioning
- Use symmetric mode for balanced waveforms
- Adjust zoom for fine-tuned node manipulation
- Test handle symmetry for curve quality

## Technical Dependencies

**React Architecture:**
- Hook-based state management
- Ref-based direct DOM manipulation
- Event-driven interaction system
- Performance-optimized re-renders

**Mathematical Libraries:**
- Native JavaScript trigonometry
- Custom bezier curve calculations
- Vector normalization algorithms
- SVG path generation utilities

**Browser APIs:**
- SVG manipulation
- Clipboard API (path copying)
- Pointer events (mouse/touch)
- Canvas rendering

## Related Documentation

**Component Documentation:**
- [5.3.2 Components: Apparatus Overview](5.3.2-components-apparatus-overview.md) - Complete apparatus system guide
- [3.0.0 Components: Overview](3.0.0-design-system-components.md) - Atomic design methodology
- [3.1.0 Components: Atoms](3.1.0-design-system-atoms.md) - Standard building blocks
- [3.2.0 Components: Molecules](3.2.0-design-system-molecules.md) - Combined components

**Technical Implementation:**
- `apps/web/src/routes/styleguide/ApparatusWavyCircle.jsx` - Route component
- `apps/web/src/components/styleguide/apparatus/WavyCircleEditor.jsx` - Main editor
- `apps/web/src/components/styleguide/apparatus/useWavyCircleEditor.js` - State management
- `apps/web/src/components/styleguide/apparatus/wavyCircleMath.js` - Mathematical algorithms

**System Architecture:**
- [2.0.0 Design System: Overview](2.0.0-design-system-overview.md) - Core design principles
- [2.1.0 Design System: Colors](2.1.0-design-system-colors.md) - Color system integration

---

**Apparatus Specifications:**
- **Primary Assembly:** `/apps/web/src/components/styleguide/apparatus/WavyCircleEditor.jsx`
- **Route:** `/styleguide/apparatus/wavy-circle`
- **Technical Documentation:** `/docs/documentation/5.3.4-components-styleguide-apparatus.md`

---

**Last Updated:** 2025-11-04
**Cross-References:** 5.3.2, 3.0.0, 3.1.0, 3.2.0, 2.0.0, 2.1.0
**Classification:** Design System Interactive Tool
**Operational Status:** Active & Fully Instrumented
