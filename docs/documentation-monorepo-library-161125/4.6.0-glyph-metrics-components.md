# 4.5.0 - Glyph Metrics Components
**Component Documentation**
**Date**: 2025-11-09

## Overview

Two new interactive glyph metrics components for visualizing font characteristics with real-time metrics overlays:

1. **MetricsViewerCard** - Side-by-side glyph inspector with rounded card aesthetics
2. **GlyphMetricsGrid** - Table-style Figma-spec layout with dual stacked grids

Both components use the `@kol/fontviewer` package to extract real font metrics from actual font files.

---

## Component 1: MetricsViewerCard

**File**: `apps/web/src/components/fontviewer/MetricsViewerCard.jsx`

### Purpose
Interactive metrics viewer for marketing/overview pages. Features a clean, card-based UI perfect for introductory content and general exploration.

### Layout
- **Left**: Glyph viewer with metrics overlay (400px height)
- **Right**: Character grid with rounded individual cards
- **Below Left**: Font metadata panel

### Props

| Prop | Type | Default | Description |
|------|------|---------|-------------|
| `fontUrl` | string | `malromurFont` | URL to the font file |
| `fontFamily` | string | `'TGMalromur'` | CSS font-family name |
| `fontStyle` | string | `'normal'` | Font style: `'normal'` or `'italic'` |
| `glyphs` | array | `glyphSets.lowercase` | Array of characters for grid |
| `initialGlyph` | string | `'f'` | Initial glyph to display |
| `title` | string | `'Font Metrics Inspector'` | Card title |
| `description` | string | (see code) | Card description text |

### Usage Example

```jsx
import MetricsViewerCard from '../../components/fontviewer/MetricsViewerCard'
import { glyphSets } from '@kol/ui/data'
import malromurFont from '@kol/fontviewer/src/assets/variFont/TGMalromurItalicVF.ttf?url'

// In Foundry Overview page
<MetricsViewerCard
  fontUrl={malromurFont}
  fontFamily="TGMalromur"
  fontStyle="italic"
  glyphs={glyphSets.lowercase}
  initialGlyph="f"
  title="View Metrics Live"
  description="Interactive font metrics inspector. Click any character to view detailed measurements."
/>
```

### Features
- Click to select glyph (persists)
- Hover to preview glyph (temporary)
- Real-time metrics: baseline, ascender, descender, cap height, x-height, bearings
- Unicode metadata display (hex, decimal)
- Theme-aware styling
- Uses existing `Extraction` component for metrics rendering
- Uses `GlyphItem` atoms for grid

### Current Usage
- `apps/web/src/routes/foundry/FoundryOverview.jsx` - Before "Start Using Our Fonts" section

---

## Component 2: GlyphMetricsGrid

**File**: `apps/web/src/components/fontviewer/GlyphMetricsGrid.jsx`

### Purpose
Comprehensive glyph inspector matching Figma specifications. Designed for detailed typeface pages where users need in-depth glyph exploration.

### Layout (Figma Spec)
- **Left**: 504px wide glyph viewer with massive 316px glyph
- **Right**: 832px wide dual stacked character grids
- **Grid Style**: Table-like with touching borders (`outline outline-1`)
- **Typography**: PP Right Grotesk Mono for labels

### Props

| Prop | Type | Default | Description |
|------|------|---------|-------------|
| `fontUrl` | string | `defaultFontUrl` | URL to the font file |
| `fontFamily` | string | `'TGMalromur'` | CSS font-family name |
| `fontStyle` | string | `'normal'` | Font style: `'normal'` or `'italic'` |
| `initialGlyph` | string | `'f'` | Initial glyph to display |
| `uppercaseGlyphs` | array | `uppercase + latin1` | Glyphs for top grid |
| `lowercaseGlyphs` | array | `lowercase + latinExtended` | Glyphs for bottom grid |

### Usage Example

```jsx
import GlyphMetricsGrid from '../../fontviewer/GlyphMetricsGrid'

// In typeface pages (Málrómur, Dylgjur, etc.)
<GlyphMetricsGrid
  fontUrl="/fonts/TGMalromurItalicVF.ttf"
  fontFamily="TGMalromur"
  fontStyle="italic"
/>

// With custom glyph sets
<GlyphMetricsGrid
  fontUrl="/fonts/TGDylgjur-Regular.otf"
  fontFamily="TGDylgjur"
  fontStyle="normal"
  uppercaseGlyphs={glyphSets.uppercase}
  lowercaseGlyphs={glyphSets.lowercase}
  initialGlyph="A"
/>
```

### Features
- Click to select glyph (persists, inverted theme)
- Hover to preview glyph (temporary)
- Real font metrics extracted via `FontLoader`
- Metric lines with labels and numeric values
- Font metadata panel (style, glyph name, Unicode hex/dec)
- Two stacked grids for larger character coverage
- Table-like grid aesthetic (borders touching, no gaps)
- Theme-aware using proper design tokens

### Current Usage
All 6 typeface pages (above FoundryCharacterSets):
- `apps/web/src/components/sections/foundry/FoundryType.jsx` (Málrómur)
- `apps/web/src/components/sections/foundry/FoundryTypeDylgjur.jsx`
- `apps/web/src/components/sections/foundry/FoundryTypeGullhamrar.jsx`
- `apps/web/src/components/sections/foundry/FoundryTypeOrdspor.jsx`
- `apps/web/src/components/sections/foundry/FoundryTypeSilfurbarki.jsx`
- `apps/web/src/components/sections/foundry/FoundryTypeTrollatunga.jsx`

---

## Font File Mapping

| Typeface | Font File | Style |
|----------|-----------|-------|
| Málrómur | `/fonts/TGMalromurItalicVF.ttf` | `italic` |
| Dylgjur | `/fonts/TGDylgjur-Regular.otf` | `normal` |
| Gullhamrar | `/fonts/TGGullhamrarVF.ttf` | `normal` |
| Orðspor | `/fonts/TGOrdsporVF.ttf` | `normal` |
| Silfurbarki | `/fonts/TGSilfurbarki-Regular.otf` | `normal` |
| Tröllatunga | `/fonts/TGTrollatunga-Regular.otf` | `normal` |

---

## Design System Compliance

### CSS Tokens Used
- `var(--kol-border-default)` - Metric lines and grid outlines
- `var(--kol-surface-on-primary)` - Metric labels and text
- `var(--kol-surface-primary)` - Background
- `var(--kol-surface-secondary)` - Card backgrounds
- `.bg-auto` + `.text-auto` - Theme-aware colors
- `.border-auto` - Theme-aware borders

### Typography Classes
- `kol-heading-sm` - Card titles
- `kol-text-md` - Card descriptions
- `kol-label-md` - Grid section labels
- `kol-label-sm` - Metadata labels
- `kol-body-md` - Metadata values
- `font-['PP_Right_Grotesk_Mono']` - Figma spec monospace

### Layout Classes
- `bg-container-primary` - Card containers
- `bg-surface-secondary` - Nested panels
- `border-default` - Card borders
- `rounded-sm` - Card border radius

---

## Technical Implementation

### Metrics Extraction
Both components use `FontLoader` from `@kol/fontviewer` to extract real font metrics:

```javascript
const metrics = {
  unitsPerEm: font.unitsPerEm || 1000,
  ascender: font.tables?.os2?.sTypoAscender ?? 800,
  descender: font.tables?.os2?.sTypoDescender ?? -200,
  capHeight: font.tables?.os2?.sCapHeight ?? 700,
  xHeight: font.tables?.os2?.sxHeight ?? 500
}
```

### Metric Line Rendering
Metric lines are rendered dynamically using DOM manipulation:
- Positioned absolutely within overlay div
- Calculated based on font size and units per em
- Include labels (left) and numeric values (right)
- Use proper design tokens for colors

### Selection State
- `selectedGlyph` - Persists until new click
- `hoveredGlyph` - Temporary preview on hover
- `displayGlyph = hoveredGlyph || selectedGlyph` - Hover takes priority

---

## Integration Notes

### Adding to New Pages

**For overview/marketing pages:**
```jsx
import MetricsViewerCard from '../components/fontviewer/MetricsViewerCard'
```

**For typeface detail pages:**
```jsx
import GlyphMetricsGrid from '../fontviewer/GlyphMetricsGrid'
```

### Positioning Guidelines
- **MetricsViewerCard**: Use before CTA sections, good for "features" areas
- **GlyphMetricsGrid**: Place above FoundryCharacterSets, dedicated section

### Wrapper Requirements
```jsx
{/* MetricsViewerCard - self-contained */}
<section className="w-full px-8 py-16">
  <MetricsViewerCard {...props} />
</section>

{/* GlyphMetricsGrid - needs centering wrapper */}
<div className="main-wrapper">
  <div className="w-full flex justify-center py-16">
    <GlyphMetricsGrid {...props} />
  </div>
</div>
```

---

## Known Issues & Future Work

### Selection State Bug (In Progress)
The selected state in GlyphMetricsGrid currently makes text invisible due to color token mismatch:
- Issue: `bg-auto` + `text-auto-inverse` creates same-on-same in both light/dark
- Status: Deferred for future fix
- Workaround: None currently, functionality works but selection is invisible

### Future Enhancements
- [ ] Fix selection state color pairing
- [ ] Add keyboard navigation support
- [ ] Export glyph metrics as data
- [ ] Add bearing visualization option
- [ ] Support for multiple font variants in one view

---

## Related Documentation
- [2.1.0 Design System Colors](./2.1.0-design-system-colors.md)
- [2.1.1 Color Cheat Sheet](./2.1.1-color-cheat-sheet.md)
- [2.2.0 Design System Typography](./2.2.0-design-system-typography.md)
- [FontViewer Package README](../../packages/fontviewer/README.md)
- [Agent-KOL Context Cheat Sheet](../llm-context/AGENT-KOL-CONTEXT-CHEAT-SHEET.md)

---

**Last Updated**: 2025-11-09
**Components Created**: MetricsViewerCard, GlyphMetricsGrid
**Files Modified**: 8 (2 new components, 6 typeface pages, 1 overview page)
