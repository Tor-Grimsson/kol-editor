# 2.4.0 Design System: Prose & Rich Text

**Version:** 3.3
**Date:** 2025-10-31 (updated 2025-11-03)
**Status:** Active
**Content Type:** implementation
**Category:** design-system

---

# Prose Text System (v3.3)

**Purpose:** Comprehensive styling for long-form content including blog posts, articles, and rich text from CMSes.

> The prose text system provides comprehensive styling for long-form content including blog posts, articles, project descriptions, and rich text from CMSes like Sanity. It handles everything from semantic HTML elements to complex content blocks like code snippets, quotes, and embedded media.

## Design Philosophy

1. **Readability First** - Optimal line length, spacing, and contrast for long-form reading
2. **Semantic HTML** - Proper heading hierarchy, lists, blockquotes, and emphasis
3. **Responsive by Default** - Fluid typography scales smoothly from mobile to desktop
4. **Theme Aware** - Automatic adaptation to light/dark mode and inverse surfaces
5. **CMS Integration** - Works seamlessly with Sanity Portable Text and other rich text

---

## The Three Prose Variants

The system provides three prose wrappers optimized for different content widths:

### `.kol-prose` - Standard (65ch)

**Use for:** Blog posts, articles, standard documentation

**Max Width:** 65ch (~1040px)
**Optimal for:** 45-75 characters per line (ideal readability range)

```html
<article class="kol-prose">
  <h1>Article Title</h1>
  <p>Body content with automatic styling...</p>
</article>
```

### `.kol-prose-wide` - Wide (90ch)

**Use for:** Marketing pages, hero content, foundry pages

**Max Width:** 90ch (~1440px)
**Optimal for:** Large-scale typography, dramatic layouts

```html
<section class="kol-prose-wide">
  <h1>Hero Headline</h1>
  <p>Large marketing copy...</p>
</section>
```

### `.kol-prose-compact` - Compact (45ch)

**Use for:** Sidebars, cards, narrow columns

**Max Width:** 45ch (~720px)
**Optimal for:** Constrained spaces, supplementary content

```html
<aside class="kol-prose-compact">
  <h3>Related Content</h3>
  <p>Sidebar text...</p>
</aside>
```

---

## Core Elements

All prose variants automatically style these semantic HTML elements:

### Headings (h1-h4)

**h1** - Hero headline (Right Grotesk Tight, uppercase, responsive)
```html
<h1>Breaking the Grid</h1>
```

- Standard prose: `48px â†’ 64px`
- Wide prose: `64px â†’ 96px`
- Compact prose: `32px â†’ 40px`

**h2** - Section heading (Right Grotesk Tight, responsive)
```html
<h2>The Typography Scale</h2>
```

- Standard: `32px â†’ 48px`
- Wide: `40px â†’ 64px`
- Compact: `24px â†’ 32px`

**h3** - Subsection heading (Right Grotesk Tight, responsive)
```html
<h3>Implementation Details</h3>
```

- Standard: `24px â†’ 32px`
- Wide: `32px â†’ 48px`
- Compact: `20px â†’ 24px`

**h4** - Minor heading (Inter Tight, responsive)
```html
<h4>Additional Notes</h4>
```

- Standard: `20px`
- Wide: `24px`
- Compact: `18px`

### Body Text (p)

Primary reading content using Inter Tight for optimal legibility.

```html
<p>This is a paragraph with optimal line spacing and responsive sizing.</p>
```

- Standard prose: `16px â†’ 18px` (160% line height)
- Wide prose: `18px â†’ 20px` (170% line height)
- Compact prose: `14px â†’ 16px` (160% line height)

**Spacing:** `1rem` bottom margin (auto-removed on last child)

### Links (a)

Accent-colored links with underline for accessibility.

```html
<p>Read more on our <a href="/blog">design blog</a>.</p>
```

- **Color:** `var(--kol-accent-primary)` with underline
- **Hover:** `var(--kol-accent-primary-strong)`
- **Underline offset:** `0.2em` for readability

### Emphasis (strong, em)

```html
<p>Use <strong>strong</strong> for importance and <em>emphasis</em> for stress.</p>
```

- **strong:** `font-weight: 600`
- **em:** `font-style: italic`

### Lists (ul, ol, li)

**Unordered Lists (ul):**
- Marker: **Bold `+` sign** (font-weight: 700)
- Marker positioning: Absolute, left-aligned

```html
<ul>
  <li>First item</li>
  <li>Second item</li>
  <li>Third item</li>
</ul>
```

**Ordered Lists (ol):**
- Marker: **Decimal numbers** (01, 02, 03)
- Font: Monospace with tabular numbers

```html
<ol>
  <li>Step one</li>
  <li>Step two</li>
  <li>Step three</li>
</ol>
```

**Nested Lists (all levels):**
```html
<ul>
  <li>First level</li>
  <li>
    First level with nested:
    <ul>
      <li>Second level (1rem indent)</li>
      <li>
        Second level with third:
        <ul>
          <li>Third level (1rem indent)</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
```

**Settings:**
- **Item spacing:** `0.25rem` (4px) between list items
- **Marker indentation:** `2rem` from left edge
- **Nested indentation:** `1rem` for all levels (2nd, 3rd, etc.)
- **Sizing:** Matches body text (responsive)
- **Mixed nesting:** Supported (ul within ol, ol within ul)

**All three variants:**
- **Standard:** Plus signs (+) for ul, decimal-leading-zero (01, 02) for ol
- **Wide:** Disc bullets (â€¢) for ul, decimal (1, 2) for ol
- **Compact:** Disc bullets (â€¢) for ul, decimal (1, 2) for ol

### Blockquotes

Accent-bordered quotes with italic styling.

```html
<blockquote>
  Design systems are meant to be brokenâ€”carefully, deliberately, and with intention.
</blockquote>
<p>â€” Attribution or context text</p>
```

- **Border:** `4px solid var(--kol-accent-primary)` on left

**Text After Blockquote:** Paragraphs immediately following a blockquote are styled as attribution text with mono font, muted color (64% opacity), and 1rem top marginâ€”similar to pull quote citations.

```css
.kol-prose blockquote + p {
  font-family: var(--kol-font-family-mono);
  font-size: 14px;
  font-weight: 500;
  margin-block-start: 1rem;
  color: color-mix(in srgb, var(--kol-surface-on-primary) 64%, transparent);
}
```

- **Padding:** `1.5rem` (standard), `2rem` (wide), `1rem` (compact)
- **Style:** Italic, 90% opacity

### Code

**Inline code:**
```html
<p>Use the <code>.kol-prose</code> class for styling.</p>
```

- **Background:** `var(--kol-surface-tertiary)`
- **Font:** `var(--kol-font-family-mono)`
- **Size:** `0.9em` relative to surrounding text
- **Padding:** `0.3em Ã— 0.2em` with `4px` border radius

**Code blocks:**
```html
<pre><code>function example() {
  return "formatted code"
}</code></pre>
```

- **Background:** `var(--kol-surface-tertiary)`
- **Font:** `var(--kol-font-family-mono)`
- **Size:** `14px` (standard), `16px` (wide), `12px` (compact)
- **Line height:** `140%`
- **Scroll:** `overflow-x: auto` for wide code

### Horizontal Rules (hr)

```html
<hr />
```

- **Border:** `1px solid var(--kol-border-default)`
- **Margin:** `2rem` (standard), `3rem` (wide), `1.5rem` (compact)

**Text After hr:** Paragraphs immediately following a horizontal rule are styled as transitional text with mono font, muted color (64% opacity), and 1rem top marginâ€”consistent with text after blockquotes.

```css
.kol-prose hr + p {
  font-family: var(--kol-font-family-mono);
  font-size: 14px;
  font-weight: 500;
  margin-block-start: 1rem;
  color: color-mix(in srgb, var(--kol-surface-on-primary) 64%, transparent);
}
```

---

## Extended Elements

Beyond basic HTML, the prose system includes patterns for rich content blocks:

### Figures & Captions

For images with descriptive text.

```html
<figure class="kol-prose-figure">
  <img src="image.jpg" alt="Description" />
  <figcaption class="kol-caption-text">Image caption text</figcaption>
</figure>
```

**With label:**
```html
<figure class="kol-prose-figure">
  <div class="kol-caption-label">Figure 1</div>
  <img src="diagram.jpg" alt="Architecture diagram" />
  <figcaption class="kol-caption-text">System architecture overview</figcaption>
</figure>
```

**Styling:**
- `.kol-prose-figure` - Container with appropriate margins
- `.kol-caption-label` - Small uppercase label (kol-helper-xs)
- `.kol-caption-text` - Caption text (kol-mono-sm-fine, muted color)

### Pull Quotes

Large, centered quotes for emphasis (distinct from blockquotes).

```html
<div class="kol-pull-quote">
  <p>"Typography is the craft of endowing human language with a durable visual form."</p>
  <cite>â€” Robert Bringhurst</cite>
</div>
```

**CSS:**
```css
.kol-pull-quote {
  font-family: var(--kol-font-family-rgrot-narrow);
  font-size: clamp(24px, 3vw, 32px);
  line-height: 130%;
  text-align: center;
  margin-block: 3rem;
  padding-inline: 2rem;
  color: color-mix(in srgb, var(--kol-surface-on-primary) 84%, transparent);
}

.kol-pull-quote cite {
  display: block;
  font-family: var(--kol-font-family-mono);
  font-size: 14px;
  font-style: normal;
  margin-block-start: 1rem;
  color: var(--text-fg-64);
}
```

### Callout Cards

Highlighted content blocks for notes, warnings, tips.

```html
<div class="kol-callout kol-callout-info">
  <div class="kol-callout-label">ðŸ’¡ Tip</div>
  <p>Use semantic HTML elements whenever possible for better accessibility.</p>
</div>
```

**Variants:**
- `.kol-callout-info` - Neutral (default)
- `.kol-callout-warning` - Yellow accent
- `.kol-callout-danger` - Red accent
- `.kol-callout-success` - Green accent (if added to system)

**CSS:**
```css
.kol-callout {
  background: var(--kol-surface-secondary);
  border-left: 4px solid var(--kol-accent-primary);
  border-radius: 8px;
  padding: 1.5rem;
  margin-block: 1.5rem;
}

.kol-callout-label {
  font-family: var(--kol-font-family-mono);
  font-size: 14px;
  font-weight: 500;
  text-transform: uppercase;
  margin-block-end: 0.5rem;
  color: var(--kol-accent-primary);
}

.kol-callout-warning {
  border-left-color: var(--kol-status-warning, #f5d245);
}

.kol-callout-danger {
  border-left-color: var(--kol-status-danger);
}
```

### Tables

Responsive tables with horizontal scroll on mobile.

```html
<div class="kol-table-wrapper">
  <table class="kol-table">
    <thead>
      <tr>
        <th>Token</th>
        <th>Value</th>
        <th>Usage</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>--kol-surface-primary</code></td>
        <td>#fafafa</td>
        <td>Page background</td>
      </tr>
    </tbody>
  </table>
</div>
```

**CSS:**
```css
.kol-table-wrapper {
  overflow-x: auto;
  margin-block: 1.5rem;
  border: 1px solid var(--kol-border-default);
  border-radius: 8px;
}

.kol-table {
  width: 100%;
  border-collapse: collapse;
  font-family: var(--kol-font-family-mono);
  font-size: 14px;
}

.kol-table th {
  background: var(--kol-surface-secondary);
  padding: 0.75rem 1rem;
  text-align: left;
  font-weight: 500;
  text-transform: uppercase;
  font-size: 12px;
  color: var(--text-fg-64);
  border-bottom: 1px solid var(--kol-border-default);
}

.kol-table td {
  padding: 0.75rem 1rem;
  border-bottom: 1px solid var(--kol-border-subtle);
}

.kol-table tbody tr:last-child td {
  border-bottom: none;
}

.kol-table tbody tr:hover {
  background: var(--kol-surface-secondary);
}
```

### Asides & Sidebars

Two-column layout with main prose and sidebar content.

```html
<div class="kol-prose-layout-sidebar">
  <aside class="kol-prose-sidebar">
    <h4>Table of Contents</h4>
    <ul>
      <li><a href="#intro">Introduction</a></li>
      <li><a href="#details">Details</a></li>
    </ul>
  </aside>

  <article class="kol-prose">
    <h1 id="intro">Introduction</h1>
    <p>Main content...</p>
  </article>
</div>
```

**CSS:**
```css
.kol-prose-layout-sidebar {
  display: grid;
  grid-template-columns: 1fr;
  gap: 3rem;
  max-width: 1400px;
  margin-inline: auto;
}

@media (min-width: 1024px) {
  .kol-prose-layout-sidebar {
    grid-template-columns: 280px 1fr;
  }
}

.kol-prose-sidebar {
  order: 2;
}

@media (min-width: 1024px) {
  .kol-prose-sidebar {
    order: 1;
    position: sticky;
    top: 6rem;
    align-self: start;
  }
}
```

---

## CMS Integration

### Sanity Portable Text

The system integrates seamlessly with Sanity's Portable Text:

```jsx
import { PortableText } from '@portabletext/react'
import { portableTextComponents } from '@/components/prose/core/PortableText'

export default function Article({ post }) {
  return (
    <article class="kol-prose">
      <PortableText
        value={post.body}
        components={portableTextComponents}
      />
    </article>
  )
}
```

**Component mapping:**
```jsx
export const portableTextComponents = {
  types: {
    code: CodeBlock,
    image: ImageBlock,
  },
  marks: {
    link: ({ value, children }) => (
      <a href={value.href} target={value.blank ? '_blank' : undefined}>
        {children}
      </a>
    ),
  },
  block: {
    normal: ({ children }) => <p>{children}</p>,
    h2: ({ children }) => <h2>{children}</h2>,
    h3: ({ children }) => <h3>{children}</h3>,
    h4: ({ children }) => <h4>{children}</h4>,
    blockquote: ({ children }) => <blockquote>{children}</blockquote>,
  },
  list: {
    bullet: ({ children }) => <ul>{children}</ul>,
    number: ({ children }) => <ol>{children}</ol>,
  },
  listItem: {
    bullet: ({ children }) => <li>{children}</li>,
    number: ({ children }) => <li>{children}</li>,
  },
}
```

### Custom Block Types

Extend Portable Text with custom blocks:

```jsx
// In your Sanity schema
{
  name: 'callout',
  type: 'object',
  fields: [
    { name: 'type', type: 'string', options: { list: ['info', 'warning', 'danger'] } },
    { name: 'title', type: 'string' },
    { name: 'content', type: 'text' }
  ]
}

// In your component mapping
export const portableTextComponents = {
  types: {
    callout: ({ value }) => (
      <div className={`kol-callout kol-callout-${value.type}`}>
        {value.title && <div className="kol-callout-label">{value.title}</div>}
        <p>{value.content}</p>
      </div>
    ),
  },
}
```

---

## Color & Theming

### Automatic Dark Mode

All prose elements use semantic color tokens that automatically adapt:

```css
.kol-prose {
  color: var(--kol-surface-on-primary); /* Auto-adapts */
}

.kol-prose a {
  color: var(--kol-accent-primary); /* Auto-adapts */
}

.kol-prose code {
  background: var(--kol-surface-tertiary); /* Auto-adapts */
}
```

- **Light mode:** Dark text on light background
- **Dark mode:** Light text on dark background

### Inverse Surface Adaptation

Prose inside `.bg-surface-inverse` automatically inverts:

```html
<div class="bg-surface-inverse">
  <article class="kol-prose">
    <h1>This text automatically inverts</h1>
    <p>All colors adapt to the inverse context.</p>
  </article>
</div>
```

**How it works:** The `.bg-surface-inverse` utility remaps `--kol-surface-on-primary` to use inverse values.

### Text Opacity Utilities

For muted or secondary text within prose:

```html
<p class="text-fg-64">Secondary text at 64% opacity</p>
<p class="text-fg-32">Tertiary text at 32% opacity</p>
```

**Hierarchy:**
- `100%` (default) - Primary text
- `.text-fg-64` - Secondary/muted text
- `.text-fg-32` - Tertiary/subtle text
- `.text-fg-16` - Disabled/placeholder text

### Gradient Overlays

For images with text overlays:

```html
<div class="relative">
  <img src="hero.jpg" alt="Hero" />
  <div class="gradient-fade-top absolute inset-0" />
  <div class="absolute bottom-0 left-0 p-8">
    <h1 class="text-auto">Overlaid Text</h1>
  </div>
</div>
```

**Available gradients:**
- `.gradient-fade-top` - Fades from surface color to transparent (bottom to top)
- `.gradient-fade-bottom` - Top to bottom
- `.gradient-fade-left` - Right to left
- `.gradient-fade-right` - Left to right

---

## Best Practices

### Content Width Optimization

**45-75 characters per line** is optimal for readability:
- Too narrow (<45ch): Choppy reading, frequent line breaks
- Too wide (>75ch): Eye fatigue, difficulty tracking to next line

**Use:**
- `.kol-prose` (65ch) for most content âœ…
- `.kol-prose-wide` (90ch) for marketing/hero only
- `.kol-prose-compact` (45ch) for sidebars/cards

### Vertical Rhythm

Maintain consistent spacing using system values:

```css
/* Good - consistent rhythm */
.kol-prose h2 {
  margin-block-start: 2rem;
  margin-block-end: 1rem;
}

.kol-prose p {
  margin-block-end: 1rem;
}
```

**Avoid** arbitrary margin values that break the rhythm.

### Heading Hierarchy

Always use semantic heading order:

```html
<!-- âœ… Good -->
<h1>Article Title</h1>
<h2>Section</h2>
<h3>Subsection</h3>
<h4>Detail</h4>

<!-- âŒ Bad -->
<h1>Title</h1>
<h3>Section</h3>  <!-- Skipped h2 -->
<h2>Subsection</h2>  <!-- Wrong order -->
```

**Why:** Screen readers and SEO rely on proper hierarchy.

### Accessibility

**Always include:**
- Alt text on images: `<img alt="Description" />`
- Link context: Avoid "click here", use descriptive text
- Proper heading hierarchy (h1 â†’ h2 â†’ h3 â†’ h4)
- Sufficient contrast: Use design system tokens only

**Test with:**
- Screen reader (VoiceOver, NVDA)
- Keyboard navigation (Tab, Enter)
- High contrast mode
- Text scaling (200% zoom)

### Performance

**Optimize:**
- Lazy load images: `loading="lazy"`
- Responsive images: `srcset` for different sizes
- Code splitting: Load syntax highlighter only when needed

```html
<img
  src="image-800.jpg"
  srcset="image-400.jpg 400w, image-800.jpg 800w, image-1200.jpg 1200w"
  sizes="(max-width: 800px) 100vw, 800px"
  alt="Description"
  loading="lazy"
/>
```

---

## Migration Guide

### From Old Prose System

If migrating from the deprecated blog.css:

**Token updates:**
```diff
- var(--foreground)
+ var(--kol-surface-on-primary)

- var(--foreground-muted)
+ Use .text-fg-64 utility class

- var(--surface-border)
+ var(--kol-border-default)

- var(--surface-secondary)
+ var(--kol-surface-secondary)
```

**Class updates:**
```diff
- .text-fg-48
+ .text-fg-64  /* Closest geometric value */

- .bg-fg-12
+ .bg-fg-16  /* Closest geometric value */
```

**Inline styles:**
```diff
- style={{ color: 'color-mix(in srgb, var(--kol-surface-on-primary) 64%, transparent)' }}
+ className="text-fg-64"

- style={{ backgroundColor: 'var(--kol-color-neutral-200)' }}
+ className="bg-opacity-hex-16"
```

### CSS Import Changes

```diff
- @import './blog.css';
+ @import './prose.css';
```

Or use the unified import (coming soon):
```css
@import './prose-unified.css';
```

---

## Technical Implementation

### File Locations

**CSS:**
- Core styles: `packages/ui/css/prose.css`
- Legacy (deprecated): `packages/ui/css/blog.css`

**Components:**
- Prose renderer: `apps/web/src/components/prose/core/ProseRenderer.jsx`
- Portable Text config: `apps/web/src/components/prose/core/PortableText.jsx`
- Content blocks: `apps/web/src/components/prose/blocks/`
- Layouts: `apps/web/src/components/prose/layouts/`

**Documentation:**
- This file: `docs/documentation/2.4.0-design-system-prose.md`
- Typography: `docs/documentation/2.2.0-design-system-typography.md`
- Colors: `docs/documentation/2.1.0-design-system-colors.md`
- CSS Architecture: `docs/documentation/2.3.0-design-system-css-architecture.md`

### CSS Layer Architecture

Prose styles use the `@layer prose` directive for proper cascade control:

```css
@layer base, prose, components, utilities;

@layer prose {
  .kol-prose { /* ... */ }
  .kol-prose h1 { /* ... */ }
}
```

**Why:** Ensures prose styles can be overridden by component and utility layers when needed.

## Related Documentation

**Design System:**
- [2.0.0 Design System: Overview](2.0.0-design-system-overview.md) - Overall philosophy and principles
- [2.1.0 Design System: Colors](2.1.0-design-system-colors.md) - Color tokens and theming
- [2.2.0 Design System: Typography](2.2.0-design-system-typography.md) - Typography implementation
- [2.3.0 Design System: CSS Architecture](2.3.0-design-system-css-architecture.md) - Layer structure and organization

**Research Foundation:**
- [6.2.0 Research: Typography](6.2.0-research-typography.md) - Typography in rich text
- [6.1.0 Research: Data Tables](6.1.0-research-data-tables.md) - Data table patterns and accessibility

**Legacy References:**
- [3.3-prose-text.md](../../system/3.3-prose-text.md) - Original implementation (legacy)
- [3.0-typography.md](../../system/3.0-typography.md) - Typography (legacy)
- [2.0-color-system.md](../../system/2.0-color-system.md) - Color system (legacy)

---

## Quick Reference

### Common Patterns

**Standard article:**
```html
<article class="kol-prose">
  <h1>Title</h1>
  <p>Content...</p>
</article>
```

**With header/footer:**
```html
<div class="max-w-[1200px] mx-auto flex flex-col gap-8 py-16">
  <header><!-- Meta, tags --></header>
  <article class="kol-prose"><!-- Content --></article>
  <footer><!-- Related, tags --></footer>
</div>
```

**Two-column with sidebar:**
```html
<div class="kol-prose-layout-sidebar">
  <aside class="kol-prose-sidebar"><!-- TOC --></aside>
  <article class="kol-prose"><!-- Content --></article>
</div>
```

---

## Version History

- v3.3 (2025-10-31): Prose Typography & Rich Content system complete
- v2.0 (Previous): Legacy implementation
- v2.4.0 (2025-11-03): Migrated to system-evolution with M.m.p numbering and cross-references

---

**Last Updated:** 2025-11-03
**Cross-References:** 2.0.0, 2.1.0, 2.2.0, 2.3.0, 6.2.0, 6.1.0
**Category:** Design System
**Status:** Active
