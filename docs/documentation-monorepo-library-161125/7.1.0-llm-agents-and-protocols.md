# 7.1.0 LLM Agents & Protocols

**Version:** 1.0.0
**Date:** 2025-11-04
**Status:** Active
**Content Type:** operations
**Category:** operations

---

# LLM Agents & Protocols System

**Purpose:** Comprehensive guide to the LLM context management system, agent collaboration protocols, session workflows, checkpoint procedures, and handoff mechanisms for maintaining continuity across agent interactions.

> This document defines the operational protocols for LLM agent interactions, including context management, agent collaboration patterns, session logging, checkpoint procedures, and knowledge transfer mechanisms. It ensures seamless collaboration between multiple agents while maintaining project continuity and institutional memory.

## Executive Summary

### System Overview

**Context Management:** Complete protocol for LLM agent handoffs
**Checkpoint Cadence:** Every 10 messages or milestone completion
**Archive Strategy:** Active vs. historical content separation
**Session Logging:** Structured documentation of all work cycles

### Protocol Components

- âœ… Complete context hierarchy (5 core documents)
- âœ… Checkpoint system with message counter
- âœ… Session logging workflow
- âœ… Archive discipline framework
- âœ… Handoff procedures for multi-agent work

## Core Documents Architecture

### Document Hierarchy

| Purpose | Location | Scope | Notes |
|---------|----------|-------|-------|
| Behavior Rules | `LLM_RULES.md` | System-wide | Communication protocol, design mandates |
| Agent Onboarding | `docs/llm-context/AGENT-ONBOARDING.md` | Startup | Quickstart checklist (5-minute ramp) |
| Active Context | `docs/llm-context/AGENT-CONTEXT.md` | Current Work | Active focus, milestones, key links |
| Session Logs | `docs/llm-context/SESSION-LOGS/` | Daily Work | Current cycle transcripts only |
| Decisions Ledger | `docs/architectural-decisions-log.md` | Cross-cutting | Architecture decisions (archived) |

### Document Responsibilities

#### LLM_RULES.md
```markdown
# Core guardrails and communication protocol
- Message formatting standards
- Checkpoint expectations (10-message cadence)
- Design system mandates (M.m.p numbering)
- Agent collaboration protocols
- Handoff procedures
```

#### docs/llm-context/AGENT-ONBOARDING.md
```markdown
# Five-minute agent ramp-up
1. Read LLM_RULES.md (behaviour guardrails)
2. Review AGENT-CONTEXT.md (active focus)
3. Check latest session log (recent work)
4. Scan architectural decisions (context)
5. Identify next steps (continuity)
```

#### docs/llm-context/AGENT-CONTEXT.md
```markdown
# Project snapshot
- Active focus areas
- Recent milestones completed
- Key documentation links
- Current workstream priorities
- Blockers and dependencies
```

#### docs/llm-context/SESSION-LOGS/
```markdown
# Daily work tracking
- YYYY-MM-DD-HHMM.md format
- Structured session entries
- Outcome documentation
- Next steps identification
- Archive previous days
```

#### docs/architectural-decisions-log.md
```markdown
# Cross-cutting decisions
- Architecture choices
- Technology selections
- Process decisions
- Rationale and context
- Superseded entries archived
```

## Workflow Loop

### Phase 1: Session Initialization

```bash
# Reset message counter
./scripts/count-messages.sh reset

# Complete onboarding checklist
1. Read LLM_RULES.md â†’ understand guardrails
2. Review AGENT-CONTEXT.md â†’ active focus
3. Scan latest session log â†’ recent progress
4. Check decisions log â†’ context
5. Identify next steps â†’ continuity
```

**Purpose:** Ensure every agent starts with complete context

**Note:** The counter script is located in `docs/llm-context/count-messages.sh`

### Phase 2: Active Work

```bash
# Track message count
./scripts/count-messages.sh increment  # After each reply

# Maintain documentation
- Take notes in-progress
- Draft DECISIONS entries immediately when patterns emerge
- Prepare checkpoint materials
```

**Checkpoint Triggers:**
- Every 10 messages (warning at âš ï¸, stop at ðŸš¨)
- Milestone completion
- Architecture decisions
- Handoff points

### Phase 3: Checkpoint Creation

```markdown
# Checkpoint Documentation
## Session Log Entry (docs/llm-context/SESSION-LOGS/YYYY-MM-DD-HHMM.md)
- Work completed
- Decisions made
- Artifacts created
- Next steps
- Blockers (if any)

## Context Updates
- Update AGENT-CONTEXT.md â†’ active focus
- Update master index â†’ progress
- Archive superseded docs

## Decision Logging
- Log in archive/system-retired/
- Include rationale
- Link to artifacts
- Note dependencies
```

### Phase 4: Handoff

```markdown
# Handoff Completeness
âœ“ Session log has "Next Steps" populated
âœ“ Architectural decisions logged (if any)
âœ“ Context updated with current state
âœ“ Superseded docs archived
âœ“ Message counter reset for next agent

# Blocker Communication
- Document blockers in session log
- Add to decisions file if architectural
- Include context for resolution
```

## Message Counter System

### Tool Usage

```bash
# Session start
./scripts/count-messages.sh reset
# Creates .codex/message-count file

# During work
./scripts/count-messages.sh increment
# Increments counter after each reply

# Check status
./scripts/count-messages.sh show
# Returns: "Messages: N/15"
```

### Warning System

```markdown
Message Count Thresholds:
- 0-9: Normal operation
- 10: âš ï¸ WARNING - Checkpoint required
- 15: ðŸš¨ HARD STOP - Handoff mandatory

State Persistence:
- File: .codex/message-count
- Format: single integer
- Survives agent restarts
```

### Implementation

```bash
#!/bin/bash
# scripts/count-messages.sh

COMMAND="$1"
COUNT_FILE=".codex/message-count"

case "$COMMAND" in
  reset)
    echo "0" > "$COUNT_FILE"
    echo "Message counter reset"
    ;;
  increment)
    COUNT=$(cat "$COUNT_FILE" 2>/dev/null || echo "0")
    COUNT=$((COUNT + 1))
    echo "$COUNT" > "$COUNT_FILE"
    echo "Messages: $COUNT/15"
    ;;
  show)
    COUNT=$(cat "$COUNT_FILE" 2>/dev/null || echo "0")
    echo "Messages: $COUNT/15"
    if [ "$COUNT" -ge 15 ]; then
      echo "ðŸš¨ HARD STOP - Checkpoint required"
    elif [ "$COUNT" -ge 10 ]; then
      echo "âš ï¸  WARNING - Prepare checkpoint"
    fi
    ;;
esac
```

## Archive Discipline

### Active vs. Historical Separation

```markdown
# Active (Fast Ramp-Up)
docs/llm-context/SESSION-LOGS/
- Only current day's logs
- Yesterday's logs â†’ archive
- Max 2 days in active

docs/llm-context/AGENT-CONTEXT.md
- Current workstream
- Active milestones
- Current priorities

# Historical (Archive)
docs/archive/session-logs/2025/
- Month organization
- Full audit trail
- Searchable index

docs/archive/system-retired/
- Deprecated docs
- Migration history
- Decision rationale
```

### Archive Procedure

```bash
# Archive yesterday's logs
mv docs/llm-context/SESSION-LOGS/2025-11-03.md docs/archive/session-logs/2025/2025-11-03.md

# Update archive index
echo "## 2025-11-03
- Session log: Atomic design research completion
- Decisions: Retired 64 legacy files
- Context: All 6 research docs complete" >> docs/archive/session-logs/README.md
```

### Benefits

1. **Fast Ramp-Up**
   - New agent reads ~20 recent messages
   - Current context + 1-2 session logs
   - No months of history

2. **Complete Audit Trail**
   - All decisions preserved
   - Migration history intact
   - Searchable archives

3. **Active Clarity**
   - Only current work visible
   - Focused priorities
   - Reduced noise

## Session Logging Template

### Standard Session Log

```markdown
# Session Log: 2025-11-04-1430

**Participants:**
- Claude Code (Anthropic CLI)
- User (Design System Lead)

**Session Objective:**
Complete atomic design research chapter

**Work Completed:**
1. Created 6.1.0 Atoms Research
   - Analyzed all 14 atoms
   - TypeScript interfaces documented
   - Grade: A- (9.2/10)

2. Created 6.2.0 Molecules Research
   - Analyzed 11/13 molecules
   - Compound patterns documented
   - Grade: B+ (8.4/10)

**Decisions Made:**
- Kol agents integrated throughout research
- Missing organisms identified (4/10)
- Archive strategy validated

**Artifacts Created:**
- `/docs/documentation/6.1.0-design-system-atoms-research.md`
- `/docs/documentation/6.2.0-design-system-molecules-research.md`
- Updated master index

**Next Steps:**
1. Create 6.3.0 Organisms Research
2. Create 6.4.0 Templates Research
3. Create 6.5.0 Pages Research
4. Update 2.0.0 with agent mentions

**Blockers:**
None

**Context Updates:**
- Active focus: Complete atomic design research (6/6 docs)
- Updated AGENT-CONTEXT.md
- Master index: 21 documents â†’ 23 documents

**Session Duration:**
Messages: 0-12 (within checkpoint window)
```

## Context Maintenance

### AGENT-CONTEXT.md Updates

```markdown
# Agent Context - 2025-11-04

## Active Focus
- Complete atomic design research chapter (6 docs)
- Create 6.3.0, 6.4.0, 6.5.0 research documents

## Recent Milestones
- âœ… 6.0.0 Components Research (A- grade)
- âœ… 6.1.0 Atoms Research (A- grade)
- âœ… 6.2.0 Molecules Research (B+ grade)
- ðŸ”„ 6.3.0 Organisms Research (in progress)

## Key Links
- Master Index: 0.0.2-metadata-index.md
- Atoms: 6.1.0-design-system-atoms-research.md
- Molecules: 6.2.0-design-system-molecules-research.md

## Current Workstream
Atomic design research chapter
- Hierarchy: Atoms â†’ Molecules â†’ Organisms â†’ Templates â†’ Pages
- Integration: All 4 Kol agents
- Completion: 3/6 docs (50%)

## Next Session Priorities
1. Create 6.3.0 Organisms Research
2. Create 6.4.0 Templates Research
3. Create 6.5.0 Pages Research
4. Update master index
5. Update 2.0.0 with agent mentions
```

### Migration Status Board

```markdown
# Migration Status - 2025-11-04

## Phase 4: Atomic Design Research
- [x] 6.0.0 Components Research
- [x] 6.1.0 Atoms Research
- [x] 6.2.0 Molecules Research
- [ ] 6.3.0 Organisms Research (in progress)
- [ ] 6.4.0 Templates Research
- [ ] 6.5.0 Pages Research
- [ ] Update master index
- [ ] Update 2.0.0 design system overview

## Outstanding Risks
- None

## Completion Targets
- Phase 4: 2025-11-04
- All research docs: 6/6 complete
```

## Cross-Reference Integrity

### Related Documentation

| Document | Cross-Reference | Purpose |
|----------|-----------------|---------|
| LLM_RULES.md | Guardrails | System behavior |
| AGENT-ONBOARDING.md | Operations | Startup protocol |
| AGENT-CONTEXT.md | Status | Current work |
| Master Index | Navigation | Document discovery |

### Version Compatibility

```markdown
Protocol Version: 1.0.0
Documents Supported:
- LLM_RULES.md (v1.0+)
- AGENT-ONBOARDING.md (v1.0+)
- AGENT-CONTEXT.md (v1.0+)
- Session Logs (v1.0+)
- Decisions Log (v1.0+)

Breaking Changes:
- None (v1.x stable)
```

## LLM Agent Integration

### Kol Agents Context

```markdown
# Agent Onboarding: Kol Agents
# .claude/agents/ - Specialized expertise

## kol-color Agent
- Expertise: Color system architecture
- Context: 97 tokens, WCAG AA compliance
- Usage: Color decisions, token management

## kol-type Agent
- Expertise: Typography hierarchy
- Context: 10-level scale, harmonic proportions
- Usage: Type scale, text systems

## kol-div Agent
- Expertise: Layout systems
- Context: Three-tier wrapper, responsive patterns
- Usage: Layout decisions, spacing

## kol-docs Agent
- Expertise: Documentation standards
- Context: M.m.p system, cross-references
- Usage: Document structure, conventions
```

### Agent Collaboration

```markdown
# Multi-Agent Workflow
1. Lead agent initiates workstream
2. Specialized agents consulted for expertise
3. Decisions logged in context
4. Artifacts cross-referenced
5. Handoff maintains continuity

Example:
- Main agent: "kol-color, what's the best approach for..."
- kol-color: Provides expertise
- Main agent: Logs decision, continues work
```

## Best Practices

### Do's

```markdown
âœ“ Checkpoint at 10 messages
âœ“ Log architectural decisions immediately
âœ“ Update context when workstream changes
âœ“ Archive superseded docs promptly
âœ“ Use session log template
âœ“ Include next steps in handoff
âœ“ Maintain message counter
âœ“ Cross-reference related docs
âœ“ Include rationale in decisions
âœ“ Keep active docs current
```

### Don'ts

```markdown
âœ— Skip checkpoint at 10 messages
âœ— Leave context stale across sessions
âœ— Keep old logs in active directory
âœ— Make decisions without logging rationale
âœ— Handoff without next steps
âœ— Ignore message counter warnings
âœ— Break cross-reference integrity
âœ— Create orphan documentation
âœ— Skip agent onboarding
âœ— Work without active context
```

## Troubleshooting

### Common Issues

#### Issue: Message Counter Stuck
```bash
# Reset counter
./scripts/count-messages.sh reset
# Check state
cat .codex/message-count
```

#### Issue: Missing Context
```markdown
# Recovery procedure
1. Read LLM_RULES.md
2. Review AGENT-CONTEXT.md
3. Scan latest session logs
4. Check decisions log
5. Identify current state
```

#### Issue: Orphan Session Logs
```bash
# Find old logs
ls -la docs/llm-context/SESSION-LOGS/
# Archive old logs
for file in docs/llm-context/SESSION-LOGS/*.md; do
  if [[ "$file" < "$(date -d '2 days ago' +%Y-%m-%d)"*.md ]]; then
    mv "$file" "docs/archive/session-logs/2025/"
  fi
done
```

#### Issue: Stale Context
```markdown
# Update context
1. Edit docs/llm-context/AGENT-CONTEXT.md
2. Update active focus
3. Update recent milestones
4. Update next priorities
5. Archive if workstream complete
```

## Tools & Automation

### Message Counter Script

```bash
#!/bin/bash
# Location: docs/llm-context/count-messages.sh
# Executable: chmod +x docs/llm-context/count-messages.sh

set -euo pipefail

COMMAND="${1:-show}"
COUNT_FILE=".codex/message-count"

mkdir -p .codex

case "$COMMAND" in
  reset)
    echo "0" > "$COUNT_FILE"
    echo "Message counter reset"
    ;;
  increment)
    COUNT=$(cat "$COUNT_FILE" 2>/dev/null || echo "0")
    COUNT=$((COUNT + 1))
    echo "$COUNT" > "$COUNT_FILE"
    echo "Messages: $COUNT/15"
    if [ "$COUNT" -ge 15 ]; then
      echo "ðŸš¨ HARD STOP - Checkpoint required"
      return 1
    elif [ "$COUNT" -ge 10 ]; then
      echo "âš ï¸  WARNING - Prepare checkpoint"
    fi
    ;;
  show)
    COUNT=$(cat "$COUNT_FILE" 2>/dev/null || echo "0")
    echo "Messages: $COUNT/15"
    if [ "$COUNT" -ge 15 ]; then
      echo "ðŸš¨ HARD STOP - Checkpoint required"
    elif [ "$COUNT" -ge 10 ]; then
      echo "âš ï¸  WARNING - Prepare checkpoint"
    fi
    ;;
  *)
    echo "Usage: $0 {reset|increment|show}"
    exit 1
    ;;
esac
```

### Archive Helper

```bash
#!/bin/bash
# Archive old session logs

SESSION_DIR="docs/llm-context/SESSION-LOGS"
ARCHIVE_DIR="docs/archive/session-logs/2025"

mkdir -p "$ARCHIVE_DIR"

# Move logs older than 2 days
find "$SESSION_DIR" -name "*.md" -type f |
  while read -r file; do
    date_str=$(basename "$file" .md | cut -d'-' -f1-3)
    file_date=$(date -d "$date_str" +%s 2>/dev/null || continue)
    cutoff_date=$(date -d '2 days ago' +%s)

    if [ "$file_date" -lt "$cutoff_date" ]; then
      mv "$file" "$ARCHIVE_DIR/"
      echo "Archived: $(basename "$file")"
    fi
  done
```

## Conclusion

The LLM Context & Protocol System ensures **seamless agent collaboration** through structured documentation, checkpoint discipline, and archive management. By following the workflow loop and maintaining context integrity, agents can handoff work without losing continuity or institutional memory.

### System Strengths

1. **Fast Agent Ramp-Up** (5-minute onboarding)
2. **Complete Audit Trail** (session logs + decisions)
3. **Checkpoint Discipline** (10-message cadence)
4. **Active Clarity** (current vs. historical separation)
5. **Multi-Agent Support** (specialized Kol agents)

### Protocol Benefits

- **Zero Context Loss**: Every decision documented
- **Rapid Handoffs**: New agent productive in minutes
- **Audit Compliance**: Full project history preserved
- **Knowledge Transfer**: Explicit documentation culture
- **Workflow Discipline**: Built-in checkpoint system

### Usage Statistics

- **Core Documents**: 5 (rules, onboarding, context, logs, decisions)
- **Active Retention**: 2 days (session logs)
- **Archive Organization**: Year/month structure
- **Checkpoint Cadence**: 10 messages (with 15-message hard stop)
- **Onboarding Time**: 5 minutes (structured checklist)

## Related Documentation

**Operations Documentation:**
- [7.0.0 Operations: Development Workflow](7.0.0-operations-development-workflow.md) - Development processes
- [LLM Rules](../llm-context/LLM_RULES.md) - Behavior guardrails
- [Agent Onboarding](../llm-context/AGENT-ONBOARDING.md) - Startup checklist

**System Documentation:**
- [0.0.1 Metadata: Writing Guidelines](0.0.1-metadata-writing-guidelines.md) - Documentation standards
- [0.0.2 Metadata: Master Index](0.0.2-metadata-index.md) - Document navigation

**Agent Documentation:**
- [kol-docs Agent](../.claude/agents/kol-docs.md) - Documentation expertise
- Kol Agents (color, type, div) - Specialized domain knowledge

---

**File Locations:**
- **Protocol Docs:** `docs/llm-context/` (LLM_RULES.md, AGENT-*.md, SESSION-LOGS/)
- **Session Logs:** `docs/llm-context/SESSION-LOGS/` (active), `docs/archive/session-logs/` (historical)
- **Tools:** `docs/llm-context/count-messages.sh`

---

**Last Updated:** 2025-11-04
**Cross-References:** 7.0.0, 0.0.1, 0.0.2, LLM_RULES.md, AGENT-ONBOARDING.md, kol-docs
**Category:** Operations
**Status:** Active