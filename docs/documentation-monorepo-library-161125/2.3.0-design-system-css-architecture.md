# 2.3.0 Design System: CSS Architecture

**Version:** 2.0
**Date:** 2025-10-16 (updated 2025-11-03)
**Status:** Active
**Content Type:** implementation
**Category:** design-system

---

# CSS Architecture

**Purpose:** Layer structure and organization for the kolkrabbi design system.

> This chapter documents the CSS architecture for the kolkrabbi design system, following a layered approach that mirrors Tailwind v4's layer model and keeps the `--kol-*` token architecture authoritative.

## Quick Layer Map

```
packages/ui/
  theme.css              # @theme tokens + base resets shared everywhere
  css/
    components.css       # Shared recipes (buttons, typography, cards)
    utilities.css        # Shared utilities, animations, surface helpers
apps/<app>/src/index.css # Imports shared layers, adds app-only utilities
```

- **Tokens + resets** live in `theme.css`. Keep this file implementation-agnostic.
- **Recipes** for reusable components belong in `css/components.css`.
- **Utilities and motion** belong in `css/utilities.css`.
- **App-only styles** live in each app's `index.css` (after the shared imports).

This structure mirrors Tailwind v4's layer model and keeps the `--kol-*` token architecture authoritative. Use it whenever you add or modify styles.

## Shared Layers (`packages/ui`)

### `theme.css`

- Imports Tailwind and defines the `@theme` token map (colors, typography, spacing, radii, motion).
- Maintains minimal `@layer base` rules (body defaults, font smoothing) used across apps.
- Exposes semantic tokens (`--kol-surface-*`, `--kol-container-*`, etc.) plus backward-compatible aliases where required.
- Do **not** add component selectors or utilities here.

### `css/components.css`

- Houses reusable recipes inside `@layer components` (typography helpers, button shells, slider styling).
- Recipes consume semantic tokens and container variables (`--surface-panel-fg`, `--foreground`, etc.) so they adapt automatically in inverse contexts.
- React atoms in `packages/ui/src/atoms/` already map these classes; prefer consuming atoms over re-declaring class strings.
- When you create a reusable pattern that spans apps, codify it here instead of local styles.

### `css/utilities.css`

- Contains shared `@utility` definitions and motion primitives (flex helpers, grid utilities, animation keyframes).
- Provides surface helpers such as `.surface-panel` and `.surface-inverse`, which remap foreground/background variables for light/dark parity.
- When an app-level utility gets reused, promote it into this file and delete the local copy.

### Supporting JS helpers

- `packages/ui/src/utils/theme.js` exposes `applyTheme`, `getInitialTheme`, and `subscribeToSystemTheme`—use these instead of custom theme scripts.
- `packages/ui/src/atoms/ThemeToggle.jsx` consumes the helpers; import the toggle from `@kol/ui`.

## App Layers (`apps/<app>/src/index.css`)

- Import shared layers **in order**:
  ```css
  @import "tailwindcss";
  @import "@kol/ui/theme.css";
  @import "@kol/ui/css/components.css";
  @import "@kol/ui/css/utilities.css";
  ```
- Define app-specific utilities and experiments after the imports using Tailwind's `@utility` syntax.
- When a local helper graduates to cross-app usage, move it to `packages/ui/css/utilities.css`.
- Avoid redefining shared recipes (buttons, typography, surface helpers) to prevent drift.
- Wrap inverse sections with `.surface-panel surface-inverse` (or use the relevant component prop) so semantic tokens resolve to the correct palette.

## Pattern Ownership

- Prefer React atoms/molecules from `@kol/ui` over raw class strings—they already track token updates.
- If you must reach for raw classes, reference the recipe defined in `css/components.css` to avoid divergence.
- Keep route-specific styling colocated with the component (local CSS modules or inline Tailwind classnames) and reserve global utilities for reusable patterns.

## Theming & Assets

- Toggle themes through the shared helpers; don't manipulate `.dark` or `data-theme` manually.
- New colors or states must be introduced as `--kol-*` tokens in `theme.css`, then consumed through utilities/recipes.
- Brand assets should inherit color via semantic classes (e.g. `text-accent-primary`) rather than hardcoding fills in SVGs.
- Elevation, overlays, and state utilities live in `theme.css`—reference them instead of ad-hoc `color-mix` declarations.

## Components Index

**Data table helpers** now included in `packages/ui/css/components.css`:

- `.dataTableTitle` – 4×16 padding, mono, uppercase for column titles.
- `.dataTableText` – 4×16 padding, mono body text.
- `.dataTableMeta` / `.dataTableMetaStrong` – 4×16 padding, mono xx-small for metadata (60% opacity vs 100%).
- `.dataTablePill` – 4×16 pill shell using semantic borders.
- `.dataTableToken` – inline token chip (tight padding, subtle background/border).

## Related Documentation

**Design System:**
- [2.0.0 Design System: Overview](2.0.0-design-system-overview.md) - Overall philosophy and principles
- [2.1.0 Design System: Colors](2.1.0-design-system-colors.md) - Color tokens and theming
- [2.2.0 Design System: Typography](2.2.0-design-system-typography.md) - Typography implementation

**Research Foundation:**
- [6.1.0 Research: Data Tables](6.1.0-research-data-tables.md) - Accessibility patterns
- [6.2.0 Research: Typography](6.2.0-research-typography.md) - Typography scale and harmonic philosophy

**Foundation:**
- [1.0.0 Foundation: Repository Structure](1.0.0-foundation-repository-structure.md) - Monorepo architecture
- [1.0.1 Foundation: Naming Conventions](1.0.1-foundation-naming-conventions.md) - Naming standards

**Legacy References:**
- [4.0-css-architecture.md](../../system/4.0-css-architecture.md) - Original implementation (legacy)
- [2.0-color-system.md](../../system/2.0-color-system.md) - Color system (legacy)
- [3.0-typography.md](../../system/3.0-typography.md) - Typography (legacy)

---

## Remaining Issues & Next Steps

- Document the upcoming spacing/radius token work once the system stabilizes (planned `4.1` addendum).
- Audit app-level utilities to confirm anything shared has been promoted to `packages/ui/css/utilities.css`.
- Add visual diagrams of the cascade layers to `/styleguide/colors` or `/styleguide/introduction` for faster onboarding.

## Version History

- v2.0 (2025-10-16): Renamed into numbered series, updated for `--kol-*` token architecture, added outstanding work log
- v1.0 (2024-10-04): Initial Tailwind v4 guidance
- v2.3.0 (2025-11-03): Migrated to system-evolution with M.m.p numbering and cross-references

---

**Last Updated:** 2025-11-03
**Cross-References:** 2.0.0, 2.1.0, 2.2.0, 6.1.0, 6.2.0, 1.0.0, 1.0.1
**Category:** Design System
**Status:** Active
