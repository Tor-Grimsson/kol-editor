# 1.5.3 Router DOM

> React Router integration for application routing and navigation.

## Overview

The application uses React Router v6 for client-side routing. The router is configured at two levels:
1. **Top-level routes** in `App.jsx` - public site and styleguide
2. **Nested routes** in `Styleguide.jsx` - styleguide-specific pages

## Router Setup

### BrowserRouter

**Location**: `apps/web/src/App.jsx`

```javascript
function App() {
  return (
    <BrowserRouter>
      <AppRoutes />
    </BrowserRouter>
  )
}
```

- **BrowserRouter** - uses HTML5 history API
- **Client-side navigation** without page reloads
- **URL synchronization** with React state

### AppRoutes Component

**Location**: `apps/web/src/App.jsx`

```javascript
function AppRoutes() {
  const location = useLocation()

  // Loader overlay logic
  const [isLoading, setIsLoading] = useState(() => {
    const hasSeenLoader = sessionStorage.getItem('hasSeenLoader')
    return !hasSeenLoader
  })

  // Scroll restoration
  useEffect(() => {
    const savedPosition = sessionStorage.getItem('scrollPosition')
    if (savedPosition) {
      window.scrollTo(0, parseInt(savedPosition, 10))
      sessionStorage.removeItem('scrollPosition')
    }
  }, [])

  // Route change handling
  useEffect(() => {
    if (location.pathname !== '/') {
      setIsLoading(false)
    }
    window.scrollTo(0, 0)  // Scroll to top on route change
  }, [location])

  return (
    <>
      {isLoading && location.pathname === '/' && <LoaderOverlay onEnter={handleEnter} />}
      <Routes>...</Routes>
    </>
  )
}
```

**Key Features**:
- **Loader state management** - controls initial load overlay
- **Scroll restoration** - saves/restores scroll position
- **Scroll to top** - on every route change
- **Conditional rendering** - loader only on homepage first visit

## Route Structure

### Top-Level Routes

**Location**: `apps/web/src/App.jsx`

```javascript
<Routes>
  <Route element={<SiteLayout />}>
    <Route index element={<Home />} />
    <Route path="work" element={<Work />} />
    <Route path="work/:slug" element={<WorkDetail />} />
    <Route path="foundry" element={<Foundry />} />
    <Route path="stack" element={<Stack />} />
    <Route path="stack/:slug" element={<StackArticle />} />
    <Route path="collections/illustrations" element={<CollectionsIllustrations />} />
    <Route path="collections/logomarks" element={<CollectionsLogomarks />} />
    <Route path="demo" element={<Demo />} />
    <Route path="styleguide/*" element={<Styleguide />} />
  </Route>
</Routes>
```

**Pattern**:
- All routes wrapped in `SiteLayout` (provides navbar/footer)
- Nested layout via `<Outlet />` in SiteLayout
- Wildcard route `styleguide/*` catches all styleguide paths
- Dynamic routes with params (`:slug`)

### Nested Styleguide Routes

**Location**: `apps/web/src/routes/Styleguide.jsx`

```javascript
const Styleguide = () => {
  return (
    <Routes>
      <Route element={<StyleguideLayout />}>
        <Route index element={<Home />} />
        <Route path="introduction" element={<Introduction />} />
        <Route path="logo" element={<Logo />} />
        <Route path="colors" element={<Colors />} />
        <Route path="typography" element={<Typography />} />
        <Route path="icons" element={<Icons />} />
        <Route path="foundations" element={<Foundations />} />
        <Route path="components" element={<Components />} />
        <Route path="components/atoms" element={<ComponentsAtoms />} />
        <Route path="components/molecules" element={<ComponentsMolecules />} />
        <Route path="components/organisms" element={<ComponentsOrganisms />} />
        <Route path="prose" element={<Prose />} />
        <Route path="apparatus" element={<HomeApparat />} />
        <Route path="apparatus/circle-generator" element={<ApparatusCircleGenerator />} />
        <Route path="apparatus/frequency-modulator" element={<ApparatusFrequencyModulator />} />
        <Route path="docs" element={<Documentations />} />
        <Route path="design-system/documentation" element={<Documentations />} />
        <Route path="design-system/documentation/:docId" element={<DocumentationReader />} />
        <Route path="chess" element={<ChessHome />} />
        <Route path="chess/overview" element={<ChessOverview />} />
        <Route path="chess/apparatus" element={<ChessApparatus />} />
        <Route path="chess/dashboards" element={<ChessDashboards />} />
        <Route path="chess/tables" element={<ChessTables />} />
        <Route path="chess/documentation" element={<ChessDocumentation />} />
      </Route>
    </Routes>
  )
}
```

**Pattern**:
- All wrapped in `StyleguideLayout` (provides sidebar)
- Nested layout with `<Outlet />`
- Index route (`index`) for parent path
- Nested routes under `/styleguide/*`

### Redirects

```javascript
<Route path="apparatus/wavy-circle" element={<Navigate to="apparatus/circle-generator" replace />} />
```

**Redirect Patterns**:
- Old URLs â†’ new URLs
- `<Navigate>` component with `replace` prop
- Maintains clean URL structure

## Layout Integration

### SiteLayout

**Location**: `apps/web/src/components/layout/SiteLayout.jsx`

```javascript
import { Outlet, useLocation } from 'react-router-dom'

export default function SiteLayout() {
  const location = useLocation()
  const hideChrome = location.pathname.startsWith('/styleguide')

  return (
    <div className="min-h-dvh bg-surface-primary">
      {!hideChrome && <Navbar />}
      <Outlet />
      {!hideChrome && <Footer />}
      <CursorOverlay />
    </div>
  )
}
```

**Key Feature**: Uses `<Outlet />` to render child routes and conditionally shows chrome.

### StyleguideLayout

**Location**: `apps/web/src/components/styleguide/layout/StyleguideLayout.jsx`

```javascript
import { Outlet, useLocation, useNavigate } from 'react-router-dom'

const StyleguideLayout = () => {
  const location = useLocation()
  const navigate = useNavigate()
  const normalizedPath = location.pathname.replace(/\/$/, '')

  const handleDropdownChange = (value) => {
    if (value) navigate(value, { replace: false })
  }

  return (
    <div className="lg:grid lg:grid-cols-[304px_minmax(0,1fr)]">
      <StyleguideSidebar />
      <main>
        <div className="lg:hidden">
          <Dropdown
            options={dropdownOptions}
            value={currentDropdownValue}
            onChange={handleDropdownChange}
          />
        </div>
        <Outlet />
      </main>
    </div>
  )
}
```

**Key Features**:
- Provides sidebar layout
- Mobile dropdown navigation
- Programmatic navigation via `navigate()`
- Path normalization (removes trailing slash)

## Navigation Components

### NavLink vs Link

**NavLink** (active state aware):
```javascript
<NavLink
  to="/work"
  className={({ isActive }) =>
    isActive ? 'text-blue-600' : 'text-gray-600'
  }
>
  Work
</NavLink>
```

**Link** (basic navigation):
```javascript
<Link to="/work">
  Work
</Link>
```

### useNavigate Hook

**Location**: StyleguideSidebar.jsx

```javascript
import { useNavigate } from 'react-router-dom'

const navigate = useNavigate()

const handlePrimaryIconClick = (event, item) => {
  if (!isCollapsed) {
    return
  }
  event.preventDefault()
  setIsCollapsed(false)
  if (item.hasChildren) {
    setExpandedItems((prev) => ({ ...prev, [item.id]: true }))
  } else {
    navigate(item.to)  // Programmatic navigation
  }
}
```

**Usage**:
- Programmatic navigation
- Imperative route changes
- Handles collapsed sidebar logic

### useLocation Hook

```javascript
import { useLocation } from 'react-router-dom'

const location = useLocation()
const normalizedPath = location.pathname.replace(/\/$/, '')

// Use in active state calculation
const isActive = normalizedPath === '/styleguide/chess'
```

**Usage**:
- Read current route
- Path normalization
- Conditional rendering based on route

## Active State Calculation

### Pattern in StyleguideSidebar

```javascript
const computeDestination = (node) => {
  if (node.path !== undefined && node.path !== null) {
    return ensureStyleguidePath(node.path)
  }
  if (Array.isArray(node.children) && node.children.length > 0) {
    return computeDestination(node.children[0])
  }
  return '/styleguide'
}

const isNodeActive = (node, normalizedPath) => {
  const destination = computeDestination(node)

  if (normalizedPath === destination) {
    return true
  }

  if (Array.isArray(node.children) && node.children.length > 0) {
    return node.children.some((child) => isNodeActive(child, normalizedPath))
  }

  return normalizedPath.startsWith(`${destination}/`)
}
```

**Logic**:
- Compute destination path from navigation tree
- Check exact match
- Recursively check children
- Check path prefix (for nested routes)

## Scroll Restoration

### Before Route Change

**Location**: `apps/web/src/App.jsx`

```javascript
useEffect(() => {
  const saveScrollPosition = () => {
    sessionStorage.setItem('scrollPosition', window.scrollY.toString())
  }
  window.addEventListener('beforeunload', saveScrollPosition)
  return () => window.removeEventListener('beforeunload', saveScrollPosition)
}, [])
```

**Behavior**:
- Save scroll position before page unload
- Uses `beforeunload` event
- Stores in sessionStorage

### After Route Mount

```javascript
useEffect(() => {
  const savedPosition = sessionStorage.getItem('scrollPosition')
  if (savedPosition) {
    window.scrollTo(0, parseInt(savedPosition, 10))
    sessionStorage.removeItem('scrollPosition')
  }
}, [])
```

**Behavior**:
- Restore scroll position on new route
- Clear from sessionStorage after restore
- Smooth user experience

## Route-Based Features

### Conditional Chrome

```javascript
const hideChrome = location.pathname.startsWith('/styleguide')

{!hideChrome && <Navbar />}
{!hideChrome && <Footer />}
```

**Logic**:
- Hide navbar/footer on `/styleguide/*` routes
- Show chrome on all other routes
- Based on pathname check

### Mobile Dropdown

```javascript
const currentDropdownValue = useMemo(() => {
  const match = dropdownOptions.find((option) => {
    if (option.value === '/styleguide') {
      return normalizedPath === '/styleguide'
    }
    return normalizedPath === option.value || normalizedPath.startsWith(`${option.value}/`)
  })
  return match ? match.value : '/styleguide'
}, [dropdownOptions, normalizedPath])
```

**Behavior**:
- Find current page in dropdown options
- Match exact path or prefix
- Set as selected value

## Related Documentation

- [1.5.0 Navigation System](./1.5.0-navigation-system.md) - Overall architecture
- [1.5.1 Navbar & Footer](./1.5.1-navbar-footer.md) - Site-level navigation
- [5.0.2 Workshop Sidebar](./5.0.2-workshop-sidebar.md) - Sidebar implementation

---

**Router DOM**: The routing layer that connects URLs to components and manages navigation state.
