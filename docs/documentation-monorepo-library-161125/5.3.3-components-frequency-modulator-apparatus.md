# 5.3.3 Workshop: Frequency Modulator Apparatus

**Version:** 1.0
**Date:** 2025-11-04
**Status:** Active
**Content Type:** implementation
**Category:** workshop

---

# Frequency Modulator Apparatus

**Purpose:** Documentation of a sophisticated interactive scientific apparatus with harmonic wave modulation, built with React, GSAP, and advanced sine wave mathematics.

> The Frequency Modulator Apparatus is a complex circular interface that displays project items around a rotating dial with real-time wave distortion effects. This specialized device features multi-layered modulation, dual control modes, and harmonic frequency quantization for seamless wave patterns. It represents the pinnacle of interactive data visualization in the kolkrabbi design system - a scientific instrument transformed into an artistic interface.

## Core Components

### Physical Components (Apparatus Parts)
- **DialRotation.jsx** - Main dial assembly with wave generation and GSAP animations
- **WorkHeroSection.jsx** - Control console with instrument panel and state management
- **Control Panel** - Slider instruments for frequency, intensity, and modulation control

## Technical Architecture

### Three-Layer Modulation System (Wave Physics)

The wave effects are generated through three independent, additive layers of harmonic interference:

1. **Base Layer (Intensity/Frequency Sliders)**
   - Always visible baseline wave
   - Controlled by Intensity and Frequency sliders
   - Two modes: Relative (A) and Absolute (B)

2. **Breathing Layer (Breath Amp Slider)**
   - Continuous sine wave oscillation
   - Pulses amplitude in and out over time
   - Triggers automatic circle separation at peaks

3. **Drag Layer (Interaction-Induced)**
   - Builds up during dial rotation
   - Doubles intensity/frequency each full rotation
   - Eases back to zero after interaction

### Control Console Modes

#### Mode A: Relative Calibration (Default)
- Intensity multiplier: `0.05`
- Frequency multiplier: `0.15`
- Breathing modulation is the primary observable effect
- Sliders provide fine-tuned subtle modulation

#### Mode B: Absolute Control (After Snap)
- Intensity multiplier: `0.1` (2x stronger response)
- Frequency multiplier: `0.2` (1.33x stronger response)
- Sliders provide direct, responsive control
- Breathing modulation operates as overlay

**Mode Switching:**
- Toggle via `[A]` or `[B]` indicators on intensity/frequency controls
- Engage "Snap Controls" to lock into Mode B with preset calibration

## Mathematical Specifications

### Harmonic Frequency Quantization (Seam Elimination)

The apparatus employs advanced mathematical quantization to eliminate visible seams where wave patterns restart. Frequencies are quantized to complete exact harmonic cycles around the circular display:

```javascript
const cyclesPerCircle = Math.round(freq / 10)
const wavePhase = angle * cyclesPerCircle + drift
const waveOffset = amplitude * Math.sin(wavePhase)
```

**Quantization Engagement:**
- **Manual**: Toggle with "Quantize [ON/OFF]" calibration switch on instrument panel
- **Automatic**: Engages when `circleCount > 2` AND `amplitude > 10`
- Ensures seamless phase connection at 0°/360°
- Generates harmonic wave patterns that multiply around the circular display
- Eliminates the "slit scan line" spectral artifact at high frequencies

### Path Generation

Smooth circular paths use quadratic curves with wrapped indices:

```javascript
for (let i = 0; i < numPoints; i++) {
  const current = points[i]
  const next = points[(i + 1) % points.length] // Wrap around
  const midX = (current.x + next.x) / 2
  const midY = (current.y + next.y) / 2
  pathData += ` Q ${current.x},${current.y} ${midX},${midY}`
}
```

## Multi-Circle System

### Temporal Phase Offsets

Each circle pair has a phase offset for organic ripple effects:

```javascript
const pairIndex = Math.floor(index / 2) + 1
const phaseOffset = pairIndex * 15 // Temporal lag
const ampVariation = amp * (1 + (pairIndex * 0.1)) // +10% per pair
const freqVariation = freq * (1 + (pairIndex * 0.05)) // +5% per pair
```

### Dynamic Separation

Circles separate based on three factors:
- **Base offset**: `pairIndex × separationAmount` (fixed distance)
- **Velocity offset**: Drag/throw velocity (dynamic during interaction)
- **Breath separation**: Breathing animation peaks (automatic pulsing)

## Instrument Panel

### Calibration Controls (Sliders)

| Control | Range | Default | Function |
|---------|-------|---------|----------|
| Intensity | 0-400 | 200 | Wave amplitude modulation |
| Frequency | 10-200 | 100 | Wave cycles per revolution |
| Breath Time | 1-10 | 3 | Respiration cycle duration (seconds) |
| Breath Amp | 0-40 | 10 | Breathing modulation intensity |
| Separation | 0-60 | 16 | Orbital distance between circle pairs (px) |
| Global Scale | 0-100 | 50 | Master multiplier for all harmonic effects |
| Global Time | 0-100 | 100 | Temporal velocity (0 = halted) |
| Circles | 1-8 | 1 | Number of orbital circle pairs engaged |

### Calibration Snapshot

The "Snap Controls" lever engages a curated calibration preset:

```javascript
{
  intensity: 362,
  frequency: 100,
  breathDuration: 5,
  breathIntensity: 40,
  separation: 16,
  globalScale: 22,
  globalTime: 100,
  circles: 1,
  controlMode: 'absolute' // Switches to Mode B calibration
}
```

### Auxiliary Controls

**Quantization Switch**
- Control: "Quantize [ON/OFF]"
- Function: Manually engage harmonic frequency quantization
- Application: Eliminates spectral artifacts during high-frequency operations
- Operates independently of automatic quantization threshold

## GSAP Animation Engine

### Motion Timeline Architecture

```javascript
spinRef.current = gsap.timeline({
  repeat: -1,
  defaults: { duration: 50, ease: "none" }
})
  .to(circleRef.current, { rotation: 360 })
  .to(items, { rotation: -360 }, 0) // Counter-rotate pills
  .to(centerContentRef.current, { rotation: -360 }, 0) // Counter-rotate logo
```

### Rotation Control Configuration

- **Control Type**: `rotation`
- **Inertia**: Enabled for throw physics simulation
- **Velocity Response**: Circle separation scales with rotational velocity
- **Phase Tracking**: Accumulates intensity/frequency per complete revolution

### Temporal Velocity Control

Global Time dial governs `timeScale` across all animation subsystems:
- `0`: Complete temporal halt (frozen analysis mode)
- `50`: Half temporal velocity (slow-motion observation)
- `100`: Normal temporal velocity (standard operation)

## Spectral Data Integration

### Theme-Responsive Spectral Signatures

Project SVGs are fetched and processed to use theme colors:

```javascript
const themedSvg = svgText
  .replace(/fill="[^"]*"/g, 'fill="currentColor"')
  .replace(/stroke="[^"]*"/g, 'stroke="currentColor"')
```

SVGs are cached in `svgCacheRef` for instant display on subsequent hovers.

### Spectral Signature Schema

New `svg` field in project spectral database schema:

```typescript
defineField({
  name: 'svg',
  title: 'Spectral Signature',
  type: 'file',
  group: 'media',
  options: { accept: '.svg' }
})
```

## Performance Optimization Protocols

### Reference-Based State Management

All dynamic instrument values utilize refs to prevent render cascades:
- `globalScaleRef`, `globalTimeRef`, `separationAmountRef`
- `maxIntensityRef`, `maxFrequencyRef`
- `controlModeRef`

Instrument readings are synchronized to refs on each operational cycle:

```javascript
globalScaleRef.current = globalScale
```

### Wave Path Caching

Circle paths are stored in refs and updated in-place:
- `circlePathRef` - Main circle
- `circlePathsRef` - Array of additional circles

No DOM recreation, only path `d` attribute updates.

## Operational Manual

### Apparatus Deployment

```jsx
<DialRotation
  projects={projects}
  maxIntensity={200}
  maxFrequency={100}
  breathDuration={3}
  breathIntensity={10}
  separationAmount={16}
  globalScale={50}
  globalTime={100}
  circleCount={1}
  controlMode="relative"
/>
```

## Operational Protocols

1. **Spectral Analysis Mode**: Hover over project node to display theme-responsive SVG signature in central viewport
2. **Data Navigation**: Click project node to navigate to detailed analysis page
3. **Rotational Interaction**: Drag/spin dial assembly to accumulate wave intensity and frequency harmonics
4. **Calibration Mode Toggle**: Engage mode selector to switch between [A] relative and [B] absolute control protocols
5. **Preset Calibration**: Activate "Snap Controls" to apply curated preset and engage Mode B calibration
6. **Temporal Freeze**: Adjust Global Time to 0 to halt all motion for detailed wave pattern analysis

## Expansion Modules

**Future Enhancement Capabilities:**
- Additional calibrated preset libraries
- Waveform synthesis selection (triangle, square, sawtooth harmonics)
- Audio-reactive modulation inputs
- Instrument calibration export/import protocols
- Animation sequence recording/playback systems
- Velocity-based chromatic spectral shifts
- Multi-axis wave pattern generation (radial + tangential interference)

## Scientific Lineage

**Research Foundation:** GSAP ScrollWave demonstration apparatus
**Development Method:** Iterative scientific exploration and mathematical validation
**Implementation:** Kolkrabbi design system advanced instrumentation division

Developed through collaborative research and experimental validation by the Kolkrabbi scientific team.

## Design System Classification

**Category:** Specialized Scientific Apparatus
**Complexity Tier:** Advanced Instrumentation (beyond atomic design hierarchy)
**Technical Dependencies:** React, GSAP, SVG, advanced mathematical computation
**Primary Application:** Interactive data visualization and spectral analysis for Work showcases

### Instrumentation Hierarchy

The Frequency Modulator Apparatus exists beyond traditional UI component classification:

**Standard Design System:**
- **Atoms** = Fundamental interface elements
- **Molecules** = Combined functional units
- **Organisms** = Complex interactive systems

**Advanced Apparatus:**
- **Scientific Instruments** = Complex devices combining multiple technical systems

This apparatus represents the upper bounds of web-based interactive data visualization, mathematical wave generation, and real-time harmonic interference. It functions as a "super-organism" - a complete scientific instrument rather than a composable UI component.

## Related Documentation

**Component Documentation:**
- [3.0.0 Components: Overview](3.0.0-design-system-components.md) - Atomic design methodology foundation
- [3.1.0 Components: Atoms](3.1.0-design-system-atoms.md) - Standard building blocks
- [3.2.0 Components: Molecules](3.2.0-design-system-molecules.md) - Combined components
- [3.3.0 Components: Organisms](3.3.0-design-system-organisms.md) - Complex systems

**System Architecture:**
- [2.0.0 Design System: Overview](2.0.0-design-system-overview.md) - Core design principles
- [2.3.0 Design System: CSS Architecture](2.3.0-design-system-css-architecture.md) - Styling protocols

**Technology Stack References:**
- GSAP Animation Platform - Core motion orchestration engine
- SVG Path Generation - Mathematical wave synthesis framework
- React Reference Architecture - Performance optimization protocols

---

**Apparatus Specifications:**
- **Primary Assembly:** `apps/web/src/components/Work/DialRotation.jsx`
- **Control Console:** `apps/web/src/components/Work/WorkHeroSection.jsx`
- **Technical Documentation:** `/docs/documentation/5.3.3-components-frequency-modulator-apparatus.md`

---

**Last Calibrated:** 2025-11-04
**Cross-References:** 3.0.0, 3.1.0, 3.2.0, 3.3.0, 2.0.0, 2.3.0
**Classification:** Advanced Scientific Apparatus
**Operational Status:** Active & Fully Instrumented
