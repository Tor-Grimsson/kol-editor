# Font Loading Strategy Audit

**Document ID**: 0.3.2
**Parent**: [0.3.0-performance.md](./0.3.0-performance.md)
**Date**: 2025-11-15
**Status**: Not Started
**Category**: Performance - Font Optimization

---

## Objective

Optimize font loading to minimize FOUT (Flash of Unstyled Text), FOIT (Flash of Invisible Text), and layout shifts while delivering custom typefaces efficiently.

---

## Current Font Inventory

**Design System Fonts:**
- Right Grotesk Narrow (condensed) - Content headings
- Right Grotesk Tight (extra-condensed) - Display headings
- Right Grotesk Compact - Condensed body
- Inter Tight - Standard body copy
- Right Grotesk Mono (Fine 100, Medium 470) - Code/labels

**Product Fonts (Specimens Only):**
- TGMalromur
- TGRoot
- TGTrollatunga
- TGDylgjur
- TGGullhamrar
- TGSilfurbarki
- TGOrdspor

**Expected Location:**
- `apps/web/public/fonts/`

---

## Audit Checklist

### Inventory & Analysis
- [ ] List all font files and sizes
- [ ] Identify which fonts are critical (above-the-fold)
- [ ] Determine which fonts are specimen-only
- [ ] Calculate total font payload
- [ ] Check for unused font weights/styles

### Current Implementation Review
- [ ] Review font-face declarations in theme.css
- [ ] Check font loading strategy (swap/block/optional)
- [ ] Analyze FOUT/FOIT behavior
- [ ] Measure layout shift from font loading
- [ ] Test font loading on slow connections

### Performance Metrics
- [ ] Time to first font paint
- [ ] Number of font requests
- [ ] Total font payload size
- [ ] Cache effectiveness
- [ ] Cumulative Layout Shift (CLS) impact

---

## Current Strategy Analysis

**Font-Face Declaration Pattern:**
```css
/* Expected in packages/ui/theme.css */
@font-face {
  font-family: 'Right Grotesk Narrow';
  src: url('/fonts/RightGrotesk-*.woff2') format('woff2');
  font-weight: 500;
  font-display: ???; /* To be verified */
}
```

**Key Questions:**
1. What `font-display` value is currently used?
2. Are fonts preloaded in index.html?
3. Are fonts subseted or full character sets?
4. Are variable fonts used where appropriate?
5. Is font loading async or blocking?

---

## Optimization Strategies

### Quick Wins

1. **Font Display Optimization**
   ```css
   /* Recommended: */
   font-display: swap; /* Show fallback, swap when loaded */

   /* Alternatives: */
   font-display: optional; /* Use only if loads fast */
   font-display: fallback; /* Short block, then swap */
   ```

2. **Preload Critical Fonts**
   ```html
   <!-- In index.html -->
   <link rel="preload"
         href="/fonts/RightGroteskNarrow-Medium.woff2"
         as="font"
         type="font/woff2"
         crossorigin>
   ```

3. **Font Subsetting**
   - Latin character set only (if no special glyphs needed)
   - Remove unused weights/styles
   - Consider variable fonts for weight range

### Medium Impact Optimizations

1. **Variable Fonts**
   - Replace multiple weight files with variable font
   - Right Grotesk might have variable version
   - Reduces number of requests

2. **Lazy Load Specimen Fonts**
   ```javascript
   // Load TG* fonts only on specimen routes
   if (route.includes('/specimen/')) {
     loadSpecimenFonts()
   }
   ```

3. **Font Loading API**
   ```javascript
   // Progressive enhancement
   document.fonts.load('500 16px "Right Grotesk Narrow"')
     .then(() => {
       document.body.classList.add('fonts-loaded')
     })
   ```

### Advanced Optimizations

1. **Self-Hosted Font CDN**
   - Serve fonts from same domain (no CORS)
   - Add far-future caching headers
   - Use HTTP/2 push (if applicable)

2. **WOFF2 Compression**
   - Verify all fonts are WOFF2 format
   - 30% smaller than WOFF
   - Supported by all modern browsers

3. **Critical CSS with Font Fallbacks**
   ```css
   /* System font stack fallback */
   font-family: 'Right Grotesk Narrow',
                -apple-system,
                BlinkMacSystemFont,
                'Segoe UI',
                sans-serif;
   ```

---

## Font Loading Patterns

### Pattern 1: Block (Default)
**Pros:** No FOUT
**Cons:** Invisible text during load (FOIT)

### Pattern 2: Swap (Recommended)
**Pros:** Text always visible
**Cons:** Layout shift when font loads

### Pattern 3: Optional
**Pros:** No layout shift if slow
**Cons:** May never use custom font

### Pattern 4: Preload + Swap
**Pros:** Faster load, still visible
**Cons:** Extra request, complexity

---

## Testing Scenarios

**Test Conditions:**
1. Fast 3G (750 Kbps)
2. Slow 3G (400 Kbps)
3. Cache disabled
4. First visit vs. repeat visit

**Metrics to Capture:**
- Time to text visible
- Time to custom font applied
- Layout shift amount
- User perception (does it feel fast?)

---

## Recommendations Template

**To be filled during audit:**

### Critical Issues
- TBD

### Font Display Strategy
- Recommended setting: TBD
- Reasoning: TBD

### Preload Candidates
- TBD

### Subsetting Opportunities
- TBD

### Lazy Loading Plan
- TBD

---

## Implementation Checklist

**Phase 1: Quick Wins**
- [ ] Update font-display to optimal value
- [ ] Add preload for critical fonts
- [ ] Remove unused font weights
- [ ] Test on slow connection

**Phase 2: Medium Optimizations**
- [ ] Implement font subsetting
- [ ] Lazy load specimen fonts
- [ ] Add font loading detection
- [ ] Optimize fallback stack

**Phase 3: Advanced (Optional)**
- [ ] Investigate variable fonts
- [ ] Implement font loading API
- [ ] Add font caching strategy
- [ ] Progressive enhancement

---

## Expected Outcomes

**Before Optimization:**
- Total font size: TBD
- Number of font files: TBD
- CLS from fonts: TBD
- Load time: TBD

**After Optimization:**
- Total font size: Target <200KB
- Number of font files: Minimize
- CLS from fonts: <0.1
- Load time: <500ms on 3G

---

## Related Files

**Font Definitions:**
- `packages/ui/theme.css` - @font-face declarations
- `packages/ui/css/components.css` - Typography classes

**Font Assets:**
- `apps/web/public/fonts/` - Font files

**Configuration:**
- `apps/web/index.html` - Preload links
- `vite.config.js` - Build optimization

---

**Audit Date**: TBD
**Status**: Not Started
