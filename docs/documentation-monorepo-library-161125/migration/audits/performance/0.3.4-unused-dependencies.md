# Unused Dependencies Audit

**Document ID**: 0.3.4
**Parent**: [0.3.0-performance.md](./0.3.0-performance.md)
**Date**: 2025-11-15
**Status**: Not Started
**Category**: Performance - Dependency Cleanup

---

## Objective

Identify and remove unused dependencies from the monorepo to reduce node_modules size, improve install times, and eliminate potential security vulnerabilities.

---

## Audit Checklist

### Setup
- [ ] Install depcheck: `yarn add -D depcheck`
- [ ] Install npm-check-updates: `yarn add -D npm-check-updates`
- [ ] Review all package.json files in monorepo
- [ ] Document current dependency count

### Analysis Tasks
- [ ] Run depcheck on all workspaces
- [ ] Identify unused dependencies
- [ ] Identify unused devDependencies
- [ ] Find dependencies only used in tests
- [ ] Check for duplicate versions across workspaces
- [ ] Review peer dependencies
- [ ] Identify outdated packages

### Workspace Scope
- [ ] `apps/web` - Main web application
- [ ] `packages/ui` - UI component library
- [ ] `packages/chess-data` - Chess data package
- [ ] `packages/fontviewer` - Font viewer package
- [ ] Root workspace - Monorepo tools

---

## Analysis Tools

### Depcheck

```bash
# Run in each workspace
cd apps/web && npx depcheck

# Check all workspaces
yarn workspaces foreach run depcheck
```

**Depcheck Output Categories:**
- Unused dependencies
- Unused devDependencies
- Missing dependencies (imported but not listed)

### Manual Grep Analysis

```bash
# Find import statements for a package
grep -r "from 'package-name'" apps/web/src

# Check if used in any workspace
grep -r "package-name" apps packages --include="*.js" --include="*.jsx"
```

### Package Size Check

```bash
# Check installed size
du -sh node_modules/*

# List largest packages
du -sh node_modules/* | sort -hr | head -20
```

---

## Common Unused Dependencies

**Typical Candidates for Removal:**

1. **Development Tools No Longer Used**
   - Old testing libraries
   - Deprecated linters
   - Unused build tools
   - Redundant formatters

2. **Superseded Libraries**
   - Moment.js (if replaced with date-fns)
   - Lodash (if using native methods)
   - Old UI libraries
   - Deprecated polyfills

3. **Accidentally Installed**
   - Test packages
   - Example dependencies
   - Duplicate utilities

4. **Built-in Alternatives Available**
   - Native fetch (vs. axios)
   - Native promises (vs. bluebird)
   - ES modules (vs. CommonJS helpers)

---

## Workspace Analysis

### apps/web

**Expected Large Dependencies:**
- react, react-dom
- react-router-dom
- @kol/ui, @kol/chess-data
- @sanity/client
- pixi.js

**Potential Unused:**
- To be identified

### packages/ui

**Expected Dependencies:**
- React (peer dependency)
- Icon libraries
- Utility functions

**Potential Unused:**
- To be identified

### packages/chess-data

**Expected Dependencies:**
- CSV parsing
- Data processing utilities

**Potential Unused:**
- To be identified

---

## Safe Removal Guidelines

### Before Removing

1. **Search Codebase**
   ```bash
   # Check all usage
   grep -r "package-name" . --exclude-dir=node_modules
   ```

2. **Check Import Statements**
   - Named imports
   - Default imports
   - Dynamic imports
   - Type-only imports (TypeScript)

3. **Verify Test Usage**
   - Some packages only used in tests
   - Consider moving to devDependencies

4. **Check Config Files**
   - vite.config.js
   - .eslintrc
   - Other config may reference packages

### Removal Process

1. **Remove from package.json**
   ```bash
   yarn remove package-name
   ```

2. **Run Tests**
   ```bash
   yarn test
   ```

3. **Run Build**
   ```bash
   yarn build
   ```

4. **Manual Verification**
   - Check main features
   - Navigate critical routes
   - Test interactive components

---

## Dependency Categories

### Keep (Critical)
- React ecosystem
- Routing
- State management (if used)
- UI framework (@kol/ui)
- API client (Sanity)

### Review (Potential Removal)
- Utility libraries (check if used)
- Date/time libraries (lightweight alternatives?)
- Icon libraries (subset needed?)
- Polyfills (still needed for target browsers?)

### Remove (Unused)
- To be identified during audit

---

## Findings Template

**To be filled during audit:**

### apps/web

**Unused Dependencies:**
- TBD

**Unused DevDependencies:**
- TBD

**Can Be Replaced:**
- TBD

**Total Savings:**
- Package count: TBD
- Install size: TBD

### packages/ui

**Unused Dependencies:**
- TBD

**Unused DevDependencies:**
- TBD

**Total Savings:**
- Package count: TBD
- Install size: TBD

### Other Workspaces

**Findings:**
- TBD

---

## Version Consistency Check

### Duplicate Versions Across Workspaces

```bash
# Find packages with multiple versions
yarn info --all --recursive

# Check specific package versions
yarn why package-name
```

**Common Issues:**
- React versions mismatch
- Different utility library versions
- Incompatible peer dependencies

**Resolution:**
- Align versions in root package.json
- Use workspace protocol: `workspace:*`
- Update to latest compatible version

---

## Outdated Packages

### Check for Updates

```bash
# Check all workspaces
yarn outdated

# Interactive update
npx npm-check-updates -i
```

**Update Strategy:**
1. Patch updates: Safe to auto-update
2. Minor updates: Review changelog
3. Major updates: Test thoroughly
4. Breaking changes: Defer if low priority

---

## Security Audit

### Vulnerability Check

```bash
# Audit dependencies
yarn audit

# Auto-fix (if safe)
yarn audit fix
```

**Review:**
- High/Critical vulnerabilities
- Transitive dependency issues
- Outdated packages with known CVEs

---

## Implementation Checklist

**Phase 1: Analysis (1 hour)**
- [ ] Run depcheck on all workspaces
- [ ] Document unused dependencies
- [ ] Categorize by risk/benefit
- [ ] Calculate potential savings

**Phase 2: Safe Removals (30 min)**
- [ ] Remove clearly unused packages
- [ ] Test after each removal
- [ ] Verify builds succeed
- [ ] Document removals

**Phase 3: Version Alignment (30 min)**
- [ ] Identify version conflicts
- [ ] Align to latest compatible
- [ ] Update workspace references
- [ ] Test monorepo integrity

**Phase 4: Cleanup (15 min)**
- [ ] Remove unused devDependencies
- [ ] Clear yarn cache
- [ ] Regenerate lockfile
- [ ] Document final state

---

## Expected Outcomes

**Before Cleanup:**
- Total dependencies: TBD
- node_modules size: TBD
- Install time: TBD

**After Cleanup:**
- Total dependencies: -15-20%
- node_modules size: -10-15%
- Install time: -10-20%
- Security vulnerabilities: 0 high/critical

---

## Maintenance Strategy

### Ongoing Practices

1. **Regular Audits**
   - Monthly dependency review
   - Quarterly deep audit
   - Remove before adding new

2. **Before Adding Dependencies**
   - Check if native solution exists
   - Evaluate bundle size impact
   - Consider tree-shakability
   - Review maintenance status

3. **Update Cadence**
   - Security: Immediate
   - Patch: Weekly
   - Minor: Monthly
   - Major: Quarterly (planned)

---

## Related Tools

**Dependency Management:**
- [depcheck](https://github.com/depcheck/depcheck)
- [npm-check-updates](https://github.com/raineorshine/npm-check-updates)
- [bundlephobia](https://bundlephobia.com/) - Check package sizes

**Security:**
- [Snyk](https://snyk.io/)
- [npm audit](https://docs.npmjs.com/cli/v8/commands/npm-audit)
- [Dependabot](https://github.com/dependabot) - Automated updates

---

**Audit Date**: TBD
**Status**: Not Started
