# 4.5.6 Foundry Typeface Library

## Overview

Enhanced typeface library interface with variable font preview capabilities, multi-axis filtering, and intelligent text clipping. Built on top of the unified ContentFilters system to provide a comprehensive browsing experience for Kolkrabbi's type collection.

**Date**: 2025-11-15

## Main Components

### FoundryTypefaces Page

**Location**: `apps/web/src/routes/foundry/FoundryTypefaces.jsx`

**Purpose**: Main landing page for browsing all typefaces with filtering capabilities

**Key Features**:
- OverviewHero with badge, title, and category pills
- FeaturedItemsCarousel with typeface previews and background images
- TypefaceLibraryGridWithVariables for browsing with filters
- Variable font weight/axis exploration
- Two-column filter layout
- List and card view modes
- Coming Soon section for in-development typefaces

**Components Used**:
- `OverviewHero` - Hero section
- `FeaturedItemsCarousel` - Featured typefaces with images
- `TypefaceLibraryGridWithVariables` - Main filtering grid
- `FoundryCTA` - Bottom call-to-action

### TypefaceLibraryGridWithVariables

**Location**: `apps/web/src/components/sections/foundry/TypefaceLibraryGridWithVariables.jsx`

**Purpose**: Enhanced grid component with typeface-specific filtering and variable font preview

**Key Features**:

1. **Filter Modes**:
   - Default: Shows all typefaces with standard TypefaceLibraryItem cards
   - By Typeface: When a typeface is selected, shows TypefaceVariablePreview for each weight/variant
   - By Axes: When multi-axis typeface selected (e.g., TG Rót), shows additional Axes filter

2. **Dynamic Filter Groups**:
   - Classification (Serif, Sans Serif, Display, Monospace)
   - Styles (Variable (wght, slnt), Variable (wght, wdth), Regular, etc.)
   - Typefaces (TG Málrómur, TG Rót, TG Gullhamrar, etc.)
   - Axes (wght, wdth) - only appears for multi-axis typefaces

3. **Filter Behavior**:
   - Typeface filter is mutually exclusive (only one typeface at a time)
   - Axes filter is additive (can select multiple axes)
   - Classification and Styles are standard filters

4. **View Modes**:
   - Card view: 4-column grid (`lg:grid-cols-4`)
   - List view: Stacked horizontal items with full alphabet preview

**Props**:
```javascript
{
  typefaces: Array,        // Array of typeface objects
  typefaceWeights: Object, // Map of typeface names to weight arrays
  totalCount: Number       // Total count of typefaces
}
```

**Weight Data Structure**:
```javascript
typefaceWeights = {
  'TG Málrómur': [
    { weight: 'Light', value: 200, axis: 'wght' },
    { weight: 'Regular', value: 300, axis: 'wght' },
    // ...
  ],
  'TG Rót': [
    // Weight axis
    { weight: 'Light', value: 200, axis: 'wght' },
    { weight: 'Regular', value: 400, axis: 'wght' },
    // Width axis
    { weight: 'Narrow', value: 75, axis: 'wdth' },
    { weight: 'Normal', value: 100, axis: 'wdth' },
    // ...
  ]
}
```

### TypefaceLibraryItem

**Location**: `apps/web/src/components/sections/foundry/TypefaceLibraryItem.jsx`

**Purpose**: Displays individual typeface in card or list format with intelligent text clipping

**Variants**:

1. **Card View**:
   - Vertical layout with "Ðð" preview
   - Hover shows pangram sentence
   - Background: `bg-surface-primary`
   - Hover: `bg-surface-inverse`
   - Height: 500px fixed

2. **List View**:
   - Compact horizontal layout
   - Left: Typeface name and styles
   - Right: Classification and year
   - Bottom: Alphabet preview with intelligent clipping
   - Font family: PP Right Grotesk Mono for metadata
   - Preview size: 48px

**Text Clipping Logic**:
- Uses binary search algorithm (similar to DisplaySpecimen)
- Measures actual rendered text width using `scrollWidth`
- Clips text 40px before card edge (inset clipping)
- Responsive to window resize
- Preserves glyph overhangs (important for italics)

**Implementation**:
```javascript
// Binary search to find max characters that fit
const calculateClipping = () => {
  const availableWidth = container.clientWidth - 40 // 40px inset
  const chars = fullAlphabet.split('')
  let clippedText = ''

  let low = 0
  let high = chars.length

  while (low <= high) {
    const mid = Math.floor((low + high) / 2)
    const testText = chars.slice(0, mid).join('')
    textElement.textContent = testText

    const textWidth = textElement.scrollWidth

    if (textWidth <= availableWidth) {
      clippedText = testText
      low = mid + 1
    } else {
      high = mid - 1
    }
  }

  setVisibleText(clippedText)
}
```

### TypefaceVariablePreview

**Location**: `apps/web/src/components/sections/foundry/TypefaceVariablePreview.jsx`

**Purpose**: Interactive preview for individual weight/variant with controls

**Variants**:

1. **List View** (Default):
   - Interactive sliders for Size, Leading, Spacing
   - Editable preview text field
   - Displays typeface name with weight variant
   - Real-time font rendering with selected weight value

2. **Card View**:
   - Static information display
   - Shows metrics (classification, weight, status, year)
   - Typography metrics placeholder (baseline, x-height, etc.)

**Controls**:
- Size slider: 12-200px
- Leading slider: 0-50 (maps to 90-140%)
- Spacing slider: -50 to +50px

**Default Text**: "Rennimjúkt eðal flauel, duft slæðist, silkislaufa"

## ContentFilters Component

**Location**: `packages/ui/src/organisms/filters/ContentFilters.jsx`

**Purpose**: Universal filter component used across content grids

**Key Features**:

1. **Two-Column Filter Layout**:
   - Left column: First 2 filter groups (Classification, Styles)
   - Right column: Remaining filter groups (Typefaces, Axes)
   - Responsive: Single column on mobile, two columns on desktop

2. **Mutually Exclusive Filters**:
   - Configured via `mutuallyExclusiveFilters` prop
   - Only one value can be active at a time per filter type
   - Example: Only one typeface can be selected

3. **Custom Filter Keys**:
   - Some filters handled by parent's renderItem instead of internal filtering
   - Configured via `customFilterKeys` prop
   - Example: Axes filter operates on nested weight data

4. **View Mode Toggle**:
   - Optional view mode switcher
   - Configurable options (card/list)
   - Callbacks for filter and view mode changes

**Props**:
```javascript
{
  items: Array,
  title: String,
  totalCount: Number,
  filterGroups: Array,           // [{label, key, values}, ...]
  renderItem: Function,           // (items, mode) => ReactNode
  viewModeOptions: Array,         // Optional
  defaultViewMode: String,        // Default: 'list'
  onFilterChange: Function,       // Optional callback
  mutuallyExclusiveFilters: Array,// Filter keys with single selection
  customFilterKeys: Array         // Filter keys handled by renderItem
}
```

**Styling Consistency**:
- Divider spacing: `<Divider className="mb-4" />` (matches CollectionFilters)
- Filter expansion: mb-4 for "Filter Collection" header
- Two-column grid: `gap-8` between columns

## Typeface Data Structure

**Location**: `apps/web/src/routes/foundry/FoundryTypefaces.jsx`

```javascript
{
  name: 'TG Málrómur',
  subtitle: 'Variable Italic Serif',
  description: 'A contemporary italic variable font for editorial design',
  classification: 'Serif',
  status: 'Available',
  year: '2025',
  styles: 'Variable (wght, slnt)',
  link: '/foundry/malromur',
  specimens: [
    { name: 'Variable Axis', link: '/specimen/two' },
    { name: 'Prose Styles', link: '/specimen/prose' }
  ]
}
```

## Featured Typefaces Carousel

**Configuration**:
- Shows first 4 typefaces with specimen images
- Auto-rotation: 5 seconds
- Large type display overlaying specimen image
- Background images at 20% opacity
- Responsive font sizes for longer names

**Image Paths**:
- `/img/typefaces/malromur/set-a-01.png`
- `/img/typefaces/rot/set-g-01.png`
- `/img/typefaces/trollatunga/set-c-01.png`
- `/img/typefaces/dylgjur/set-b-01.png`
- `/img/typefaces/gullhamrar/set-f-01.png`

## Technical Implementation

### Multi-Axis Support

**TG Rót Example**:
- Has both weight (wght) and width (wdth) axes
- When selected, Axes filter appears dynamically
- Can filter by single axis or multiple axes
- Weights array includes both axis types

### Filter Architecture

1. **Parent Component** (TypefaceLibraryGridWithVariables):
   - Manages activeFilters state
   - Detects selected typeface
   - Dynamically generates filter groups
   - Handles axis filtering in renderItems

2. **ContentFilters Component**:
   - Renders filter UI with two-column layout
   - Handles internal filtering for standard keys
   - Skips customFilterKeys (handled by parent)
   - Enforces mutually exclusive behavior

3. **Filter Flow**:
   ```
   User clicks filter
   → ContentFilters toggleFilter
   → Calls onFilterChange callback
   → Parent updates activeFilters
   → Parent's renderItems filters by custom keys
   → ContentFilters' filteredItems filters by standard keys
   → Combined result rendered
   ```

### Text Clipping Algorithm

**Binary Search Approach**:
1. Get container width minus inset (40px)
2. Split full alphabet into character array
3. Binary search to find max characters that fit:
   - Test middle point of range
   - Measure actual rendered width
   - Adjust range based on fit
4. Set visible text to clipped result
5. Recalculate on resize

**Benefits**:
- Efficient O(log n) performance
- Accurate width measurement
- Preserves character boundaries
- Responsive to font metrics

## UI/UX Details

### List View Styling

**Typeface Metadata**:
- Font: PP Right Grotesk Mono
- Name: text-base, uppercase, tracking-wide
- Styles/Year: text-xs, opacity-60, tracking-tight
- Classification: text-base, tracking-wide (no uppercase)

**Preview Text**:
- Size: 48px fixed
- Leading: 52px
- Letter spacing: 0 (tight within pairs)
- Alphabet: "Aa Bb Cc Dd..." (physical spaces)
- No line breaks: `whitespace-nowrap`
- Clipping: 40px inset from right

### Card View Styling

**Default State**:
- Background: `bg-surface-primary`
- Border: `border-fg-64`
- Preview: Large "Ðð" at bottom
- Details at top with name and styles

**Hover State**:
- Background: `bg-surface-inverse`
- Shows full pangram sentence
- Details fade out (opacity-0)
- Smooth transitions (duration-300)

## Routes

| Route | Component | Description |
|-------|-----------|-------------|
| `/foundry/typefaces` | FoundryTypefaces | Main typeface library with filtering |

## Related Documentation

- [4.5.0 Foundry Pages](./4.5.0-foundry-pages.md) - Foundry overview
- [4.3.0 Content Showcase Architecture](./4.3.0-content-showcase-architecture.md) - Filter system architecture
- [4.4.0 Collections](./4.4.0-collections.md) - CollectionFilters comparison

## Key Decisions

1. **Mutually Exclusive Typeface Filter**: Only one typeface can be selected at a time because showing multiple typefaces simultaneously would be confusing in variable preview mode.

2. **Dynamic Axes Filter**: The Axes filter only appears when needed (multi-axis typeface selected) to avoid cluttering the UI when not relevant.

3. **Binary Search Clipping**: Using binary search for text clipping provides efficient, accurate results that respond to actual font metrics rather than approximation.

4. **Two-Column Filter Layout**: Splits filters into logical groups (Classification/Styles vs Typefaces/Axes) for better visual organization and horizontal space usage.

5. **40px Inset Clipping**: Creates a visual fade effect by clipping text before the card edge, improving readability and aesthetics.

6. **Card Background Change**: Using `bg-surface-primary` instead of `bg-container-primary` for better visual consistency with page background.

## Future Enhancements

- Individual typeface detail pages with full specimen
- Variable font playground with real-time axis manipulation
- Font download functionality with licensing integration
- Typography metrics display (x-height, baseline, etc.)
- Character set exploration (alternates, ligatures)
- OpenType features showcase
- Side-by-side typeface comparison
- Custom text preview with user input
