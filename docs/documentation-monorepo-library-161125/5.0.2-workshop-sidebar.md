# 5.0.2 Workshop Sidebar

> Dedicated navigation component for the workshop application (formerly styleguide sidebar).

## Overview

The workshop sidebar is a sophisticated navigation component that consumes the navigation data tree, provides interactive controls, and manages its own state for expand/collapse functionality.

**Location**: `apps/web/src/components/workshop/layout/WorkshopSidebar.jsx`

## Navigation Data

**Source**: `apps/web/src/data/styleguide/navigation.js`

```javascript
export const STYLEGUIDE_ROUTES = [
  {
    id: 'styleguide',
    label: 'Design System',
    path: '/styleguide',
    children: [
      { id: 'introduction', label: 'Introduction', path: 'introduction' },
      { id: 'documentation', label: 'Documentation', path: 'docs' }
    ]
  },
  {
    id: 'chess',
    label: 'Chess',
    path: 'chess',
    icon: 'chess-pawn',
    children: [
      { id: 'overview', label: 'Overview', path: 'chess/overview', icon: 'chess-pawn' },
      { id: 'apparatus', label: 'Apparatus', path: 'chess/apparatus' }
    ]
  }
]
```

## Icon Resolution

### ICON_MAP

```javascript
const ICON_MAP = {
  'styleguide': 'styleguide',
  foundations: 'foundation',
  components: 'component',
  apparatus: 'interactive'
}
```

### resolveIconName

```javascript
const resolveIconName = (route) => {
  if (route.icon) return route.icon                    // Explicit icon in data
  return ICON_MAP[route.id] ?? 'arrow-downright'        // Mapped or default
}
```

**Priority**:
1. Explicit `icon` property on route
2. Mapped icon from `ICON_MAP`
3. Default: `'arrow-downright'`

## Path Resolution

### ensureStyleguidePath

```javascript
const ensureStyleguidePath = (path = '') => {
  if (!path) return '/styleguide'
  return path.startsWith('/styleguide') ? path : `/styleguide/${path}`
}
```

Ensures all paths are prefixed with `/styleguide` for proper routing.

### computeDestination

```javascript
const computeDestination = (node) => {
  if (!node) return '/styleguide'
  if (node.path !== undefined && node.path !== null) {
    return ensureStyleguidePath(node.path)
  }
  if (Array.isArray(node.children) && node.children.length > 0) {
    return computeDestination(node.children[0])
  }
  return '/styleguide'
}
```

**Logic**:
- Has explicit path → use that path
- No path but has children → use first child's path
- Neither → default to `/styleguide`

## Active State

### isNodeActive

```javascript
const isNodeActive = (node, normalizedPath) => {
  const destination = computeDestination(node)

  if (node.id === 'styleguide') {
    return normalizedPath === '/styleguide'
  }

  if (normalizedPath === destination) {
    return true
  }

  if (Array.isArray(node.children) && node.children.length > 0) {
    return node.children.some((child) => isNodeActive(child, normalizedPath))
  }

  return normalizedPath.startsWith(`${destination}/`)
}
```

**Rules**:
1. Root styleguide path (`/styleguide`) only matches exactly
2. Exact path match → active
3. Has children → check children recursively
4. Path prefix match (`/styleguide/chess` matches `/styleguide/chess/overview`)

### findActiveGroup

```javascript
const findActiveGroup = () =>
  STYLEGUIDE_ROUTES.find((route) => {
    const destination = computeDestination(route)
    if (normalizedPath === destination) {
      return true
    }

    return route.children?.some((child) => {
      const fullPath = `/styleguide/${child.path}`
      return normalizedPath === fullPath || normalizedPath.startsWith(`${fullPath}/`)
    })
  })
```

Finds the currently active top-level navigation group.

## State Management

### Props

```javascript
const StyleguideSidebar = ({
  isCollapsed,         // Boolean: collapsed state
  setIsCollapsed,      // Function: toggle collapsed
  expandedItems,       // Object: { [groupId]: boolean }
  setExpandedItems     // Function: update expanded state
}) => {
```

### Auto-Expand Active Group

```javascript
useEffect(() => {
  if (!activeGroup) return
  const destination = computeDestination(activeGroup)
  if (normalizedPath === destination) return

  setExpandedItems((prev) => {
    if (prev[activeGroupId]) return prev
    return { ...prev, [activeGroupId]: true }
  })
}, [activeGroup, activeGroupId, normalizedPath, setExpandedItems])
```

**Behavior**:
- When route changes to a child page
- Auto-expand the parent group
- Don't expand if already on parent page

### Collapsed State

```javascript
const toggleSidebar = () => {
  setIsCollapsed((prev) => {
    const next = !prev
    if (next) {
      // Collapse: save expanded state
      lastExpandedRef.current = expandedItems
      setExpandedItems({})
    } else {
      // Expand: restore expanded state
      setExpandedItems(lastExpandedRef.current || {})
    }
    return next
  })
}
```

**State Preservation**:
- Save expanded items when collapsing
- Restore when expanding
- Prevents lost state during collapse/expand

## Rendering

### Collapsed Mode (96px)

```javascript
{isCollapsed ? (
  <div className="flex w-[96px] flex-col items-center">
    <Link to="/">
      <Logomark className="h-10 w-10" />
    </Link>

    <nav className="flex flex-col items-center gap-3">
      {primaryIcons.map((item) => (
        <Link to={item.to}>
          <Icon name={item.icon} size={18} />
        </Link>
      ))}
    </nav>

    <ThemeToggleButton variant="compact" />
  </div>
) : (
  // Expanded mode (304px)
)}
```

**Features**:
- Compact 96px width
- Icons only (no labels)
- Logomark instead of wordmark
- Primary navigation icons
- Compact theme toggle

### Expanded Mode (304px)

```javascript
{!isCollapsed && (
  <div className="flex w-[304px] flex-col">
    <div className="flex items-center justify-between">
      <Link to="/">
        <Wordmark className="h-6 w-auto" />
      </Link>
      <button onClick={toggleSidebar}>
        <Icon name="chevron-right" size={16} />
      </button>
    </div>

    <div className="space-y-3 mt-8">
      <Link to="/styleguide" className="inline-flex text-[48px]">
        Styleguide
      </Link>
      <p className="kol-mono-text text-[14px] text-fg-48">
        Tokens, components, and live previews.
      </p>
    </div>

    <nav className="flex flex-col gap-2">
      {STYLEGUIDE_ROUTES.map((route) => renderFlexNode(route))}
    </nav>
  </div>
)}
```

**Features**:
- Full 304px width
- Wordmark branding
- Large "Styleguide" title
- Description text
- Tree navigation with expand/collapse

### renderFlexNode (Recursive Tree)

```javascript
const renderFlexNode = (node, depth = 0) => {
  const hasChildren = Array.isArray(node.children) && node.children.length > 0
  const destination = computeDestination(node)
  const isActive = isNodeActive(node, normalizedPath)
  const indentStyle = depth ? { marginInlineStart: `${depth * 24}px` } : undefined
  const isExpanded = hasChildren ? Boolean(expandedItems[node.id]) : false

  // Parent with children
  if (hasChildren) {
    return (
      <div key={node.id}>
        <NavLink to={destination}>
          <Icon name={resolveIconName(node)} size={16} />
          <span>{node.label}</span>
          <button onClick={(e) => { e.preventDefault(); toggleGroup(node.id) }}>
            <Icon name={isExpanded ? '12px-minus' : '12px-plus'} />
          </button>
        </NavLink>

        {isExpanded && (
          <div>
            {node.children.map((child) => renderFlexNode(child, depth + 1))}
          </div>
        )}
      </div>
    )
  }

  // Leaf node
  return (
    <NavLink key={node.id} to={destination} style={indentStyle}>
      <Icon name={resolveIconName(node)} size={16} />
      <span>{node.label}</span>
    </NavLink>
  )
}
```

**Features**:
- Recursive rendering for nested navigation
- Depth-based indentation (24px per level)
- Parent/child toggle with plus/minus icons
- Active state highlighting
- Icon resolution per node

## Mobile Integration

### StyleguideLayout

**Location**: `apps/web/src/components/styleguide/layout/StyleguideLayout.jsx`

```javascript
<div className="lg:hidden px-4 pt-6 sm:px-8">
  <div className="flex items-center justify-between gap-4">
    <ThemeToggleButton variant="compact" />
    <div className="min-w-[200px]">
      <Dropdown
        options={dropdownOptions}
        value={currentDropdownValue}
        onChange={handleDropdownChange}
      />
    </div>
  </div>
</div>
```

**Mobile Navigation**:
- Hidden on large screens (lg+)
- Dropdown replaces sidebar on mobile/tablet
- All navigation accessible via dropdown

## Keyboard Accessibility

### Expand/Collapse Toggle

```javascript
<span
  role="button"
  tabIndex={0}
  onClick={handleToggleClick}
  onKeyDown={handleToggleKey}
  aria-expanded={isExpanded}
  aria-label={isExpanded ? `Collapse ${node.label}` : `Expand ${node.label}`}
>
```

**Accessibility Features**:
- Role: button
- TabIndex: focusable
- Keyboard support (Enter/Space)
- ARIA attributes (expanded, label)
- Clear accessible name

## Related Documentation

- [1.5.0 Navigation System](./1.5.0-navigation-system.md) - Overall architecture
- [1.5.1 Navbar & Footer](./1.5.1-navbar-footer.md) - Site-level navigation
- [1.5.3 Router DOM](./1.5.3-router-dom.md) - React Router integration

---

**Styleguide Sidebar**: The interactive navigation component that powers movement through the styleguide.
