# 3.4.0 Icon System

**Version:** 1.0
**Date:** 2025-11-11
**Status:** Active
**Content Type:** implementation
**Category:** design-system

---

# Icon System: SVG Icon Management

**Purpose:** Documentation of the Icon wrapper component and SVG icon management system in the kolkrabbi design system.

> The Icon component provides a unified, performant way to load and render SVG icons throughout the application. It uses Vite's `import.meta.glob` to dynamically load icons from the filesystem, with built-in caching and size normalization.

## Overview

**Location:** `packages/ui/src/atoms/icons/Icon.jsx`
**SVG Directory:** `packages/ui/src/atoms/icons/svg/`
**Total Icons:** 93 SVG files

## Architecture

### Dynamic SVG Loading

The Icon component uses Vite's module loading to eagerly load all SVG files at build time:

```javascript
const svgModules = import.meta.glob('./svg/*.svg', {
  eager: true,
  query: '?raw',
  import: 'default'
})
```

**Key features:**
- **Eager loading**: All icons loaded at build time for instant access
- **Raw import**: SVG files imported as raw strings
- **Build-time optimization**: No runtime file system access needed

### Icon Cache

Icons are cached in memory for fast lookups:

```javascript
const ICON_CACHE = Object.entries(svgModules).reduce((acc, [path, svgContent]) => {
  const fileName = path.split('/').pop() || ''
  const iconName = fileName.replace('.svg', '')
  acc[iconName] = svgContent
  return acc
}, {})
```

The cache maps icon names (without `.svg` extension) to their SVG markup strings.

## Component API

### Basic Usage

```jsx
import Icon from '@kol/ui'

// Default size (16px)
<Icon name="arrow-right" />

// Custom size
<Icon name="check" size={24} />

// With className
<Icon name="chevron-down" size={12} className="text-fg-64" />
```

### Props

| Prop | Type | Default | Description |
|------|------|---------|-------------|
| `name` | `string` | required | Icon name (matches SVG filename without extension) |
| `size` | `number \| string` | `16` | Icon size in pixels or CSS unit string |
| `className` | `string` | `''` | Additional CSS classes |
| `style` | `object` | `{}` | Inline styles |
| `children` | `ReactNode` | `undefined` | Optional: Direct SVG path content for custom icons |

### Size Handling

The component accepts sizes as:
- **Number**: `24` → `"24px"`
- **String**: `"2rem"`, `"100%"`, `"24px"`

The size is applied to both `width` and `height` attributes of the SVG.

### Custom Icons (Children Mode)

For one-off custom icons without adding to the SVG directory:

```jsx
<Icon size={16}>
  <path d="M12 2L2 7l10 5 10-5-10-5z" fill="currentColor"/>
</Icon>
```

## SVG Requirements

### File Structure

```
packages/ui/src/atoms/icons/svg/
├── arrow-right.svg
├── arrow-up.svg
├── check.svg
├── chevron-down.svg
└── ...
```

### SVG Format

Icons should follow these conventions:

```svg
<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="..." fill="currentColor"/>
</svg>
```

**Best practices:**
- Use `24×24` viewBox for consistency
- Use `fill="currentColor"` to inherit text color
- Keep paths optimized (use SVGO or similar)
- Remove unnecessary metadata and comments
- Use descriptive, kebab-case filenames

## Adding New Icons

### Step 1: Prepare SVG

1. Export icon as SVG from design tool
2. Optimize with SVGO: `svgo icon.svg`
3. Ensure `fill="currentColor"` on paths
4. Verify `viewBox="0 0 24 24"`

### Step 2: Add to Directory

```bash
cp optimized-icon.svg packages/ui/src/atoms/icons/svg/icon-name.svg
```

### Step 3: Use in Code

```jsx
<Icon name="icon-name" size={16} />
```

No imports or configuration needed - the icon is automatically available.

## Size Normalization

The `normalizeSize` function handles size conversion:

```javascript
const normalizeSize = (value) => {
  if (typeof value === 'number') {
    return `${value}px`
  }
  if (typeof value === 'string') {
    return value
  }
  return '16px'
}
```

The `applySizeToMarkup` function modifies the SVG string to inject width/height:

```javascript
const applySizeToMarkup = (markup, sizeValue) => {
  let updated = markup

  // Replace or add width attribute
  if (/width="/i.test(updated)) {
    updated = updated.replace(/width="[^"]*"/i, `width="${sizeValue}"`)
  } else {
    updated = updated.replace('<svg', `<svg width="${sizeValue}"`)
  }

  // Replace or add height attribute
  if (/height="/i.test(updated)) {
    updated = updated.replace(/height="[^"]*"/i, `height="${sizeValue}"`)
  } else {
    updated = updated.replace('<svg', `<svg height="${sizeValue}"`)
  }

  return updated
}
```

## Rendering

### Wrapper Span

Icons are wrapped in a `<span>` for consistent alignment:

```jsx
<span
  className={`inline-flex items-center justify-center ${className}`}
  style={{
    width: dimension,
    height: dimension,
    lineHeight: 0,
    ...style
  }}
  dangerouslySetInnerHTML={{ __html: sizedMarkup }}
/>
```

**Why `dangerouslySetInnerHTML`?**
- Direct SVG string injection for performance
- Avoids React parsing overhead
- Icons are trusted build-time assets

**Why `lineHeight: 0`?**
- Prevents extra vertical spacing
- Ensures icon is exact specified size

## Color Inheritance

Icons use `fill="currentColor"` to inherit text color:

```jsx
// Red icon
<div className="text-red-500">
  <Icon name="check" />
</div>

// 64% opacity icon
<div className="text-fg-64">
  <Icon name="arrow-right" />
</div>
```

## Available Icons (Sample)

### Directional
- `arrow-right`
- `arrow-up`
- `arrow-downright`
- `chevron-down`
- `chevron-left`
- `chevron-right`
- `chevron-up`

### Actions
- `check`
- `check-mark`
- `cross`
- `plus`
- `minus`

### UI Elements
- `circle`
- `grid`
- `row`
- `type`
- `pen`
- `color`

### Chess Pieces
- `chess-pawn`
- `chess-rook`
- `black-king`
- `black-queen`
- `black-bishop`
- `black-knight`
- `white-king`
- `white-queen`

**Full list:** See `packages/ui/src/atoms/icons/svg/` directory (93 total icons)

## Performance Considerations

### Build Time
- All icons loaded eagerly at build time
- No runtime dynamic imports
- Icons bundled into main chunk (consider code splitting for large icon sets)

### Runtime
- O(1) lookup from cache object
- String manipulation for size injection
- Single DOM operation via `dangerouslySetInnerHTML`

### Bundle Size
With 93 icons, total SVG payload is ~50-100KB (pre-gzip). Consider:
- Tree-shaking unused icons (requires refactoring to named imports)
- Lazy loading icon sets by category
- Extracting to separate chunk

## Error Handling

Missing icons log a warning and return `null`:

```javascript
if (!svgMarkup) {
  console.warn(`Icon "${name}" not found in svg directory`)
  return null
}
```

This prevents crashes but provides developer feedback.

## Usage Examples

### In LinkWithIcon Component

```jsx
import Icon from './icons/Icon'

const LinkWithIcon = ({ to, children, iconName = 'arrow-right', iconSize = 12 }) => {
  return (
    <Link to={to} className="group inline-flex items-center gap-2">
      {children}
      <Icon
        name={iconName}
        size={iconSize}
        className="transition-transform group-hover:translate-x-1"
      />
    </Link>
  )
}
```

### In Button Component

```jsx
import Icon from './icons/Icon'

const Button = ({ iconLeft, iconRight, iconSize = 16, children }) => {
  return (
    <button className="flex items-center gap-2">
      {iconLeft && <Icon name={iconLeft} size={iconSize} />}
      {children}
      {iconRight && <Icon name={iconRight} size={iconSize} />}
    </button>
  )
}
```

### Animated Icons

```jsx
<Icon
  name="chevron-down"
  size={16}
  className="transition-transform duration-200 group-hover:rotate-180"
/>
```

## Design Tokens Integration

Icons work seamlessly with design system color tokens:

```jsx
// Using semantic tokens
<div className="text-fg-88">
  <Icon name="check" />
</div>

// Using CSS custom properties
<Icon
  name="arrow-right"
  style={{ color: 'var(--kol-fg-primary)' }}
/>
```

## Accessibility

### Icon-Only Buttons

Always provide accessible labels for icon-only interactive elements:

```jsx
// ✅ Good
<button aria-label="Close dialog">
  <Icon name="cross" size={16} />
</button>

// ❌ Bad
<button>
  <Icon name="cross" size={16} />
</button>
```

### Decorative Icons

Icons paired with text are decorative and should be hidden from screen readers:

```jsx
<button>
  <Icon name="check" size={16} aria-hidden="true" />
  <span>Confirm</span>
</button>
```

However, the current implementation doesn't automatically add `aria-hidden`. Consider adding this:

```javascript
// In Icon.jsx
<span
  className={`inline-flex items-center justify-center ${className}`}
  aria-hidden="true"  // Add this
  style={{ ... }}
  dangerouslySetInnerHTML={{ __html: sizedMarkup }}
/>
```

## Migration Guide

### From Inline SVG

**Before:**
```jsx
<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
  <path d="M4.125 13.125H17.1594..."/>
</svg>
```

**After:**
```jsx
<Icon name="arrow-right" size={16} />
```

### From Icon Fonts

**Before:**
```jsx
<i className="icon-arrow-right"></i>
```

**After:**
```jsx
<Icon name="arrow-right" />
```

**Benefits:**
- Better accessibility (SVG is actual content, not font ligature)
- Precise sizing control
- No FOUT (Flash of Unstyled Text)
- Can use multiple colors via CSS

## Future Enhancements

### Icon Sets
Consider organizing icons into sets for better code splitting:

```javascript
// icon-sets/directional.js
export { default as arrowRight } from './svg/arrow-right.svg?raw'
export { default as arrowUp } from './svg/arrow-up.svg?raw'
```

### TypeScript Types
Add icon name autocomplete:

```typescript
type IconName = 'arrow-right' | 'arrow-up' | 'check' | ... // generated

interface IconProps {
  name: IconName
  size?: number | string
  className?: string
  style?: React.CSSProperties
}
```

### SVG Sprite Sheet
For very large icon sets, consider SVG sprites:

```jsx
<svg>
  <use href="#icon-arrow-right" />
</svg>
```

## Related Documentation

- [3.1.0 Design System: Atoms](./3.1.0-design-system-atoms.md)
- [2.1.0 Design System: Colors](./2.1.0-design-system-colors.md)
- [LinkWithIcon Component](../apps/web/src/components/README.md)

---

**Next:** [5.3.2 Components: Apparatus Overview](./5.3.2-components-apparatus-overview.md)
