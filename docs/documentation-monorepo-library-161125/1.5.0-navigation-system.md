# 1.5.0 Navigation System

> **Foundation Level Documentation** - Architectural infrastructure for routing, navigation, and user movement through the application.

## Overview

The navigation system is the foundational infrastructure that connects repository structure → routes → UI. It's not a component, but architectural plumbing that defines how users move through the application.

## Architecture Layers

### 1. Data Layer: Navigation Tree
**Location**: `apps/web/src/data/styleguide/navigation.js`

The single source of truth for all navigation data:

```javascript
export const STYLEGUIDE_ROUTES = [
  {
    id: 'chess',
    label: 'Chess',
    path: 'chess',
    icon: 'chess-pawn',
    children: [
      { id: 'overview', label: 'Overview', path: 'chess/overview', icon: 'chess-pawn'},
      { id: 'apparatus', label: 'Apparatus', path: 'chess/apparatus' },
      // ...
    ]
  }
]
```

**Properties**:
- `id` - Unique identifier for node
- `label` - Display text
- `path` - Relative route path (without `/styleguide` prefix)
- `icon` - Optional icon name (resolved by `resolveIconName`)
- `children` - Nested navigation items

### 2. Router Layer: Route Definitions
**Location**: `apps/web/src/App.jsx` (main routes), `apps/web/src/routes/Styleguide.jsx` (nested)

React Router configuration maps navigation data to actual routes:

```javascript
<Route path="chess" element={<ChessHome />} />
<Route path="chess/overview" element={<ChessOverview />} />
<Route path="chess/apparatus" element={<ChessApparatus />} />
```

**Pattern**: Each navigation item has a corresponding route definition.

### 3. Layout Layer: Navigation Containers

#### Site Layout (Public Site)
**Location**: `apps/web/src/components/layout/SiteLayout.jsx`

Wraps the entire application with site-level chrome:

```javascript
export default function SiteLayout() {
  const location = useLocation()
  const hideChrome = location.pathname.startsWith('/styleguide')

  return (
    <div className="min-h-dvh bg-surface-primary">
      {!hideChrome && <Navbar />}
      <Outlet />
      {!hideChrome && <Footer />}
    </div>
  )
}
```

**Key Feature**: Hides navbar/footer when in styleguide (`/styleguide/*` paths).

#### Styleguide Layout (Styleguide)
**Location**: `apps/web/src/components/styleguide/layout/StyleguideLayout.jsx`

Dedicated layout for styleguide with grid system:

```javascript
const gridTemplateClass = isCollapsed
  ? 'lg:grid-cols-[96px_minmax(0,1fr)]'
  : 'lg:grid-cols-[304px_minmax(0,1fr)]'

<div className={`lg:grid ${gridTemplateClass}`}>
  <StyleguideSidebar />
  <main>...</main>
</div>
```

**Key Feature**: Responsive grid (304px sidebar expanded, 96px collapsed).

### 4. Rendering Layer: Navigation Components

#### Styleguide Sidebar
**Location**: `apps/web/src/components/styleguide/layout/StyleguideSidebar.jsx`

Consumes navigation data and renders interactive sidebar:

```javascript
const resolveIconName = (route) => {
  if (route.icon) return route.icon
  return ICON_MAP[route.id] ?? 'arrow-downright'
}
```

**Features**:
- Icon resolution (explicit or mapped)
- Active state highlighting (`isNodeActive`)
- Expand/collapse state management
- Collapsed mode (icons only)
- Auto-expand active group on route change

#### Navbar (Public Site)
**Location**: `apps/web/src/components/layout/Navbar.jsx`

Site-level navigation with dropdowns and mobile menu:

**Features**:
- Desktop horizontal nav with dropdowns
- Mobile full-screen overlay menu
- Scroll-based auto-hide
- Theme toggle
- Active state via NavLink

#### Footer
**Location**: `apps/web/src/components/layout/Footer.jsx`

Site-level footer navigation:

**Features**:
- Large typography navigation
- Social links
- Back to top button with animation
- Hover effects

### 5. Feedback Layer: Navigation Feedback

#### LoaderOverlay
**Location**: `apps/web/src/components/layout/LoaderOverlay.jsx`

Initial page load experience:

```javascript
function AppRoutes() {
  const [isLoading, setIsLoading] = useState(() => {
    const hasSeenLoader = sessionStorage.getItem('hasSeenLoader')
    return !hasSeenLoader
  })

  return (
    <>
      {isLoading && location.pathname === '/' && <LoaderOverlay onEnter={handleEnter} />}
    </>
  )
}
```

**Key Features**:
- Shows only on first visit (sessionStorage)
- Shows only on homepage
- Customizable content via children

#### CursorOverlay
**Location**: `apps/web/src/components/overlay/CursorOverlay.jsx`

Custom cursor that follows mouse:

**Key Features**:
- Fixed position overlay
- Custom styled cursor (32px circle)
- Follows mouse position
- Context-aware visibility

## Data Flow

```
Navigation Data (navigation.js)
    ↓
Router Config (App.jsx, Styleguide.jsx)
    ↓
Layout Wrapper (SiteLayout, StyleguideLayout)
    ↓
Navigation Components (Sidebar, Navbar, Footer)
    ↓
Route Rendering (Outlet in layouts)
    ↓
Page Components (ChessHome, ChessOverview, etc.)
```

## Icon System Interplay

A key example of the navigation system's architectural plumbing: the icon system spans three files with distinct responsibilities.

### File 1: Navigation Data (`navigation.js`)
**Location**: `apps/web/src/data/styleguide/navigation.js`

Defines icon per navigation item (optional):

```javascript
{
  id: 'chess',
  label: 'Chess',
  path: 'chess',
  icon: 'chess-pawn',  // ← Explicit icon definition
  children: [...]
}
```

**Responsibility**: Declare which icon to use for this navigation item.

### File 2: Icon Resolution (`StyleguideSidebar.jsx`)
**Location**: `apps/web/src/components/styleguide/layout/StyleguideSidebar.jsx`

Contains the resolution logic:

```javascript
const ICON_MAP = {
  'styleguide': 'styleguide',
  foundations: 'foundation',
  components: 'component',
  apparatus: 'interactive'
  // Note: chess is NOT in here
}

const resolveIconName = (route) => {
  if (route.icon) return route.icon           // Priority 1: explicit
  return ICON_MAP[route.id] ?? 'arrow-downright'  // Priority 2: mapped, 3: default
}
```

**Responsibility**: Resolve which icon to render:
1. If route has explicit `icon` property → use that
2. If route ID exists in `ICON_MAP` → use mapped icon
3. Otherwise → use default `'arrow-downright'`

### File 3: Icon Component (`@kol/ui`)
**Location**: `packages/ui/src/index.js` (Icon export)

Renders the actual icon:

```javascript
import { Icon } from '@kol/ui'

<Icon name="chess-pawn" size={16} />
```

**Responsibility**: Display the resolved icon.

### The Interplay Flow

```
navigation.js                   StyleguideSidebar.jsx              @kol/ui Icon
      ↓                               ↓                                   ↓
  { icon: 'chess-pawn' }    →   resolveIconName(route)    →    <Icon name="chess-pawn" />
      ↓                               ↓
  No icon defined         →   Check ICON_MAP[route.id]    →    Use mapped or default
      ↓                               ↓
  Any route               →   Fallback: 'arrow-downright' →    Always works
```

### Real Examples

**Example 1: Explicit Icon (Chess)**
```javascript
// navigation.js
{ id: 'chess', label: 'Chess', icon: 'chess-pawn', children: [...] }

// Result: Icon shows 'chess-pawn'
// Resolution: Priority 1 (explicit)
```

**Example 2: Mapped Icon (Foundations)**
```javascript
// navigation.js
{ id: 'foundations', label: 'Foundations', path: 'foundations' }
// No icon property!

// StyleguideSidebar.jsx ICON_MAP
const ICON_MAP = {
  foundations: 'foundation',  // ← Maps 'foundations' to 'foundation'
  // ...
}

// Result: Icon shows 'foundation'
// Resolution: Priority 2 (ICON_MAP lookup)
```

**Example 3: Default Icon (Unknown Routes)**
```javascript
// navigation.js
{ id: 'unknown-route', label: 'Unknown', path: 'unknown' }
// No icon property!

// Not in ICON_MAP

// Result: Icon shows 'arrow-downright'
// Resolution: Priority 3 (default fallback)
```

### Why This Pattern?

**Benefits**:
- **Flexibility**: Some items define icons explicitly, others use mapping
- **Maintainability**: Centralized ICON_MAP for common patterns
- **Fallback Safety**: Default icon prevents broken states
- **Separation**: Data (what), logic (which), rendering (show)

**When to Use Each**:
- **Explicit** (`navigation.js`): Item-specific, unique icons
- **Mapped** (`ICON_MAP`): Common patterns, categories
- **Default**: Fallback for safety

This interplay exemplifies the navigation system's architecture: data → logic → rendering, with intelligent fallbacks at each layer.

## Key Principles

1. **Single Source of Truth**: All navigation data defined in one place
2. **Separation of Concerns**: Data, routing, layout, and rendering are separate
3. **Active State Awareness**: Components compute active state from current route
4. **Context-Aware**: Different layouts for public site vs styleguide
5. **Progressive Enhancement**: Mobile navigation, keyboard accessibility

## Related Documentation

- [1.5.1 Navbar & Footer](./1.5.1-navbar-footer.md) - Site-level navigation components
- [5.0.2 Workshop Sidebar](./5.0.2-workshop-sidebar.md) - Sidebar implementation details
- [1.5.3 Router DOM](./1.5.3-router-dom.md) - React Router integration
- [1.5.4 Loader Overlay](./1.5.4-loader-overlay.md) - Navigation feedback components

## File Map

```
apps/web/
├── src/
│   ├── data/
│   │   └── styleguide/navigation.js          # Navigation data tree
│   ├── routes/
│   │   ├── App.jsx                           # Main router config
│   │   └── Styleguide.jsx                    # Nested routes
│   └── components/
│       ├── layout/
│       │   ├── SiteLayout.jsx                # Public site wrapper
│       │   ├── StyleguideLayout.jsx          # Styleguide wrapper
│       │   ├── Navbar.jsx                    # Site nav
│       │   ├── Footer.jsx                    # Site footer
│       │   ├── LoaderOverlay.jsx             # Initial load
│       │   └── StyleguideSidebar.jsx         # Styleguide nav
│       └── overlay/
│           └── CursorOverlay.jsx             # Custom cursor
```

---

**Navigation System**: The architectural foundation that connects code structure to user experience.
