---
title: "2.1.0 Design System: Color System"
version: "3.4"
date: "2025-11-04"
status: "Active"
content-type: "implementation"
category: "design-system"
---

# 2.1.0 Design System: Color System

**Version:** 3.4
**Last Updated:** 2025-11-04
**Status:** Complete (Phases 1-6)

> This document describes the 2.1.0 color system implementation. For the evolution from 2.0.0 to 3.x, see [2.0.0 Design System Overview](./2.0.0-design-system-overview.md). For subsequent enhancements, see [2.2.0 Design System: Typography](./2.2.0-design-system-typography.md) and [2.3.0 Design System: Components](./2.3.0-design-system-components.md).

## Overview

This document provides comprehensive documentation for the kolkrabbi color system, which has been completely redesigned to provide:

- **Predictable naming**: Material Design 3-inspired `--kol-*` token convention
- **Automatic pairing**: "on-" foreground tokens for every surface
- **Geometric scale**: Clean 2x doubling progression (02, 04, 08, 16, 32, 64)
- **Surface awareness**: Border utilities that work on any background
- **Interactive states**: Built-in hover, focus, and active variants
- **Theme adaptation**: All tokens automatically adapt to light/dark mode

The system consists of 97 tokens (69 light mode including 24 opacity-hex variants, 28 dark mode overrides), 14 utility classes, and complete backward compatibility with the legacy system.

---

## Token Architecture

### Naming Convention

All tokens follow the pattern: `--kol-{category}-{semantic}-{variant}`

**Categories:**
- `surface` - Page-level backgrounds
- `container` - Component-level backgrounds
- `accent` - Brand highlights and calls-to-action
- `status` - System states (danger, success, warning)
- `border` - Semantic border colors

**Semantic names:**
- `primary`, `secondary`, `tertiary` - Hierarchy levels
- `inverse` - Inverted theme
- `elevated` - Raised z-index
- `danger` - Error/destructive states

**Variants:**
- `on-{semantic}` - Foreground pair (text/icons)
- `{semantic}-hover` - Hover state
- `{semantic}-active` - Active/pressed state
- `{semantic}-strong` - Emphasized variant
- `{semantic}-muted` - De-emphasized variant

### Token Categories

#### Surface Tokens (Page-level)
```css
--kol-surface-primary          /* #fafafa (light) / #121215 (dark) */
--kol-surface-on-primary       /* #121215 (light) / #fafafa (dark) */

--kol-surface-secondary        /* #f8f8f8 (light) / #19191d (dark) */
--kol-surface-on-secondary     /* #19191d (light) / #f8f8f8 (dark) */

--kol-surface-tertiary         /* #ffffff (light) / #0e0e11 (dark) */
--kol-surface-on-tertiary      /* #0e0e11 (light) / #ffffff (dark) */

--kol-surface-inverse          /* #0e0e11 (light) / #fcfbf8 (dark) */
--kol-surface-on-inverse       /* #fcfbf8 (light) / #0e0e11 (dark) */

/* Inverse Surface Tokens - Elevated surfaces within inverse contexts */
--kol-surface-secondary-inverse  /* #212121 (light) / #e0e0e0 (dark) */
--kol-surface-tertiary-inverse   /* #424242 (light) / #d4d4d8 (dark) */

/* Support Split Tokens - Special split-screen backgrounds */
--kol-surface-support-split          /* #eeeeee (light) / #202026 (dark) */
--kol-surface-support-split-inverse  /* #202026 (light) / #eeeeee (dark) */
--kol-surface-absolute-split         /* #ffffff (light) / #000000 (dark) */
--kol-surface-absolute-split-inverse /* #000000 (light) / #ffffff (dark) */
```

#### Container Tokens (Component-level)
```css
--kol-container-primary        /* #f5f5f5 (light) / #19191d (dark) */
--kol-container-on-primary     /* #19191d (light) / #f5f5f5 (dark) */

--kol-container-secondary      /* #eeeeee (light) / #202026 (dark) */
--kol-container-on-secondary   /* #202026 (light) / #eeeeee (dark) */

--kol-container-elevated       /* #f5f5f5 (light) / #242427 (dark) */
--kol-container-on-elevated    /* #242427 (light) / #f5f5f5 (dark) */
```

#### Accent Tokens
```css
--kol-accent-primary           /* #f5d245 (brand yellow) */
--kol-accent-on-primary        /* #1e1e21 (dark text on yellow) */
--kol-accent-primary-strong    /* #f5bb1d (hover/emphasis) */
--kol-accent-primary-muted     /* rgba(245, 210, 69, 0.18/0.24) */
```

#### Status Tokens
```css
--kol-status-danger            /* #9b3928 (light) / #bc583f (dark) */
--kol-status-on-danger         /* #ffffff (white text) */
--kol-status-danger-strong     /* #bc583f (light) / #9b3928 (dark) */
--kol-status-danger-muted      /* rgba(155, 57, 40, 0.18/0.24) */
```

#### Border Tokens (Semantic)
```css
--kol-border-default           /* 8% foreground opacity */
--kol-border-subtle            /* 4% foreground opacity */
--kol-border-strong            /* 16% foreground opacity */
--kol-border-hover             /* 16% foreground opacity */
--kol-border-focus             /* var(--kol-accent-primary) */
--kol-border-active            /* var(--kol-accent-primary-strong) */
```

---

## Surfaces & Containers

### Understanding the Distinction

The system distinguishes between **surfaces** (page-level) and **containers** (component-level) following Material Design 3 conventions.

#### Surface Tokens
**Purpose**: Page backgrounds, major layout sections
**Hierarchy**: primary (base) → secondary (sections) → tertiary (cards)
**Usage**: Apply to main layout elements, page wrappers, hero sections

```html
<main class="bg-surface-primary">
  <section class="bg-surface-secondary">
    <div class="bg-surface-tertiary">Card content</div>
  </section>
</main>
```

#### Container Tokens
**Purpose**: Component backgrounds, UI elements
**Hierarchy**: primary (standard) → secondary (nested) → elevated (floating)
**Usage**: Apply to buttons, cards, panels, modals

```html
<div class="bg-container-primary">
  <div class="bg-container-secondary">Nested panel</div>
  <div class="bg-container-elevated">Floating tooltip</div>
</div>
```

### When to Use Each

| Use Case | Token Type | Specific Token |
|----------|------------|----------------|
| Page background | Surface | `--kol-surface-primary` |
| Hero section background | Surface | `--kol-surface-secondary` |
| Card background | Container | `--kol-container-primary` |
| Button background | Container | `--kol-container-primary` |
| Modal background | Container | `--kol-container-elevated` |
| Dropdown menu background | Container | `--kol-container-elevated` |
| Tooltip background | Container | `--kol-container-elevated` |
| Inverted section (nav/footer) | Surface | `--kol-surface-inverse` |

**Rule of thumb:** If it's a layout decision, use **surface**. If it's a component decision, use **container**.

---

## Foreground Pairing ("on-" Convention)

Every surface and container token has a corresponding "on-" token that provides the correct foreground color (text, icons, borders).

### Automatic Pairing

```css
/* Surface token + its foreground pair */
--kol-surface-primary: #fcfbf8;
--kol-surface-on-primary: #1e1e21;  /* Always readable on primary */

/* Dark mode - values flip */
--kol-surface-primary: #121215;
--kol-surface-on-primary: #f5f5f5;  /* Still readable */
```

### Usage Pattern

**Always use the "on-" token when setting foreground on a surface:**

```html
<!-- Correct: Paired foreground -->
<div style="background: var(--kol-surface-primary); color: var(--kol-surface-on-primary);">
  Text is always readable
</div>

<!-- Wrong: Mismatched foreground -->
<div style="background: var(--kol-surface-primary); color: var(--kol-surface-on-secondary);">
  Contrast may be insufficient
</div>
```

### Utility Class Pairing

Most surface/container utilities automatically set both background AND foreground:

```css
/* Single class sets both */
.bg-surface-primary {
  background-color: var(--kol-surface-primary);
  color: var(--kol-surface-on-primary);  /* Automatic pairing */
}
```

### WCAG Compliance

All "on-" pairs are tested for WCAG contrast ratios:
- **18/18 pairs pass AA** (4.5:1 for normal text, 3:1 for large text)
- **16/18 pairs pass AAA** (7:1 for normal text, 4.5:1 for large text)

---

## Inverse Surfaces & Context-Aware Components

### Overview

Inverse surfaces create light pockets within dark themes (or dark pockets within light themes). Components placed inside inverse surfaces need to adapt their colors to maintain proper contrast. This is achieved through **scoped token remapping**, following Material Design 3's proven pattern.

### The Problem

Components that reference global tokens directly won't adapt to inverse surface contexts:

```css
/* ❌ Component hardcodes global tokens */
.btn-primary {
  background: var(--kol-surface-on-primary);  /* Always references global value */
  color: var(--kol-surface-primary);          /* Doesn't adapt to parent context */
}
```

When this button is placed inside `.bg-surface-inverse`, it maintains the same colors as the default surface, resulting in poor/no contrast.

### The Solution: Scoped Token Remapping

The `.bg-surface-inverse` utility class redefines what surface tokens mean within its scope, following Material Design's pattern:

```css
.bg-surface-inverse {
  background-color: var(--kol-surface-inverse);
  color: var(--kol-surface-on-inverse);

  /* Remap surface tokens to inverse equivalents */
  --kol-surface-primary: var(--kol-surface-inverse);
  --kol-surface-on-primary: var(--kol-surface-on-inverse);

  --kol-surface-secondary: var(--kol-surface-secondary-inverse);
  --kol-surface-on-secondary: var(--kol-surface-on-inverse);

  --kol-surface-tertiary: var(--kol-surface-tertiary-inverse);
  --kol-surface-on-tertiary: var(--kol-surface-on-inverse);

  --kol-border-default: color-mix(in srgb, var(--kol-surface-on-inverse) 8%, transparent);
}
```

### How It Works

CSS custom properties (variables) are **scoped by the cascade**. When you redefine a variable within a selector, all descendants inherit that new value:

```html
<div class="bg-surface-primary">
  <!-- Button uses global --kol-surface-primary (#fcfbf8 light) -->
  <button class="btn-primary">Button</button>
</div>

<div class="bg-surface-inverse">
  <!-- Button uses remapped --kol-surface-primary (#1e1e21 dark) -->
  <button class="btn-primary">Button</button>
</div>
```

The button's CSS doesn't change, but the tokens it references resolve to different values based on the parent context.

### Inverse Surface Tokens

The system defines explicit inverse tokens for each surface level to ensure proper tonal hierarchy:

**Light Mode:**
```css
--kol-surface-inverse: #1e1e21;                  /* Dark base */
--kol-surface-on-inverse: #fcfbf8;               /* Light text */
--kol-surface-secondary-inverse: #212121;        /* Slightly lighter */
--kol-surface-tertiary-inverse: #424242;         /* Even lighter */
```

**Dark Mode:**
```css
--kol-surface-inverse: #f5f5f5;                  /* Light base */
--kol-surface-on-inverse: #121215;               /* Dark text */
--kol-surface-secondary-inverse: #e0e0e0;        /* Slightly darker */
--kol-surface-tertiary-inverse: #d4d4d8;         /* Even darker */
```

These create a **tonal elevation hierarchy** within inverse contexts, mirroring the primary → secondary → tertiary progression of default surfaces.

### Usage Example

```html
<!-- Default surface (dark background in dark mode) -->
<section class="bg-surface-primary">
  <button class="btn-primary">Primary</button>      <!-- Light bg, dark text -->
  <button class="btn-secondary">Secondary</button>  <!-- Medium gray bg, dark text -->
</section>

<!-- Inverse surface (light background in dark mode) -->
<section class="bg-surface-inverse">
  <button class="btn-primary">Primary</button>      <!-- Dark bg, light text ✅ -->
  <button class="btn-secondary">Secondary</button>  <!-- Medium gray bg, light text ✅ -->
</section>
```

### Authoring Context-Aware Components

To ensure components work correctly in both default and inverse contexts:

#### ✅ Do: Reference scopeable surface tokens
```css
.my-component {
  background: var(--kol-surface-secondary);
  color: var(--kol-surface-on-secondary);
  border: 1px solid var(--kol-border-default);
}
```

#### ❌ Don't: Hardcode color values
```css
.my-component {
  background: #f5f5f5;    /* Won't adapt to inverse context */
  color: #1e1e21;         /* Won't adapt to theme changes */
}
```

#### ❌ Don't: Reference container tokens in surface components
```css
.btn-primary {
  /* Wrong: Container tokens aren't remapped in .bg-surface-inverse */
  background: var(--kol-container-primary);
}
```

### Material Design Precedent

This pattern is taken directly from Material Design 3's implementation:

**Material's approach:**
```css
.inverse-surface-container {
  --md-sys-color-primary: var(--md-sys-color-inverse-primary);
  --md-sys-color-surface: var(--md-sys-color-inverse-surface);
}
```

**Our equivalent:**
```css
.bg-surface-inverse {
  --kol-surface-primary: var(--kol-surface-inverse);
  --kol-surface-on-primary: var(--kol-surface-on-inverse);
}
```

This ensures components automatically adapt without requiring inverse-specific variants or manual overrides.

### Benefits

1. **No component variants needed**: Components don't need `.btn-primary-inverse` classes
2. **Automatic adaptation**: Works for all components that use surface tokens
3. **Maintainable**: Single source of truth for inverse behavior
4. **Consistent**: Follows Material Design's proven pattern
5. **Predictable**: Same component, different context, automatic adaptation

---

## Opacity Scale

### Current Scale (Geometric)

The system uses a **geometric progression** (2x doubling) for predictable layering:

| Value | Percentage | Use Case |
|-------|-----------|----------|
| `02` | 2% | Ultra-subtle tint, barely visible |
| `04` | 4% | Subtle hover pre-state, hairline highlight |
| `08` | 8% | Light overlay, default border opacity |
| `16` | 16% | Visible overlay, default chip/badge background |
| `32` | 32% | Strong overlay, filled pills, emphasis blocks |
| `64` | 64% | High-contrast badge, translucent cards |

**Pattern**: Each step doubles the previous value (2 → 4 → 8 → 16 → 32 → 64)

### Why Geometric?

1. **Predictable jumps**: Each level is noticeably different from the previous
2. **Mental math**: Easy to calculate relative intensity (32 is 4× stronger than 08)
3. **Consistent hierarchy**: Same perceptual difference between each level
4. **Industry standard**: Matches Material Design, Carbon Design, and Tailwind patterns

### Available Utilities

**Foreground-based (adapts to current foreground color):**
```css
.bg-fg-02    /* 2% foreground opacity */
.bg-fg-04    /* 4% foreground opacity */
.bg-fg-08    /* 8% foreground opacity */
.bg-fg-16    /* 16% foreground opacity */
.bg-fg-32    /* 32% foreground opacity */
.bg-fg-64    /* 64% foreground opacity */

.border-fg-02   /* 2% foreground opacity */
.border-fg-04   /* 4% foreground opacity */
.border-fg-08   /* 8% foreground opacity */
.border-fg-16   /* 16% foreground opacity */
.border-fg-32   /* 32% foreground opacity */
.border-fg-64   /* 64% foreground opacity */

.text-fg-02     /* 2% foreground opacity */
.text-fg-04     /* 4% foreground opacity */
.text-fg-08     /* 8% foreground opacity */
.text-fg-16     /* 16% foreground opacity */
.text-fg-32     /* 32% foreground opacity */
.text-fg-64     /* 64% foreground opacity */
```

**Surface-based (uses surface color for contrast):**
```css
.border-surface     /* 100% surface color (solid) */
.border-surface-02  /* 2% surface opacity */
.border-surface-04  /* 4% surface opacity */
.border-surface-08  /* 8% surface opacity */
.border-surface-16  /* 16% surface opacity */
.border-surface-32  /* 32% surface opacity */
.border-surface-64  /* 64% surface opacity */
```

### Deprecated Values

These values existed in the old system but don't fit the geometric progression:

| Old Value | Closest New Value | Migration Alias |
|-----------|-------------------|-----------------|
| `12%` | `16%` (next higher) | `.bg-fg-12` → `16%` |
| `24%` | `32%` (next higher) | `.bg-fg-24` → `32%` |
| `96%` | `100%` (solid fill) | `.bg-fg-96` → `100%` |

**Migration aliases** are available for backward compatibility but map to the new geometric values.

### Migration Aliases

For backward compatibility, these classes still work but redirect to geometric values:

```css
/* Deprecated - maps to 16% */
.bg-fg-12 { background-color: color-mix(in srgb, var(--kol-surface-on-primary) 16%, transparent); }

/* Deprecated - maps to 32% */
.bg-fg-24 { background-color: color-mix(in srgb, var(--kol-surface-on-primary) 32%, transparent); }

/* Deprecated - maps to solid fill */
.bg-fg-96 { background-color: var(--kol-surface-on-primary); }
```

**Recommendation**: Update to geometric values in new code. Migration aliases will be removed in v3.0.

### Opacity-Hex Scale (Hardcoded Neutrals)

In addition to the opacity utilities above that use `color-mix()`, the system provides **hardcoded hex values** that simulate opacity overlays without using CSS color functions. These are useful when you need pre-calculated values or better browser compatibility.

**12 levels available:**
- `01`, `02`, `04`, `08`, `12`, `16`, `24`, `32`, `64`, `80`, `88`, `96`

**Two variants:**
- `--kol-opacity-hex-*` - Standard overlays (dark on light in light mode, light on dark in dark mode)
- `--kol-opacity-hex-inverse-*` - Inverted overlays (flipped values)

**Light Mode Examples:**
```css
--kol-opacity-hex-08: #dbdbdb;           /* 8% dark overlay on white */
--kol-opacity-hex-16: #5b5b5d;           /* 16% dark overlay on white */
--kol-opacity-hex-inverse-08: #242427;   /* 8% inverse (darker) */
--kol-opacity-hex-inverse-16: #363639;   /* 16% inverse (darker) */
```

**Dark Mode (values flip automatically):**
```css
--kol-opacity-hex-08: #242427;           /* 8% light overlay on black */
--kol-opacity-hex-16: #363639;           /* 16% light overlay on black */
--kol-opacity-hex-inverse-08: #dbdbdb;   /* 8% inverse (lighter) */
--kol-opacity-hex-inverse-16: #5b5b5d;   /* 16% inverse (lighter) */
```

**When to use:**
- Need exact hex values for external tools (Figma, design specs)
- Avoiding `color-mix()` for older browser support
- Performance-sensitive scenarios (pre-calculated vs runtime mixing)
- Exporting colors to non-CSS contexts

**Usage:**
```css
.my-overlay {
  background-color: var(--kol-opacity-hex-16);
}

.inverse-overlay {
  background-color: var(--kol-opacity-hex-inverse-16);
}
```

**Utility Classes (v3.3+):**

As of version 3.3, utility classes are now available for both background and border colors:

```css
/* Background utilities */
.bg-opacity-hex-01    .bg-opacity-hex-02    .bg-opacity-hex-04
.bg-opacity-hex-08    .bg-opacity-hex-12    .bg-opacity-hex-16
.bg-opacity-hex-24    .bg-opacity-hex-32    .bg-opacity-hex-64
.bg-opacity-hex-80    .bg-opacity-hex-88    .bg-opacity-hex-96

/* Border utilities */
.border-opacity-hex-01    .border-opacity-hex-02    .border-opacity-hex-04
.border-opacity-hex-08    .border-opacity-hex-12    .border-opacity-hex-16
.border-opacity-hex-24    .border-opacity-hex-32    .border-opacity-hex-64
.border-opacity-hex-80    .border-opacity-hex-88    .border-opacity-hex-96

/* Inverse variants */
.bg-opacity-hex-inverse-01    .bg-opacity-hex-inverse-02    .bg-opacity-hex-inverse-04
.bg-opacity-hex-inverse-08    .bg-opacity-hex-inverse-12    .bg-opacity-hex-inverse-16
.bg-opacity-hex-inverse-24    .bg-opacity-hex-inverse-32    .bg-opacity-hex-inverse-64
.bg-opacity-hex-inverse-80    .bg-opacity-hex-inverse-88    .bg-opacity-hex-inverse-96

.border-opacity-hex-inverse-01    .border-opacity-hex-inverse-02    .border-opacity-hex-inverse-04
.border-opacity-hex-inverse-08    .border-opacity-hex-inverse-12    .border-opacity-hex-inverse-16
.border-opacity-hex-inverse-24    .border-opacity-hex-inverse-32    .border-opacity-hex-inverse-64
.border-opacity-hex-inverse-80    .border-opacity-hex-inverse-88    .border-opacity-hex-inverse-96
```

**Usage:**
```html
<div class="bg-opacity-hex-02 border border-opacity-hex-08 rounded p-4">
  Card with 2% background and 8% border
</div>

<div class="bg-opacity-hex-inverse-16 border border-opacity-hex-inverse-32">
  Inverse variant
</div>
```

### Opacity-Hex Fixed (v3.4+)

**Fixed Classes - Same values in both light and dark mode**

As of version 3.4, the system provides **fixed** opacity-hex utility classes that use hardcoded hex values. These classes maintain the same color in both light and dark mode, unlike the regular opacity-hex classes that adapt to theme.

**Standard Fixed (always uses light mode values):**
```css
/* Background utilities - fixed */
.bg-opacity-hex-fixed-01    .bg-opacity-hex-fixed-02    .bg-opacity-hex-fixed-04
.bg-opacity-hex-fixed-08    .bg-opacity-hex-fixed-12    .bg-opacity-hex-fixed-16
.bg-opacity-hex-fixed-24    .bg-opacity-hex-fixed-32    .bg-opacity-hex-fixed-64
.bg-opacity-hex-fixed-80    .bg-opacity-hex-fixed-88    .bg-opacity-hex-fixed-96

/* Border utilities - fixed */
.border-opacity-hex-fixed-01    .border-opacity-hex-fixed-02    .border-opacity-hex-fixed-04
.border-opacity-hex-fixed-08    .border-opacity-hex-fixed-12    .border-opacity-hex-fixed-16
.border-opacity-hex-fixed-24    .border-opacity-hex-fixed-32    .border-opacity-hex-fixed-64
.border-opacity-hex-fixed-80    .border-opacity-hex-fixed-88    .border-opacity-hex-fixed-96
```

**Inverse Fixed (always uses dark mode values):**
```css
/* Background utilities - fixed inverse */
.bg-opacity-hex-fixed-inverse-01    .bg-opacity-hex-fixed-inverse-02    .bg-opacity-hex-fixed-inverse-04
.bg-opacity-hex-fixed-inverse-08    .bg-opacity-hex-fixed-inverse-12    .bg-opacity-hex-fixed-inverse-16
.bg-opacity-hex-fixed-inverse-24    .bg-opacity-hex-fixed-inverse-32    .bg-opacity-hex-fixed-inverse-64
.bg-opacity-hex-fixed-inverse-80    .bg-opacity-hex-fixed-inverse-88    .bg-opacity-hex-fixed-inverse-96

/* Border utilities - fixed inverse */
.border-opacity-hex-fixed-inverse-01    .border-opacity-hex-fixed-inverse-02    .border-opacity-hex-fixed-inverse-04
.border-opacity-hex-fixed-inverse-08    .border-opacity-hex-fixed-inverse-12    .border-opacity-hex-fixed-inverse-16
.border-opacity-hex-fixed-inverse-24    .border-opacity-hex-fixed-inverse-32    .border-opacity-hex-fixed-inverse-64
.border-opacity-hex-fixed-inverse-80    .border-opacity-hex-fixed-inverse-88    .border-opacity-hex-fixed-inverse-96
```

**Key Differences:**
- **Regular opacity-hex** (`bg-opacity-hex-08`): Adapts to theme (light gray in light mode, dark gray in dark mode)
- **Fixed opacity-hex** (`bg-opacity-hex-fixed-08`): **Always** light gray (#dbdbdb), never changes
- **Fixed inverse opacity-hex** (`bg-opacity-hex-fixed-inverse-08`): **Always** dark gray (#242427), never changes

**When to use fixed vs regular:**
- Use **fixed** when you need consistent colors across themes (e.g., white illustration cards on dark backgrounds)
- Use **regular** when you want automatic theme adaptation
- Use **inverse** when you need swapped values (dark overlays on light backgrounds, or vice versa)

**Usage:**
```html
<!-- Fixed background - always light gray -->
<div class="bg-opacity-hex-fixed-08 border border-opacity-hex-fixed-24 rounded p-4">
  Fixed light background (same in both modes)
</div>

<!-- Fixed inverse - always dark gray -->
<div class="bg-opacity-hex-fixed-inverse-08 border border-opacity-hex-fixed-inverse-24 rounded p-4">
  Fixed dark background (same in both modes)
</div>
```

---

## Border Utilities

The system provides two types of border utilities for different use cases.

### Foreground Borders (border-fg-*)

**Purpose**: Borders that adapt to the current foreground color
**Use when**: Border should match text color and adapt to surface context

```html
<div class="text-auto border border-fg-08">
  Border matches foreground color
</div>
```

**Available utilities:**
```css
.border-fg       /* 100% foreground (solid) */
.border-fg-02    /* 2% foreground opacity */
.border-fg-04    /* 4% foreground opacity */
.border-fg-08    /* 8% foreground opacity */
.border-fg-16    /* 16% foreground opacity */
.border-fg-32    /* 32% foreground opacity */
.border-fg-64    /* 64% foreground opacity */
```

**Behavior:**
- Light mode on white: Dark gray borders
- Dark mode on black: Light gray borders
- Inverse surface: Border color flips with foreground

### Surface Borders (border-surface-*)

**Purpose**: Borders that use surface color for contrast
**Use when**: Element has `bg-fg` fill and needs visible border

**ORIGINAL PROBLEM THIS SOLVES**:
When using `.bg-fg` (foreground-colored background), `.border-fg-*` borders are invisible because they're the same color. Surface borders provide contrast.

```html
<!-- ❌ Problem: Border invisible (foreground on foreground) -->
<div class="bg-fg border border-fg-16">
  Border disappears
</div>

<!-- ✅ Solution: Surface border provides contrast -->
<div class="bg-fg border border-surface-16">
  Border visible
</div>
```

**Available utilities:**
```css
.border-surface       /* 100% surface color (solid) */
.border-surface-02    /* 2% surface opacity */
.border-surface-04    /* 4% surface opacity */
.border-surface-08    /* 8% surface opacity */
.border-surface-16    /* 16% surface opacity */
.border-surface-32    /* 32% surface opacity */
.border-surface-64    /* 64% surface opacity */
```

**Behavior:**
- Light mode: Uses light surface color (creates contrast on dark fills)
- Dark mode: Uses dark surface color (creates contrast on light fills)
- Works on any `bg-fg-*` background

### When to Use Each

| Scenario | Use |
|----------|-----|
| Card outline on page background | `.border-fg-08` |
| Badge with `bg-fg-16` fill | `.border-surface-16` |
| Button outline (no fill) | `.border-fg-08` |
| Chip with `bg-fg-32` fill | `.border-surface-32` |
| Divider line | `.border-fg-08` |
| High-contrast badge outline | `.border-surface-32` |

**Rule of thumb:** Use `.border-fg-*` by default. Switch to `.border-surface-*` only when element has `.bg-fg-*` fill.

### Semantic Border Utilities

For common patterns, use semantic border utilities:

```css
.border-auto          /* Default border (8% foreground) */
.divider-auto         /* 1px horizontal line (8% foreground) */
```

**Examples:**
```html
<!-- Standard card border -->
<div class="border border-auto rounded-lg">Card</div>

<!-- Horizontal divider -->
<div class="divider-auto w-full my-4" />

<!-- Vertical divider in flex -->
<div class="divider-auto h-full w-px" />
```

---

## Elevation System

A 3-level elevation system inspired by Carbon Design for semantic z-axis hierarchy.

### Level 0: Base
**Class**: `.elevation-base`
**Tokens**: `--kol-surface-primary` + `--kol-surface-on-primary`
**Use for**: Page backgrounds, body content, default state

```html
<body class="elevation-base">
  Base level - default page background
</body>
```

**Visual**: Flat on page, no elevation

### Level 1: Raised
**Class**: `.elevation-raised`
**Tokens**: `--kol-surface-secondary` + `--kol-surface-on-secondary`
**Use for**: Cards, panels, sections, dropdown menus, navigation bars

```html
<div class="elevation-raised rounded-lg p-6">
  Raised card with subtle background lift
</div>
```

**Visual**: Slightly raised above page, subtle background change

### Level 2: Elevated
**Class**: `.elevation-elevated`
**Tokens**: `--kol-surface-tertiary` + `--kol-surface-on-tertiary`
**Use for**: Modals, tooltips, popovers, floating action buttons, context menus

```html
<div class="elevation-elevated rounded-lg shadow-lg p-4">
  Modal floating above all content
</div>
```

**Visual**: Highest elevation, floating above everything else

### Usage Guidelines

**Stacking rules:**
1. Never nest higher elevation inside lower (modal inside card is OK, card inside modal is not)
2. Use sparingly - most UIs need only base + raised
3. Elevated should be temporary (modals, tooltips) not persistent

**Common patterns:**
```html
<!-- Page layout -->
<body class="elevation-base">
  <nav class="elevation-raised">Navigation</nav>
  <main>
    <div class="elevation-raised">Card content</div>
  </main>
</body>

<!-- Modal over everything -->
<div class="elevation-elevated fixed inset-0 z-50">
  <div class="bg-container-elevated p-8 rounded-xl">
    Modal content
  </div>
</div>
```

### Elevation vs Z-Index

**Elevation classes** set background/foreground colors for visual hierarchy.
**Z-index utilities** control actual stacking order.

Combine them:
```html
<div class="elevation-elevated z-50">
  Visual AND stacking hierarchy
</div>
```

---

## State Variants

Interactive state utilities for hover, focus, and active states.

### Hover States

Applied on `:hover` pseudo-class using 5% color-mix for subtle feedback.

**Available utilities:**
```css
.hover:bg-surface-primary-hover:hover
.hover:bg-surface-secondary-hover:hover
.hover:bg-surface-tertiary-hover:hover
.hover:bg-container-primary-hover:hover
.hover:bg-container-secondary-hover:hover
```

**How they work:**
```css
/* Light mode: darkens by 5% */
--kol-surface-primary-hover: color-mix(in srgb, var(--kol-surface-primary) 95%, var(--kol-surface-on-primary) 5%);

/* Dark mode: lightens by 5% */
/* Same formula, but values flip automatically */
```

**Example:**
```html
<button class="bg-container-primary hover:bg-container-primary-hover">
  Hover me
</button>
```

### Active States

Applied on `:active` pseudo-class using 10% color-mix for pronounced feedback.

**Available utilities:**
```css
.active:bg-surface-primary-active:active
.active:bg-surface-secondary-active:active
.active:bg-surface-tertiary-active:active
.active:bg-container-primary-active:active
.active:bg-container-secondary-active:active
```

**Example:**
```html
<button class="
  bg-container-primary
  hover:bg-container-primary-hover
  active:bg-container-primary-active
">
  Full state progression
</button>
```

### Focus States

Applied on `:focus` and `:focus-visible` pseudo-classes for accessibility.

**Border focus utilities:**
```css
.focus:border-focus:focus                      /* Standard focus */
.focus-visible:border-focus:focus-visible      /* Keyboard only */
.active:border-active:active                   /* Pressed state */
.hover:border-hover:hover                      /* Hover state */
```

**Focus ring utilities:**
```css
.focus-visible:ring-focus:focus-visible        /* 2px accent ring */
.focus-visible:outline-none:focus-visible      /* Remove default outline */
```

**Example (accessible input):**
```html
<input class="
  border border-auto
  focus-visible:border-focus
  focus-visible:ring-focus
  focus-visible:outline-none
" />
```

**Why :focus-visible?**
Only shows focus ring for keyboard navigation, not mouse clicks. Better UX.

### State Token Values

**Hover tokens (5% mix):**
```css
--kol-surface-primary-hover
--kol-surface-secondary-hover
--kol-surface-tertiary-hover
--kol-container-primary-hover
--kol-container-secondary-hover
```

**Active tokens (10% mix):**
```css
--kol-surface-primary-active
--kol-surface-secondary-active
--kol-surface-tertiary-active
--kol-container-primary-active
--kol-container-secondary-active
```

**Border state tokens:**
```css
--kol-border-hover    /* 16% foreground opacity */
--kol-border-focus    /* var(--kol-accent-primary) */
--kol-border-active   /* var(--kol-accent-primary-strong) */
--kol-focus-ring      /* var(--kol-accent-primary) */
```

### Complete Interactive Element Example

```html
<button class="
  bg-container-primary
  hover:bg-container-primary-hover
  active:bg-container-primary-active
  border border-auto
  hover:border-hover
  focus-visible:border-focus
  focus-visible:ring-focus
  focus-visible:outline-none
  px-6 py-3 rounded-lg
  transition-all duration-200
">
  Fully interactive button
</button>
```

---

## Utility Classes Reference

### Basic Utilities

```css
.text-auto           /* Foreground text color (primary surface "on-" token) */
.bg-auto             /* Background color (primary surface token) */
.bg-fg               /* Solid foreground background (100% foreground color) */
.border-auto         /* Standard border (8% foreground opacity) */
.divider-auto        /* 1px horizontal line (8% foreground opacity) */
```

### Surface Utilities

```css
.bg-surface-primary       /* Page background + paired foreground */
.bg-surface-secondary     /* Section background + paired foreground */
.bg-surface-tertiary      /* Card background + paired foreground */
.bg-surface-inverse       /* Inverted theme + paired foreground */
```

### Container Utilities

```css
.bg-container-primary      /* Component background + paired foreground */
.bg-container-secondary    /* Nested component + paired foreground */
.bg-container-elevated     /* Floating component + paired foreground */
```

### Elevation Utilities

```css
.elevation-base       /* Level 0: Page background */
.elevation-raised     /* Level 1: Cards, panels */
.elevation-elevated   /* Level 2: Modals, tooltips */
```

### Opacity Utilities (Foreground-based)

**Backgrounds:**
```css
.bg-fg-02    .bg-fg-04    .bg-fg-08
.bg-fg-16    .bg-fg-32    .bg-fg-64
```

**Borders:**
```css
.border-fg-02    .border-fg-04    .border-fg-08
.border-fg-16    .border-fg-32    .border-fg-64
```

### Opacity Utilities (Surface-based)

**Borders:**
```css
.border-surface       .border-surface-02    .border-surface-04
.border-surface-08    .border-surface-16    .border-surface-32
.border-surface-64
```

### State Utilities

**Hover:**
```css
.hover:bg-surface-primary-hover:hover
.hover:bg-surface-secondary-hover:hover
.hover:bg-surface-tertiary-hover:hover
.hover:bg-container-primary-hover:hover
.hover:bg-container-secondary-hover:hover
```

**Active:**
```css
.active:bg-surface-primary-active:active
.active:bg-surface-secondary-active:active
.active:bg-surface-tertiary-active:active
.active:bg-container-primary-active:active
.active:bg-container-secondary-active:active
```

**Focus:**
```css
.hover:border-hover:hover
.focus:border-focus:focus
.focus-visible:border-focus:focus-visible
.active:border-active:active
.focus-visible:ring-focus:focus-visible
.focus-visible:outline-none:focus-visible
```

---

## Migration Guide

### From Old System

#### Token Naming Changes

**Old pattern:**
```css
--surface-primary
--foreground
--accent
--destructive
```

**New pattern:**
```css
--kol-surface-primary
--kol-surface-on-primary
--kol-accent-primary
--kol-status-danger
```

#### Opacity Scale Changes

**Old values:**
```css
.bg-fg-12    /* 12% opacity */
.bg-fg-24    /* 24% opacity */
.bg-fg-96    /* 96% opacity */
```

**New equivalents:**
```css
.bg-fg-16    /* 16% (closest geometric) */
.bg-fg-32    /* 32% (closest geometric) */
.bg-fg       /* 100% solid (no alias) */
```

#### Component Token Removal

**Old pattern (two-layer abstraction):**
```css
--component-fg: var(--foreground);
--component-surface: var(--surface-primary);
--component-border: color-mix(var(--foreground) 10%, transparent);
```

**New pattern (direct tokens):**
```css
--kol-surface-on-primary: #1e1e21;
--kol-surface-primary: #fcfbf8;
--kol-border-default: color-mix(var(--foreground) 8%, transparent);
```

#### Context Wrapper Changes

**Old pattern:**
```html
<div class="surface-inverse">
  <div class="bg-auto text-auto">Content</div>
</div>
```

**New pattern:**
```html
<div class="bg-surface-inverse">
  Content (foreground already set)
</div>
```

### Breaking Changes (None)

**Zero breaking changes** - all migrations are additive with backward compatibility aliases.

**Deprecated but functional:**
- Old opacity values (12, 24, 96) redirect to new geometric values
- Legacy token names aliased to new `--kol-*` tokens
- Component token references still work (deprecated)

**Timeline:**
- **Now (v2.x)**: Both old and new systems work
- **v3.0 (TBD)**: Migration aliases removed, only `--kol-*` tokens remain

### Deprecated Tokens

**These still work but will be removed in v3.0:**

```css
/* Surface numbered scales */
--surface-100, --surface-200, --surface-300, etc.

/* Component abstraction layer */
--component-fg, --component-surface, --component-border

/* Legacy accent naming */
--accent, --accent-foreground, --accent-muted

/* Legacy status naming */
--destructive, --destructive-foreground

/* Old border tokens */
--surface-border, --surface-border-strong
```

**Migration path:**
1. Use new `--kol-*` tokens in all new code
2. Update old code incrementally when editing
3. Run global find/replace before v3.0 release

---

## Troubleshooting

### Common Issues

#### Issue: Border not visible on filled element

**Problem:**
```html
<div class="bg-fg-32 border border-fg-16">
  Border invisible (same color as background)
</div>
```

**Solution:** Use surface-based border
```html
<div class="bg-fg-32 border border-surface-16">
  Border now visible
</div>
```

#### Issue: Text unreadable on surface

**Problem:**
```html
<div class="bg-surface-primary text-auto">
  Using wrong foreground token
</div>
```

**Solution:** Use surface utilities (auto-pairs)
```html
<div class="bg-surface-primary">
  Foreground automatically correct
</div>
```

Or use explicit "on-" token:
```html
<div style="background: var(--kol-surface-primary); color: var(--kol-surface-on-primary);">
  Explicit pairing
</div>
```

#### Issue: State hover not working

**Problem:**
```html
<button class="bg-container-primary hover:bg-container-primary">
  Hover does nothing (no -hover suffix)
</button>
```

**Solution:** Use state variant token
```html
<button class="bg-container-primary hover:bg-container-primary-hover">
  Hover now works
</button>
```

#### Issue: Focus ring not visible

**Problem:**
```html
<input class="focus:border-focus">
  Shows on mouse click (annoying)
</input>
```

**Solution:** Use `:focus-visible` instead
```html
<input class="focus-visible:border-focus focus-visible:ring-focus">
  Shows only for keyboard navigation
</input>
```

### Contrast Verification

All color pairs are WCAG tested:

**To verify a custom combination:**
1. Visit WebAIM Contrast Checker: https://webaim.org/resources/contrastchecker/
2. Enter background hex from token
3. Enter foreground hex from "on-" token
4. Verify ratio meets AA (4.5:1) or AAA (7:1)

**Current results:**
- 18/18 pairs pass WCAG AA ✅
- 16/18 pairs pass WCAG AAA ✅

### Debug Checklist

**If colors look wrong:**
1. ✓ Using `--kol-*` tokens (not legacy `--surface-*`)?
2. ✓ Using "on-" pair for foreground?
3. ✓ Theme attribute set on HTML (`data-theme="dark"`)?
4. ✓ Using geometric opacity values (not deprecated)?
5. ✓ Surface borders on `bg-fg` fills?

**If states don't work:**
1. ✓ Using `-hover`/`-active` suffix on token?
2. ✓ Using `:focus-visible` not `:focus`?
3. ✓ Including transition utility for smooth animation?
4. ✓ Pseudo-class syntax correct (`:hover` at end)?

---

## File Locations

**Token definitions:**
- `packages/ui/theme.css` (lines 44-213, light mode)
- `packages/ui/theme.css` (lines 460-597, dark mode)

**Utility classes:**
- `packages/ui/css/utilities.css` (color system utilities)

**Component CSS:**
- `packages/ui/css/components.css` (uses tokens)

**Documentation:**
- `docs/system-retired/2.0-color-system.md` (this file - now archived)
- `docs/system-retired/2.1-color-tables.md` (quick reference tables - now archived)
- `docs/archive/plans/design-system-analysis.md` (archived analysis)
- `docs/archive/plans/color-system-refactor-plan.md` (archived implementation plan)

**Session logs:**
- `docs/SESSION-LOGS/2025-10-16-1200-color-system-refactor-phase-1-2.md`
- `docs/SESSION-LOGS/2025-10-16-1400-color-system-refactor-phase-3-complete.md`
- `docs/SESSION-LOGS/2025-10-16-1500-color-system-refactor-phase-4-complete.md`

---

## Related Documentation

### Design System Evolution
- [2.0.0 Design System Overview](./2.0.0-design-system-overview.md) - Previous version overview and system foundation
- [2.2.0 Design System: Typography](./2.2.0-design-system-typography.md) - Typography implementation following color system patterns
- [2.3.0 Design System: Components](./2.3.0-design-system-components.md) - Component architecture using color system

### Implementation Guides
- [3.0.0 CSS Architecture](../system/3.0-css-architecture.md) - CSS architecture and best practices
- [4.0.0 Styleguide](./4.0-styleguide.md) - Styleguide development and maintenance

### Research Foundation
- [6.1.0 Research: Data Tables](6.1.0-research-data-tables.md) - Color usage in data contexts

### Historical References
- [Design System Analysis](../archive/plans/design-system-analysis.md) - Original analysis and research
- [Color System Refactor Plan](../archive/plans/color-system-refactor-plan.md) - Phase 1-6 implementation plan

### Supporting Documentation
- [2.1 Color Tables](./2.1-color-tables.md) - Quick reference tables (archived, now in this document)
- [WCAG Contrast Documentation](https://webaim.org/resources/contrastchecker/) - WebAIM Contrast Checker

### Live Examples
- `/styleguide/colors` - Interactive color system demo
- `/styleguide/components` - Components using new system

---

## Quick Reference Tables

### Surface vs Container Decision Matrix

| Element Type | Use |
|--------------|-----|
| Page background | Surface primary |
| Hero section | Surface secondary |
| Main content area | Surface primary |
| Navigation bar | Surface inverse |
| Footer | Surface inverse |
| Card component | Container primary |
| Button background | Container primary |
| Modal background | Container elevated |
| Dropdown menu | Container elevated |
| Tooltip | Container elevated |

### Opacity Use Cases

| Value | Background Use | Border Use |
|-------|---------------|------------|
| 02 | Subtle tint, barely visible | Ultra-light divider |
| 04 | Hover pre-state | Hairline border |
| 08 | Light chip/badge | Default border |
| 16 | Standard chip/badge | Emphasized border |
| 32 | Strong pill/badge | High-contrast border |
| 64 | Translucent card | Very strong border |

### State Intensity Guide

| State | Mix % | Visual Effect |
|-------|-------|---------------|
| Default | 0% | Base color |
| Hover | 5% | Subtle feedback |
| Active | 10% | Clear pressed state |
| Focus | N/A | Accent color ring |

---

## Remaining Issues & Next Steps

- Update `/styleguide/colors` with surface/container demos, elevation samples, and state previews.
- Publish WCAG contrast table for every surface/on-surface pair and flag any AA/AAA gaps.
- Schedule Phase 6 cleanup: drop deprecated aliases once migration window closes and run full LD QA sweep.

**Version History:**
- v3.4 (2025-11-02): Added opacity-hex-fixed utility classes with hardcoded hex values (same in both modes)
- v3.3 (2025-10-27): Added opacity-hex utility classes for backgrounds and borders (standard and inverse variants)
- v3.2 (2025-10-27): Updated color values from design tokens import, added opacity-hex scale documentation, unified --kol- prefix convention
- v3.1 (2025-10-16): Renamed to numbered format, documented Phase 5 completion, added open work log
- v3.0 (2025-10-16): Complete rewrite for Phases 1-4
- v2.0 (2025-10-14): Context-aware system
- v1.0 (2024-10-04): Initial system

**Next update:** After completing the outstanding documentation and cleanup tasks noted above

---

**Last Updated:** 2025-11-04
