---
version: 1.0.0
date: 2025-11-16
status: active
content-type: implementation
category: pages
cross-references:
  parent: 4.0.3
  related:
    - apps/web/src/routes/Stack.jsx
    - docs/a-torg/stack-previous-md/7.2.2-stack-hero-tall.md
    - docs/a-torg/stack-previous-md/7.2.3-stack-highlights-grid.md
    - docs/a-torg/stack-previous-md/7.2.4-stack-browse-articles.md
---

# 4.0.33 Stack — General Settings & Layout Shell

> Consolidates the content that used to live in `7.2.2–7.2.4` (hero, highlights, browse) plus the Stack route overview.

## Route Snapshot
- **File:** `apps/web/src/routes/Stack.jsx`
- **Purpose:** Marketing-facing index of all blog content (Stack = “Study Stack” brand).
- **Sections in order:**
  1. `StackHeroTall`
  2. Featured article slab (`ArticleCardHero`)
  3. `StackHighlightsGrid`
  4. `StackBrowseArticles`
  5. `CtaGlobal`

```tsx
<SEO ... />
<main>
  <section className="bg-surface-primary">
    <StackHeroTall />
  </section>

  {latestArticle && <FeaturedArticle ... />}

  <div className="main-wrapper">
    <StackHighlightsGrid articles={highlightArticles} />
    <section className="card-wrapper">
      <StackBrowseArticles ... />
    </section>
  </div>

  <CtaGlobal />
</main>
```

## StackHeroTall
- Wrapper for `StackHero` with taller padding/pull (min-height 90vh, gradient overlay).
- Copy defaults:
  - Title: “Study Stack”
  - Description: “Excercises in futility, manic obsessivities & braindumpster”
- Background asset: `/img/features/card-item-base-7.png`.
- Content class defaults to centered column (`max-w-[520px]`); `StackHeroTall` passes `contentClassName` down for route-specific sizing.

## Highlights Grid
- Component: `apps/web/src/components/sections/stack-detail/StackHighlightsGrid.jsx`.
- Inputs: first four posts from `getLatestBlogPosts` (excluding hero).
- Layout: `SectionLabel` (“Stack Highlights”), divider, responsive 2-column grid of `ArticleCardHero` instances wrapped in `bg-fg-02` cards.
- Keys derived from slug/title/meta to avoid duplicates.

## Browse Articles
- Component: `StackBrowseArticles.jsx`.
- Props:
  - `articles`: filtered set (excludes hero + highlights).
  - `searchTerm`, `onSearchChange`: stateful search.
  - `tagOptions`: built from tags found in `otherArticles`.
  - `selectedTags`: `Set` for multi-select dropdown.
  - `onTagToggle`: toggles individual tags or clears all (when `null`).
  - `isFiltering`: used to show empty-state copy (“No articles found matching your criteria.”).
  - `showLoadMore`: true when additional posts remain; button currently decorative (needs pagination hook).
- Layout: heading (`kol-heading-section`), divider, controls (search input + `DropdownTagFilter`), grid of `ArticleCardMini`.

## Data & Filtering Rules
- `getLatestBlogPosts(20)` drives everything. Index `0` → hero; `1-4` → highlight grid; rest feed browse section.
- Tag options computed from the remaining articles; stored as `Set` for O(1) toggles.
- Search matches title or excerpt (case-insensitive). Filtering is client-side.
- Highlights excluded from browse grid to avoid duplication (`highlightKeys` set).
- CTA relies on shared `CtaGlobal` copy (“Working on a project? / Let’s collaborate”).

## Research Article TOC (Sidebar)
- **File:** `apps/web/src/routes/StackArticle.jsx`
- Cards use `StickyNavCard` from `@kol/ui`. Older sections (indices `< activeSection`) overlap by `40px`, dim their text, and collapse to a single-line heading so the stack never exceeds ~6 cards visually.
- Active and future sections keep normal spacing; z-index ordering ensures newer cards sit on top.
- Rationale: maintain focus on the current chapter while keeping previous anchors visible/clickable.

## Sources & References Layout
- Sources list now inherits `.kol-prose` width for both layouts and uses the `dense` variant (1rem padding-top, 1px divider).
- Wrapper margin is controlled at the route level (`mt-8`) instead of negative offsets; h3 headings inside `.sources-section` override the default `.kol-prose h3` top margin to avoid extra gaps.
- List items use 20px×24px padding with 0.5rem gaps between cards (`packages/ui/css/prose.css`) to align with the desired 16px vertical rhythm.

## Upcoming Tasks
- [ ] **Schema flags:** Add explicit Sanity fields for “Featured” vs “Highlight” vs “Pinned” to avoid client heuristics.
- [ ] **Pagination:** Hook `StackBrowseArticles` load-more button to a query with `start/limit` parameters.
- [ ] **Server filters:** Move search/tag filtering server-side if article volume exceeds ~30.
- [ ] **Doc parity:** Update this file whenever hero copy, highlight logic, or control behavior changes.

Refer to `4.0.32` for the Sanity field definitions and `4.0.31` for article layout documentation.

## Image Sizing Guidelines
| Location | Target Size | Notes |
|----------|-------------|-------|
| Hero image (`ArticleHeader`) | 1200×600 crop (4:2 aspect) | `buildSanityImageUrl(heroImage, 1200, 600)` enforces this ratio; upload assets that crop cleanly. |
| Author avatar | 96×96 | Rendered inside a circular mask; use at least 96×96 sources for crisp results. |
| Stack hero background / highlight cards | Full-bleed assets (highlight cards render in 16:9) | `StackHeroTall` and highlight cards rely on their media files (images or videos). Provide ≥1600px wide assets to avoid pixelation. |
| Stack listing thumbnail (`ArticleCardMini`) | Square ≥120×120 (prefer 512×512) | Cards render a 120×120 crop. Upload square imagery so focal points aren’t clipped. |
| Inline article images (Portable Text) | **1200×675** (recommended) | Use a 16:9 asset at 1200px width × 675px height. It fills the `.kol-prose` width (~1040px) and scales down cleanly while keeping a consistent aspect. |

Higher-resolution uploads are fine—Sanity’s CDN downscales via the helper, so long as the original has enough detail.
