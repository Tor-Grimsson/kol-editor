---
version: 1.0.0
date: 2025-11-16
status: active
content-type: implementation
category: pages
cross-references:
  parent: 4.0.3
  related:
    - apps/web/src/routes/Article.jsx
    - packages/content/src/schemas/types/blog.ts
    - docs/documentation/4.0.31-stack-prose-styles.md
    - docs/documentation/4.0.32-stack-sanity-settings.md
---

# 4.0.34 Stack — Smart Article Routing

> Canonical reference for the “single route, multiple layouts” system originally documented in `7.3.4-prose-smart-article-routing.md`.

## Overview
- The `/article/:slug` route chooses the correct layout at runtime based on the Sanity `type` field (`standard` vs `research`).
- Ensures editorial teams can toggle between single-column posts and research-grade two-column experiences without duplicating routes.

## Flow
```
URL /article/my-post
  ↓ useParams() -> slug
  ↓ BLOG_DETAIL (includes type field)
  ↓ const articleType = article.type || 'standard'
  ↓
  ┌──────────────────────────────┬─────────────────────────────┐
  │ articleType === 'research'   │ else                       │
  │ Two-column research layout   │ Single-column standard     │
  └──────────────────────────────┴─────────────────────────────┘
```

## Layout Profiles

| Type | Layout | Key Features | Component Highlights |
|------|--------|--------------|----------------------|
| `standard` | Single column, centered max 800px | Portable Text rendering, straightforward reading | `ArticleHeader`, `PortableTextBlog` (`kol-prose-wide`), optional `SourcesSection` |
| `research` | Two-column grid (`529px` sticky nav + flexible content) | Sticky TOC cards, summary bullets, denser typography, sources | `ArticleHeader`, `StickyNavCard`, `ProseContent`, `SourcesSection` |

See `4.0.31-stack-prose-styles.md` for typography + code block specifics.

## Sanity Schema Hook
- Field defined in `packages/content/src/schemas/types/blog.ts` (see `4.0.32`).
- Radio options:
  - Standard Blog Post (`standard`)
  - Research Article (`research`)
- Defaults to `standard` for backward compatibility; articles missing the field still render in the single-column layout.

## Implementation Notes
- **Route file:** `apps/web/src/routes/Article.jsx`
- **Queries:** `BLOG_DETAIL`, `BLOG_LIST`, `BLOG_FEATURED` must all request the `type` field so hero/highlight contexts respect layout.
- **Reading time:** Computed client-side (~200 WPM) regardless of layout.
- **Sources:** Provide `sources[]` in Sanity to auto-render `SourcesSection` in both modes.

### Render helpers
```tsx
const renderStandardLayout = () => (
  <main className="min-h-screen bg-surface-primary text-auto">
    <ArticleHeader {...articleData} />
    <Divider />
    <section className="px-6 lg:px-10 py-16">
      <div className="max-w-[800px] mx-auto">
        <article className="space-y-12">
          <div className="kol-prose-wide">
            <PortableText
              value={article.body}
              components={portableTextBlogWideComponents}
            />
          </div>
          {article.sources?.length > 0 && (
            <SourcesSection sources={formatSources(article.sources)} />
          )}
        </article>
      </div>
    </section>
  </main>
)

const renderResearchLayout = () => (
  <main className="min-h-screen bg-surface-primary text-auto">
    <ArticleHeader {...articleData} />
    <Divider />
    <section className="px-6 lg:px-10 py-16">
      <div className="max-w-[1200px] mx-auto grid gap-12 lg:grid-cols-[minmax(0,529px)_minmax(0,1fr)] lg:gap-16">
        <aside className="space-y-8">
          <StickyNavCard ... />
        </aside>
        <article className="space-y-16">
          <ProseContent variant="default" />
          {article.sources?.length > 0 && (
            <SourcesSection sources={formatSources(article.sources)} />
          )}
        </article>
      </div>
    </section>
  </main>
)
```

## Usage Guide
1. **Create/Update article in Sanity:** set the Article Type radio.
2. **Preview:** visit `/article/<slug>`; confirm layout matches expectation.
3. **Testing:** cover both article types + fallback (no `type` field).
4. **Edge cases:** ensure articles without tags, sources, or hero image still render gracefully (ArticleHeader handles optional data).

## Future Enhancements
- Auto-generate StickyNavCard entries from actual headings.
- Additional types (`tutorial`, `case-study`) that piggyback on this switch.
- Shared analytics hook to track which layout is consumed more often.

Keep this doc updated whenever the routing logic, layout signatures, or Sanity field names change.

