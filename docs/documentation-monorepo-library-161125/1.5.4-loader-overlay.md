# 1.5.4 Loader Overlay

> Navigation feedback components that provide user experience cues during page loads and interactions.

## Overview

Navigation feedback components provide visual and interactive cues that guide users through page transitions, initial loads, and navigation states. They enhance perceived performance and provide context during movement through the application.

## LoaderOverlay

**Location**: `apps/web/src/components/layout/LoaderOverlay.jsx`

### Purpose

Initial page load experience for first-time visitors. Creates a branded, engaging entry point with smooth transition into the application.

### Implementation

```javascript
import ColorLoader from '../loaders/ColorLoader'
import { CursorProvider } from '../../context/CursorContext'

export default function LoaderOverlay({ children, message = 'Loading', onEnter }) {
  return (
    <CursorProvider>
      <div className="fixed inset-0 flex flex-col items-center justify-center z-[100] bg-black">
        {children || <ColorLoader message={message} onEnter={onEnter} />}
      </div>
    </CursorProvider>
  )
}
```

### Key Features

#### Full-Screen Coverage
```javascript
className="fixed inset-0 z-[100] bg-black"
```

- **Fixed positioning** - covers entire viewport
- **Z-index 100** - above all other content
- **Black background** - immersive entry experience
- **Centered content** - flexbox centering

#### Customizable Content
```javascript
{children || <ColorLoader message={message} onEnter={onEnter} />}
```

- **Children prop** - accept custom content
- **Default content** - ColorLoader component
- **Message prop** - customizable loading text
- **Enter callback** - handles exit animation

#### Cursor Integration
```javascript
<CursorProvider>
  <div>...</div>
</CursorProvider>
```

- Wraps overlay in cursor provider
- Maintains cursor state during overlay
- Smooth cursor transitions

### Usage

**Location**: `apps/web/src/App.jsx`

```javascript
function AppRoutes() {
  const [isLoading, setIsLoading] = useState(() => {
    // Check if user has seen loader this session
    const hasSeenLoader = sessionStorage.getItem('hasSeenLoader')
    return !hasSeenLoader
  })

  const handleEnter = () => {
    setIsLoading(false)
    sessionStorage.setItem('hasSeenLoader', 'true')
  }

  return (
    <>
      {isLoading && location.pathname === '/' && <LoaderOverlay onEnter={handleEnter} />}
      <Routes>...</Routes>
    </>
  )
}
```

**Logic**:
- Check sessionStorage for `hasSeenLoader`
- Show overlay only if hasn't been seen
- Set flag when user enters
- Only show on homepage (`location.pathname === '/'`)

### ColorLoader Component

**Location**: `apps/web/src/components/loaders/ColorLoader.jsx`

Custom branded loader with animations and enter button.

#### Features
- **Animated color blocks** - brand colors in motion
- **Typographic message** - "Loading" or custom message
- **Enter button** - manual skip option
- **Smooth transitions** - fade/slide animations
- **Cursor aware** - integrates with custom cursor

## CursorOverlay

**Location**: `apps/web/src/components/overlay/CursorOverlay.jsx`

### Purpose

Custom cursor that follows mouse movement across the application, providing a cohesive branded interaction experience.

### Implementation

```javascript
import { useCursor } from '../../context/CursorContext'

export default function CursorOverlay() {
  const { position, visible } = useCursor()

  return (
    <div
      style={{
        position: 'fixed',
        left: 0,
        top: 0,
        width: '100vw',
        height: '100vh',
        pointerEvents: 'none',
        zIndex: 60,
      }}
    >
      <div
        className="bg-fg-08 border-auto"
        style={{
          position: 'absolute',
          transform: `translate(${position.x - 16}px, ${position.y - 16}px)`,
          width: 32,
          height: 32,
          borderRadius: '999px',
          border: '1px solid',
          opacity: visible ? 1 : 0,
          transition: 'opacity 150ms ease',
        }}
      />
    </div>
  )
}
```

### Key Features

#### Overlay Layer
```javascript
className="fixed inset-0 pointer-events-none"
```

- **Fixed overlay** - covers entire viewport
- **No pointer events** - doesn't block interactions
- **Z-index 60** - above content, below modals

#### Cursor Element
```javascript
style={{
  position: 'absolute',
  transform: `translate(${position.x - 16}px, ${position.y - 16}px)`,
  width: 32,
  height: 32,
  borderRadius: '999px',
}}
```

- **Position tracking** - follows mouse position
- **Centered offset** - 16px offset for center alignment
- **32x32 size** - custom cursor size
- **Circular shape** - border-radius for round appearance
- **Semi-transparent** - bg-fg-08 with opacity

#### Visibility Control
```javascript
opacity={visible ? 1 : 0}
transition="opacity 150ms ease"
```

- **Context-driven** - visibility from CursorContext
- **Smooth fade** - 150ms opacity transition
- **Prevents flicker** - gradual hide/show

### CursorContext Integration

**Location**: `apps/web/src/context/CursorContext.jsx`

Provides cursor position and visibility state throughout the application.

#### Context Value
```javascript
const [position, setPosition] = useState({ x: 0, y: 0 })
const [visible, setVisible] = useState(true)
```

**State**:
- **position** - current mouse coordinates
- **visible** - cursor visibility flag

#### Mouse Tracking
```javascript
useEffect(() => {
  const updatePosition = (e) => {
    setPosition({ x: e.clientX, y: e.clientY })
  }

  window.addEventListener('mousemove', updatePosition)
  return () => window.removeEventListener('mousemove', updatePosition)
}, [])
```

**Behavior**:
- Listen to `mousemove` events
- Update position state on move
- Cleanup on unmount

### Usage in SiteLayout

**Location**: `apps/web/src/components/layout/SiteLayout.jsx`

```javascript
export default function SiteLayout() {
  return (
    <div className="min-h-dvh bg-surface-primary">
      <Navbar />
      <Outlet />
      <Footer />
      <CursorOverlay />
    </div>
  )
}
```

**Integration**:
- Included in all page layouts
- Renders on every route
- Provides consistent cursor experience

## Navigation Feedback Patterns

### Initial Load

```
First Visit → LoaderOverlay → Enter Button → Main App
```

**Flow**:
1. User visits homepage first time
2. LoaderOverlay covers screen
3. Shows branded loader animation
4. User clicks Enter or waits for auto-advance
5. Overlay fades out, reveals main app
6. Flag set in sessionStorage

### Subsequent Visits

```
Visit → No Loader → Direct to App
```

**Flow**:
1. User visits homepage (already seen loader)
2. sessionStorage has `hasSeenLoader` flag
3. LoaderOverlay condition fails
4. Direct to main app
5. Faster perceived load time

### Cursor Movement

```
Mouse Move → Context Update → Overlay Re-render → Smooth Follow
```

**Flow**:
1. Mouse moves across viewport
2. CursorContext updates position
3. CursorOverlay re-renders with new position
4. Transform applied via CSS
5. Smooth cursor following

### Route Transitions

```
Route Change → Scroll to Top → Loader State Check → Navigation
```

**Flow**:
1. User clicks navigation link
2. React Router handles route change
3. useEffect in AppRoutes triggers
4. window.scrollTo(0, 0) executes
5. Loader state checked (if homepage)
6. Page renders with new content

## Performance Considerations

### LoaderOverlay
- **Session storage check** - synchronous but minimal
- **Conditional rendering** - doesn't render if not needed
- **Event cleanup** - proper unmounting

### CursorOverlay
- **RequestAnimationFrame** - could be added for smoother tracking
- **Event delegation** - single listener on window
- **Pointer events none** - zero impact on interactions
- **Lightweight rendering** - single div with transform

## Accessibility

### LoaderOverlay
- **Keyboard navigation** - Enter button focusable
- **ARIA labels** - can be added for screen readers
- **Custom content** - allows accessible alternatives
- **Focus management** - handles focus during transition

### CursorOverlay
- **Pointer events none** - doesn't block keyboard navigation
- **Visual only** - doesn't replace native cursor for accessibility
- **Visibility toggle** - can be hidden for keyboard users

## Related Documentation

- [1.5.0 Navigation System](./1.5.0-navigation-system.md) - Overall architecture
- [1.5.1 Navbar & Footer](./1.5.1-navbar-footer.md) - Site-level navigation
- [5.0.2 Workshop Sidebar](./5.0.2-workshop-sidebar.md) - Sidebar implementation
- [1.5.3 Router DOM](./1.5.3-router-dom.md) - React Router integration

---

**Loader Overlay**: Navigation feedback components that enhance user experience through transitions and visual cues.
