# 1.0.0 Foundation: Repository Structure

**Version:** 1.0.0
**Date:** 2025-11-03
**Status:** Active
**Content Type:** reference
**Category:** foundation

---

## Overview

This document describes the kolkrabbi monorepo architecture, directory structure, and organizational principles. The monorepo uses Turborepo for build orchestration, Yarn workspaces for dependency management, and atomic design for component organization.

### Chapter Index

| Number | Title | Focus |
|--------|-------|-------|
| `1.0.0` | Foundation Index & Repo Structure (this doc) | Packages, directories, ownership |
| `1.0.1` | Naming Conventions | Files, components, schema naming |
| `1.0.2` | Markdown Parser | Custom markdown pipeline |
| `1.1.0` | Build System | Turborepo, caching, CI |
| `1.2.0` / `1.2.1` | Documentation Layout Evolution | Visual/layout experiments for docs |
| `1.5.0`–`1.5.4` | Navigation System Series | Navbar, footer, sidebar, router, loaders |

---

## Architecture Principles

### 1. Monorepo Benefits

**Shared Dependencies:**
- Common packages (`ui`, `content`, `fontviewer`) shared across all apps
- Single `yarn.lock` file for all dependencies
- Consistent versions across entire project
- Simplified dependency updates

**Atomic Updates:**
- Update design system once in `packages/ui`, propagates everywhere
- Fix a bug in a shared component, fix applies to all apps
- Maintain consistency across applications automatically

**Build Efficiency:**
- Turborepo caches build artifacts
- Only rebuilds packages that changed
- Parallel builds across the dependency graph
- Incremental builds for faster development

### 2. Ownership Model

**Each package/app is self-contained:**
- Has its own `package.json`
- Defines its own dependencies
- Exports its own public API
- Owns its own build configuration

**Shared packages are universal:**
- `packages/ui` - Can be used by any app
- `packages/content` - Shared TypeScript types
- `packages/fontviewer` - Reusable component

**Apps are specific:**
- `apps/web` - Marketing site and design system showcase
- `apps/studio` - Sanity Studio CMS

---

## Directory Structure

```
kolkrabbi-monorepo/
├── .git/                          # Git version control
├── .turbo/                        # Turborepo cache configuration
├── .yarn/                         # Yarn cache and plugins
├── .yarnrc.yml                    # Yarn configuration
├── package.json                   # Root package.json (workspaces)
├── yarn.lock                      # Dependency lockfile
├── turbo.json                     # Turborepo pipeline config
├── README.md                      # Project overview
│
├── apps/                          # Applications
│   ├── web/                       # Main marketing site
│   │   ├── src/
│   │   │   ├── App.jsx            # Routes and app structure
│   │   │   ├── main.jsx           # React entry point
│   │   │   ├── routes/            # Page components
│   │   │   │   ├── Home.jsx
│   │   │   │   ├── Work.jsx
│   │   │   │   ├── Foundry.jsx
│   │   │   │   ├── Stack.jsx
│   │   │   │   ├── Styleguide.jsx
│   │   │   │   └── styleguide/    # Styleguide pages
│   │   │   ├── components/        # React components
│   │   │   │   ├── layout/        # Layout components
│   │   │   │   ├── sections/      # Page sections
│   │   │   │   │   ├── home/      # Home page sections
│   │   │   │   │   ├── work/      # Work page sections
│   │   │   │   │   ├── foundry/   # Foundry page sections
│   │   │   │   │   └── collections/ # Collection sections
│   │   │   │   ├── prose/         # Prose typography components
│   │   │   │   ├── styleguide/    # Styleguide-specific components
│   │   │   │   └── ui/            # UI components (from packages/ui)
│   │   │   ├── data/              # Static data and queries
│   │   │   ├── lib/               # Utilities and clients
│   │   │   │   └── sanityClient.js
│   │   │   └── context/           # React context providers
│   │   ├── public/                # Static assets
│   │   │   ├── svg/               # SVG icons and illustrations
│   │   │   └── fonts/             # Font files
│   │   ├── package.json
│   │   └── vite.config.js
│   │
│   └── studio/                    # Sanity Studio CMS
│       ├── src/
│       │   ├── components/        # Studio custom components
│       │   └── schemas/           # Sanity schema definitions
│       ├── sanity.config.ts       # Sanity configuration
│       ├── package.json
│       └── tsconfig.json
│
├── packages/                      # Shared packages
│   ├── ui/                        # Design system components
│   │   ├── src/
│   │   │   ├── atoms/             # Atomic components
│   │   │   │   ├── Button.jsx
│   │   │   │   ├── Input.jsx
│   │   │   │   └── icons/         # Icon SVGs
│   │   │   ├── molecules/         # Molecular components
│   │   │   │   ├── Card.jsx
│   │   │   │   └── Badge.jsx
│   │   │   ├── organisms/         # Organism components
│   │   │   │   └── DataTable.jsx
│   │   │   ├── illustrations/     # Illustration SVGs
│   │   │   │   └── svg/           # Illustration files
│   │   │   └── logos/             # Logomark SVGs
│   │   │       └── svg/           # Logomark files
│   │   ├── css/                   # Design system styles
│   │   │   ├── theme.css          # Design tokens (CSS variables)
│   │   │   ├── components.css     # Component styles
│   │   │   ├── utilities.css      # Utility classes
│   │   │   └── prose.css          # Typography styles
│   │   └── package.json
│   │
│   ├── content/                   # Content types and schemas
│   │   ├── src/
│   │   │   ├── sanity/            # Sanity schema definitions
│   │   │   └── types/             # TypeScript types
│   │   ├── package.json
│   │   └── tsconfig.json
│   │
│   └── fontviewer/                # Font specimen viewer
│       ├── src/
│       │   └── components/        # Font viewer components
│       ├── package.json
│       └── tsconfig.json
│
└── docs/                          # Documentation
    ├── system/                    # Design system documentation
    │   ├── 0.x.x-metadata-*.md    # Documentation system
    │   ├── 1.x.x-foundation-*.md  # Architecture docs
    │   ├── 2.x.x-design-system-*.md # Design system docs
    │   └── archive/               # Archived/deprecated docs
    ├── archive/                   # Long-term storage
    ├── applications/              # App-specific docs
    ├── blog-posts/                # Blog content
    ├── components/                # Component docs (legacy)
    ├── operations/                # Operational docs
    └── status/                    # Status and roadmap
```

---

## Package Structure

### apps/web (React Application)

**Purpose:** Main marketing website and design system showcase

**Technology Stack:**
- React 19
- Vite (build tool)
- React Router (routing)
- Tailwind CSS v4 (styling)
- Sanity CMS (content management)

**Key Features:**
- Homepage with hero, highlights, and work showcase
- Foundry page for typography demonstrations
- Stack page for technology showcase
- Work portfolio with detail pages
- Styleguide with interactive component demos
- Custom cursor system
- Responsive design (mobile-first)

**Build Configuration:**
```json
{
  "name": "web",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview"
  }
}
```

### apps/studio (Sanity Studio)

**Purpose:** Content management interface

**Technology Stack:**
- Sanity Studio
- TypeScript
- GROQ (query language)

**Key Features:**
- Custom schemas for projects, media, settings
- Real-time collaboration
- Media management
- Preview integration

**Build Configuration:**
```json
{
  "name": "studio",
  "scripts": {
    "dev": "sanity dev",
    "build": "sanity build",
    "deploy": "sanity deploy"
  }
}
```

### packages/ui (Design System)

**Purpose:** Shared component library and design tokens

**Structure:**
- **Atoms:** Basic building blocks (Button, Input, Icon)
- **Molecules:** Simple combinations (Card, Badge)
- **Organisms:** Complex components (DataTable, Navigation)
- **CSS:** Design tokens and utilities
- **Assets:** SVG illustrations and logomarks

**Atomic Design Methodology:**
```
Atoms → Molecules → Organisms → Templates → Pages
```

**Export Pattern:**
```javascript
// packages/ui/src/index.js
export { Button } from './atoms/Button'
export { Card } from './molecules/Card'
export { DataTable } from './organisms/DataTable'
```

**Import in Apps:**
```javascript
import { Button } from '@kol/ui'
```

### packages/content (Content Types)

**Purpose:** Shared TypeScript types and Sanity schemas

**Contents:**
- TypeScript interfaces for all content types
- Sanity schema definitions
- GROQ query helpers
- Content validation

**Usage:**
```typescript
import { Project } from '@kol/content'

// Type-safe content
const project: Project = {
  title: 'Example',
  slug: 'example',
  // ... other fields
}
```

### packages/fontviewer (Font Specimen)

**Purpose:** Interactive font specimen viewer

**Contents:**
- Font preview components
- Variable font controls
- Type specimen displays
- Font feature toggles

---

## Build System

### Turborepo Configuration

**turbo.json:**
```json
{
  "pipeline": {
    "build": {
      "dependsOn": ["^build"],
      "outputs": ["dist/**"]
    },
    "dev": {
      "cache": false
    },
    "lint": {
      "outputs": []
    }
  }
}
```

**Pipeline Principles:**
- `build` - Depends on dependencies being built first (`^build`)
- `dev` - No caching (always fresh)
- `lint` - No outputs to cache

### Build Scripts

**Root package.json:**
```json
{
  "scripts": {
    "dev:web": "turbo run dev --filter=web",
    "dev:studio": "turbo run dev --filter=studio",
    "build": "turbo run build",
    "lint": "turbo run lint"
  }
}
```

**Usage:**
```bash
# Run web app in development
yarn dev:web

# Run studio in development
yarn dev:studio

# Build all packages and apps
yarn build

# Lint all code
yarn lint
```

### Dependency Management

**Yarn Workspaces:**
```json
{
  "workspaces": [
    "apps/*",
    "packages/*"
  ]
}
```

**Adding Dependencies:**
```bash
# Add to specific workspace
yarn workspace web add react-router-dom

# Add to root (if needed for scripts)
yarn add -W turbo

# Add as dev dependency
yarn workspace studio add -D typescript
```

---

## Development Workflow

### Working on Shared Packages

**When to modify `packages/ui`:**
- Adding new design system components
- Updating design tokens
- Creating new utility classes
- Modifying component styles

**Process:**
1. Make changes in `packages/ui/src/`
2. Run `yarn build` to compile package
3. Changes automatically available in all apps
4. No need to publish (local workspace)

**Example:**
```bash
# Add new Button variant
# Edit: packages/ui/src/atoms/Button.jsx
# Build: yarn build
# Use: In apps/web/src/components/
```

### Working on Apps

**When to modify `apps/web`:**
- Building new pages
- Creating page-specific components
- Integrating with Sanity CMS
- Adding route logic

**Process:**
1. Modify components in `apps/web/src/components/`
2. Import from `@kol/ui` for shared components
3. Run `yarn dev:web` to see changes
4. Commit to update design system

### Working on Documentation

**When to modify `docs/`:**
- Adding design system documentation
- Creating component docs
- Writing guides and tutorials
- Capturing architectural decisions

**Process:**
1. Add new docs to `docs/system/`
2. Use M.m.p numbering system (see [0.0.1](0.0.1-metadata-writing-guidelines.md))
3. Update index at [0.0.2](0.0.2-metadata-index.md)
4. Follow writing guidelines

---

## Code Organization Conventions

### File Naming

**Components:**
- PascalCase for React components: `Button.jsx`
- camelCase for constants: `breakpoints.js`
- kebab-case for directories: `styleguide/`

**Files:**
- `.jsx` - React components
- `.js` - JavaScript modules, utilities
- `.ts` - TypeScript files
- `.css` - Stylesheets
- `.md` - Documentation

### Directory Naming

**Always use kebab-case:**
```
✅ Good:
- components/
- style-guide/
- font-viewer/
- data-tables/

❌ Bad:
- components/
- styleGuide/
- fontViewer/
- dataTables/
```

### Import Conventions

**From packages:**
```javascript
// Import from shared package
import { Button } from '@kol/ui'
import { Project } from '@kol/content'
```

**From same package:**
```javascript
// Relative imports
import { Card } from '../Card'
import { Icon } from '../../atoms/Icon'
```

**Absolute imports (from root):**
```javascript
// Configure in vite.config.js or tsconfig.json
import Component from '@/components/Component'
import data from '@/data/data'
```

---

## Environment Configuration

### Required Environment Variables

**For apps/web:**
```bash
# .env.local
VITE_SANITY_PROJECT_ID=your_project_id
VITE_SANITY_DATASET=projects
VITE_SANITY_API_TOKEN=your_token
```

**For apps/studio:**
```bash
# .env.local
SANITY_STUDIO_PROJECT_ID=your_project_id
SANITY_STUDIO_DATASET=projects
SANITY_STUDIO_API_TOKEN=your_token
```

### Configuration Files

**Vite (apps/web):**
```javascript
// apps/web/vite.config.js
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

export default defineConfig({
  plugins: [react()],
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src')
    }
  }
})
```

**TypeScript (packages):**
```json
{
  "extends": "../../tsconfig.json",
  "compilerOptions": {
    "outDir": "./dist",
    "rootDir": "./src"
  }
}
```

---

## Deployment

### apps/web (Static Site)

**Deployment:**
- Build with `yarn build`
- Outputs to `apps/web/dist/`
- Deploy to Vercel, Netlify, or static host

**CI/CD Pipeline:**
```yaml
# .github/workflows/deploy.yml
name: Deploy
on:
  push:
    branches: [main]
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
      - run: yarn install
      - run: yarn build
      - run: yarn deploy:web
```

### apps/studio (Sanity Studio)

**Deployment:**
- Deploy with `sanity deploy`
- Host on Sanity Managed Studio
- Uses Sanity CLI

### packages (Component Library)

**Distribution:**
- Currently internal only (monorepo)
- Could publish to npm in future
- Use `yarn workspace` for local development

---

## Version Control

### Branch Strategy

**Main Branches:**
- `main` - Production-ready code
- `develop` - Integration branch for features
- `feature/*` - Individual features
- `hotfix/*` - Production fixes

**Commit Messages:**
```
feat(ui): Add new Button variant
fix(web): Resolve rendering issue
docs(system): Update color documentation
refactor(content): Simplify schema structure
```

### Git Hooks

**Pre-commit:**
- ESLint checks
- Prettier formatting
- Type checking (for TS files)

**Pre-push:**
- Run tests
- Build all packages

---

## Related Documentation

**Foundation:**
- [1.0.1 Foundation: Naming Conventions](1.0.1-foundation-naming-conventions.md) - File and code naming rules
- [1.1.0 Foundation: Build System](1.1.0-foundation-build-system.md) - Turborepo and build pipeline

**Design System:**
- [2.0.0 Design System: Overview](2.0.0-design-system-overview.md) - Design system principles

**Metadata:**
- [0.0.0 Documentation System](0.0.0-documentation-index.md) - Documentation architecture
- [0.0.1 Writing Guidelines](0.0.1-metadata-writing-guidelines.md) - How to write docs

---

**Last Updated:** 2025-11-03
