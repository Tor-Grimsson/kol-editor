# 5.3.5 Workshop: Styleguide Architecture

**Version:** 1.0
**Date:** 2025-11-04
**Status:** Active
**Category:** workshop

---

## Overview

The Kolkrabbi Design System Stylguide is a comprehensive web application that serves as the **primary interface** for exploring, testing, and understanding the design system. It combines static documentation, interactive components, and scientific apparatus into a unified platform.

## Architecture

### Component Hierarchy

```
5.3.2 - Apparatus Overview
5.3.3 - Frequency Modulator Apparatus
5.3.4 - Wavy Circle Editor Apparatus
5.3.5 - Design System Styleguide (this document)
```

The styleguide is a **complex component system** that encompasses:

1. **Navigation System** - Tree-based structure for browsing content
2. **Documentation Pages** - Static content with typography system
3. **Interactive Previews** - Live component demonstrations
4. **Scientific Apparatus** - Mathematical visualization tools
5. **System Metrics** - Dashboard showing system health

### File Structure

```
apps/web/src/routes/styleguide/
├── Styleguide.jsx              # Root route component
├── Home.jsx                    # Dashboard with metrics
├── Docs.jsx                    # Documentation viewer
├── Colors.jsx                  # Color system explorer
├── Typography.jsx              # Type scale demonstrations
├── ComponentsAtoms.jsx         # Atom component previews
├── ComponentsMolecules.jsx     # Molecule component previews
├── ComponentsOrganisms.jsx     # Organism component previews
├── Animations.jsx              # Motion and animation demos
└── StyleguideExpansionContext.jsx  # State management
```

### Related Components

```
packages/ui/src/
├── atoms/                      # Design system atoms
│   ├── Button.jsx
│   ├── Input.jsx
│   └── ...
├── molecules/                  # Design system molecules
│   ├── Card.jsx
│   ├── FormField.jsx
│   └── ...
└── organisms/                  # Design system organisms
    ├── NavigationBar.jsx
    ├── DataTable.jsx
    └── ...
```

## Core Features

### 1. Dashboard (Home.jsx)

**Purpose:** System health monitoring and quick navigation

**Key Metrics Displayed:**
- Component inventory (atoms, molecules, icons)
- Navigation structure
- Package statistics
- Documentation coverage
- Token availability

**Code Example:**

```jsx
const metricCards = [
  {
    id: 'atoms',
    label: 'Atoms',
    value: formatNumber(uiAtoms.total),
    meta: `${formatNumber(uiAtoms.core)} core · ${formatNumber(uiAtoms.foundry)} foundry`
  },
  {
    id: 'molecules',
    label: 'Molecules',
    value: formatNumber(uiMolecules.total),
    meta: `${formatNumber(uiMolecules.core)} core · ${formatNumber(uiMolecules.foundry)} foundry`
  }
]
```

**Data Source:** `/apps/web/src/data/styleguide/system-metrics.json`

### 2. Documentation Viewer (Docs.jsx)

**Purpose:** Display design system documentation with navigation

**Features:**
- Automatic loading from `/docs/documentation/`
- Hierarchical navigation
- Search functionality
- Cross-references and links

**Code Example:**

```jsx
const Docs = () => {
  const [selectedDoc, setSelectedDoc] = useState(null)
  const [navigation, setNavigation] = useState([])

  useEffect(() => {
    // Load documentation structure
    loadDocumentationStructure().then(setNavigation)
  }, [])

  return (
    <div className="styleguide-docs">
      <aside className="navigation-sidebar">
        <NavigationTree nodes={navigation} />
      </aside>
      <main className="documentation-content">
        <DocumentViewer doc={selectedDoc} />
      </main>
    </div>
  )
}
```

### 3. Component Previews

**Atoms (`ComponentsAtoms.jsx`)**

Live demonstrations of atomic components:

```jsx
const ComponentsAtoms = () => {
  return (
    <div className="component-preview">
      <h2>Buttons</h2>
      <div className="preview-grid">
        <Button variant="primary">Primary</Button>
        <Button variant="secondary">Secondary</Button>
        <Button variant="ghost">Ghost</Button>
      </div>

      <h2>Inputs</h2>
      <div className="preview-grid">
        <Input placeholder="Text input" />
        <Input type="password" placeholder="Password" />
        <Input type="email" placeholder="Email" />
      </div>
    </div>
  )
}
```

**Molecules (`ComponentsMolecules.jsx`)**

Compound components combining atoms:

```jsx
const ComponentsMolecules = () => {
  return (
    <div className="component-preview">
      <h2>Cards</h2>
      <div className="preview-grid">
        <Card>
          <CardHeader>Card Title</CardHeader>
          <CardBody>Card content goes here.</CardBody>
          <CardFooter>Card footer</CardFooter>
        </Card>
      </div>

      <h2>Form Groups</h2>
      <FormGroup>
        <Label htmlFor="email">Email</Label>
        <Input id="email" type="email" />
        <HelperText>We'll never share your email.</HelperText>
      </FormGroup>
    </div>
  )
}
```

**Organisms (`ComponentsOrganisms.jsx`)**

Complex UI patterns:

```jsx
const ComponentsOrganisms = () => {
  return (
    <div className="component-preview">
      <h2>Navigation Bars</h2>
      <NavigationBar
        brand="Kolkrabbi"
        links={[
          { label: 'Home', href: '/' },
          { label: 'About', href: '/about' },
          { label: 'Contact', href: '/contact' }
        ]}
      />

      <h2>Data Tables</h2>
      <DataTable
        columns={['Name', 'Email', 'Role']}
        data={[
          { name: 'John Doe', email: 'john@example.com', role: 'Admin' },
          { name: 'Jane Smith', email: 'jane@example.com', role: 'User' }
        ]}
      />
    </div>
  )
}
```

### 4. Scientific Apparatus

**Wavy Circle Editor**

Mathematical waveform manipulation:

```jsx
const WavyCircleEditor = ({ initialParams }) => {
  const [params, setParams] = useState(initialParams)

  return (
    <div className="apparatus-container">
      <Canvas>
        <WaveformVisualization params={params} />
      </Canvas>
      <ControlsPanel>
        <Slider
          label="Radius"
          value={params.radius}
          onChange={(value) => setParams({ ...params, radius: value })}
          min={50}
          max={300}
        />
        <Slider
          label="Amplitude"
          value={params.amplitude}
          onChange={(value) => setParams({ ...params, amplitude: value })}
          min={0}
          max={100}
        />
      </ControlsPanel>
    </div>
  )
}
```

**Frequency Modulator**

Wave interference visualization:

```jsx
const FrequencyModulator = () => {
  const [wave1, setWave1] = useState({ freq: 440, amp: 0.5, phase: 0 })
  const [wave2, setWave2] = useState({ freq: 660, amp: 0.3, phase: Math.PI / 2 })
  const [wave3, setWave3] = useState({ freq: 880, amp: 0.2, phase: Math.PI })

  return (
    <div className="apparatus-container">
      <Visualization>
        <WaveformCanvas
          wave1={wave1}
          wave2={wave2}
          wave3={wave3}
          interference={calculateInterference(wave1, wave2, wave3)}
        />
      </Visualization>
      <Controls>
        <WaveControls label="Primary" params={wave1} onChange={setWave1} />
        <WaveControls label="Secondary" params={wave2} onChange={setWave2} />
        <WaveControls label="Tertiary" params={wave3} onChange={setWave3} />
      </Controls>
    </div>
  )
}
```

## Navigation System

### Tree Structure

Navigation defined as nested object:

```javascript
const navigationTree = [
  {
    id: 'home',
    label: 'Home',
    path: '/styleguide',
    icon: 'home'
  },
  {
    id: 'colors',
    label: 'Colors',
    path: '/styleguide/colors',
    children: [
      { id: 'colors-palette', label: 'Palette', path: '/styleguide/colors/palette' },
      { id: 'colors-tokens', label: 'Tokens', path: '/styleguide/colors/tokens' },
      { id: 'colors-accessibility', label: 'Accessibility', path: '/styleguide/colors/accessibility' }
    ]
  },
  {
    id: 'typography',
    label: 'Typography',
    path: '/styleguide/typography',
    children: [
      { id: 'type-scale', label: 'Scale', path: '/styleguide/typography/scale' },
      { id: 'type-families', label: 'Families', path: '/styleguide/typography/families' },
      { id: 'type-prose', label: 'Prose', path: '/styleguide/typography/prose' }
    ]
  },
  {
    id: 'components',
    label: 'Components',
    path: '/styleguide/components',
    children: [
      { id: 'components-atoms', label: 'Atoms', path: '/styleguide/components/atoms' },
      { id: 'components-molecules', label: 'Molecules', path: '/styleguide/components/molecules' },
      { id: 'components-organisms', label: 'Organisms', path: '/styleguide/components/organisms' }
    ]
  },
  {
    id: 'apparatus',
    label: 'Apparatus',
    path: '/styleguide/apparatus',
    children: [
      { id: 'apparatus-wavy', label: 'Wavy Circle', path: '/styleguide/apparatus/wavy-circle' },
      { id: 'apparatus-frequency', label: 'Frequency Modulator', path: '/styleguide/apparatus/frequency-modulator' }
    ]
  }
]
```

### Sidebar Implementation

```jsx
const NavigationSidebar = ({ tree }) => {
  return (
    <nav className="styleguide-sidebar" aria-label="Styleguide navigation">
      <div className="sidebar-header">
        <h1 className="sidebar-title">Kolkrabbi</h1>
        <p className="sidebar-subtitle">Design System</p>
      </div>
      <ul className="navigation-tree" role="tree">
        {tree.map(node => (
          <NavigationNode key={node.id} node={node} depth={0} />
        ))}
      </ul>
    </nav>
  )
}

const NavigationNode = ({ node, depth }) => {
  const hasChildren = node.children && node.children.length > 0
  const isExpanded = useExpandState(node.id)

  return (
    <li
      className="navigation-node"
      role="treeitem"
      aria-expanded={hasChildren ? isExpanded : undefined}
      style={{ paddingLeft: depth * 16 + 16 }}
    >
      <a href={node.path} className="navigation-link">
        {node.icon && <Icon name={node.icon} />}
        <span className="navigation-label">{node.label}</span>
      </a>
      {hasChildren && isExpanded && (
        <ul role="group">
          {node.children.map(child => (
            <NavigationNode key={child.id} node={child} depth={depth + 1} />
          ))}
        </ul>
      )}
    </li>
  )
}
```

## State Management

### Expansion Context

Section expansion state managed via context:

```jsx
// StyleguideExpansionContext.jsx
const StyleguideExpansionContext = createContext()

export const StyleguideExpansionProvider = ({ children }) => {
  const [expandedSections, setExpandedSections] = useLocalStorage(
    'styleguide-expansion',
    {
      snapshot: true,
      workflow: false
    }
  )

  const toggleSection = (section) => {
    setExpandedSections(prev => ({
      ...prev,
      [section]: !prev[section]
    }))
  }

  return (
    <StyleguideExpansionContext.Provider value={{ expandedSections, toggleSection }}>
      {children}
    </StyleguideExpansionContext.Provider>
  )
}

export const useStyleguideExpansion = (key, defaults) => {
  const context = useContext(StyleguideExpansionContext)
  const [sections, setSections] = useState(defaults)

  useEffect(() => {
    const saved = localStorage.getItem(`styleguide-expansion-${key}`)
    if (saved) {
      setSections(JSON.parse(saved))
    }
  }, [key])

  const updateSection = (section, value) => {
    setSections(prev => {
      const updated = { ...prev, [section]: value }
      localStorage.setItem(`styleguide-expansion-${key}`, JSON.stringify(updated))
      return updated
    })
  }

  return [sections, updateSection]
}
```

### Usage in Components

```jsx
const Home = () => {
  const [expandedSections, setExpandedSections] = useStyleguideExpansion(
    'styleguide-home',
    {
      snapshot: true,
      workflow: true
    }
  )

  return (
    <div className="space-y-10">
      <SectionToggle
        label="System snapshot"
        isExpanded={expandedSections.snapshot}
        onToggle={() => setExpandedSections('snapshot', !expandedSections.snapshot)}
      />
    </div>
  )
}
```

## Theming

### Automatic Token Consumption

All components use semantic tokens:

```css
/* Sidebar */
.styleguide-sidebar {
  background: var(--kol-surface-secondary);
  border-right: 1px solid var(--kol-border-primary);
  color: var(--kol-content-primary);
}

/* Navigation nodes */
.navigation-link {
  color: var(--kol-content-primary);
  text-decoration: none;
}

.navigation-link:hover {
  background: var(--kol-surface-tertiary);
}

/* Preview grids */
.preview-grid {
  display: grid;
  gap: var(--kol-spacing-lg);
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
}

/* Cards */
.component-card {
  background: var(--kol-surface-secondary);
  border: 1px solid var(--kol-border-primary);
  border-radius: var(--kol-radius-md);
  padding: var(--kol-spacing-lg);
}
```

### Dark Mode Support

```css
@media (prefers-color-scheme: dark) {
  .styleguide-sidebar {
    background: var(--kol-surface-secondary);
    border-right-color: var(--kol-border-primary);
  }

  .navigation-link {
    color: var(--kol-content-primary);
  }
}
```

## System Metrics

### Metrics Generation

Metrics update via script:

```bash
# scripts/generate-styleguide-metrics.js
const scanDirectory = (dir) => {
  const files = fs.readdirSync(dir)
  const metrics = {
    atoms: { total: 0, core: 0, foundry: 0 },
    molecules: { total: 0, core: 0, foundry: 0 },
    icons: { total: 0 }
  }

  files.forEach(file => {
    const path = join(dir, file)
    const stat = fs.statSync(path)

    if (stat.isDirectory()) {
      if (file === 'atoms') {
        metrics.atoms.total = fs.readdirSync(path).length
      } else if (file === 'molecules') {
        metrics.molecules.total = fs.readdirSync(path).length
      }
    }
  })

  return metrics
}

const generateMetrics = () => {
  const uiPackage = path.resolve(__dirname, '../../packages/ui/src')
  const metrics = {
    generatedAt: new Date().toISOString(),
    packages: {
      ui: {
        atoms: scanDirectory(join(uiPackage, 'atoms')),
        molecules: scanDirectory(join(uiPackage, 'molecules'))
      }
    }
  }

  fs.writeFileSync(
    path.resolve(__dirname, '../apps/web/src/data/styleguide/system-metrics.json'),
    JSON.stringify(metrics, null, 2)
  )
}
```

### Metrics Display

```jsx
const MetricCard = ({ label, value, meta }) => {
  return (
    <div className="rounded-lg border border-auto bg-auto px-4 py-5">
      <span className="kol-mono-text-label uppercase opacity-60">{label}</span>
      <div className="mt-3 flex items-end justify-between">
        <span className="kol-heading-sm">{value}</span>
      </div>
      <p className="kol-mono-xs opacity-60 mt-3">{meta}</p>
    </div>
  )
}
```

## Workflow

### Adding New Sections

1. Create route component in `/styleguide/`
2. Add to navigation tree
3. Update system metrics
4. Test responsive behavior
5. Document changes

### Updating Components

1. Modify component source
2. Rebuild styleguide
3. Verify in browser
4. Update screenshots if needed
5. Update documentation

### Quality Assurance

```bash
# Test navigation
yarn test:styleguide:navigation

# Test responsive layouts
yarn test:styleguide:responsive

# Test apparatus
yarn test:styleguide:apparatus

# Generate fresh metrics
yarn metrics:styleguide
```

## Related Documents

- [3.0.0 - Component Overview](./3.0.0-design-system-components.md)
- [5.3.2 - Apparatus Overview](./5.3.2-components-apparatus-overview.md)
- [2.3.0 - CSS Architecture](../2.3.0-design-system-css-architecture.md)
- [2.4.0 - Prose System](../2.4.0-design-system-prose.md)

## Changelog

- **2025-11-04** (5.3.5): Initial styleguide architecture documentation

---

**Status:** Production Ready
**Last Updated:** 2025-11-04
**Maintainer:** Design System Team
